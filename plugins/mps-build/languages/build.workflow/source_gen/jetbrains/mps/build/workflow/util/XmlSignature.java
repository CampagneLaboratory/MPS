package jetbrains.mps.build.workflow.util;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import java.util.UUID;
import jetbrains.mps.build.workflow.behavior.BwfPathDeclaration_Behavior;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.smodel.behaviour.BehaviorReflection;

/**
 * Process only default xml elements (XmlElement) and attributes.
 */
public class XmlSignature {
  private final StringBuilder sb = new StringBuilder();
  private boolean hasErrors;
  public XmlSignature() {
    hasErrors = false;
  }
  public XmlSignature add(SNode element) {
    if (element == null || hasErrors) {
      return this;
    }

    if (SNodeOperations.isInstanceOf(element, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681415858l, "jetbrains.mps.core.xml.structure.XmlElement"))) {
      addElement(SNodeOperations.cast(element, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681415858l, "jetbrains.mps.core.xml.structure.XmlElement")));
    } else if (SNodeOperations.isInstanceOf(element, MetaAdapterFactory.getConcept(new UUID(7605046100638320544l, -5004325039833383149l), 6647099934207069215l, "jetbrains.mps.build.workflow.structure.BwfPathReference"))) {
      sb.append("<pathref ");
      sb.append(BwfPathDeclaration_Behavior.call_getPathId_6647099934207210775(SLinkOperations.getTarget(SNodeOperations.cast(element, MetaAdapterFactory.getConcept(new UUID(7605046100638320544l, -5004325039833383149l), 6647099934207069215l, "jetbrains.mps.build.workflow.structure.BwfPathReference")), MetaAdapterFactory.getReferenceLink(new UUID(7605046100638320544l, -5004325039833383149l), 6647099934207069215l, 6647099934207069216l, "target"))));
      sb.append("/>");
    } else {
      hasErrors = true;
    }
    return this;
  }
  private XmlSignature addElement(SNode element) {
    sb.append("<");
    sb.append(SPropertyOperations.getString(element, MetaAdapterFactory.getProperty(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681415858l, 6666499814681415862l, "tagName")));
    if (ListSequence.fromList(SLinkOperations.getChildren(element, MetaAdapterFactory.getContainmentLink(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681415858l, 6666499814681415861l, "attributes"))).isNotEmpty()) {
      for (SNode attr : SLinkOperations.getChildren(element, MetaAdapterFactory.getContainmentLink(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681415858l, 6666499814681415861l, "attributes"))) {
        if (SNodeOperations.isInstanceOf(attr, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681447923l, "jetbrains.mps.core.xml.structure.XmlAttribute"))) {
          sb.append(" ");
          addAttribute(SNodeOperations.cast(attr, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681447923l, "jetbrains.mps.core.xml.structure.XmlAttribute")));
        } else {
          hasErrors = true;
        }
      }
    }
    if (ListSequence.fromList(SLinkOperations.getChildren(element, MetaAdapterFactory.getContainmentLink(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681415858l, 1622293396948928802l, "content"))).isEmpty()) {
      sb.append("/>");
      return this;
    }
    sb.append(">");
    for (SNode content : SLinkOperations.getChildren(element, MetaAdapterFactory.getContainmentLink(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681415858l, 1622293396948928802l, "content"))) {
      if (SNodeOperations.isInstanceOf(content, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681299053l, "jetbrains.mps.core.xml.structure.XmlBaseElement"))) {
        add(SNodeOperations.cast(content, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681415858l, "jetbrains.mps.core.xml.structure.XmlElement")));
      } else if (SNodeOperations.isInstanceOf(content, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 1622293396948952339l, "jetbrains.mps.core.xml.structure.XmlText")) && isEmptyString(SPropertyOperations.getString(SNodeOperations.cast(content, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 1622293396948952339l, "jetbrains.mps.core.xml.structure.XmlText")), MetaAdapterFactory.getProperty(new UUID(5160134014823646133l, -7982110198386724200l), 1622293396948952339l, 1622293396948953704l, "value")))) {
        // ignore 
      } else {
        hasErrors = true;
      }
    }
    sb.append("</");
    sb.append(SPropertyOperations.getString(element, MetaAdapterFactory.getProperty(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681415858l, 6666499814681415862l, "tagName")));
    sb.append(">");
    return this;
  }
  private void addAttribute(SNode attr) {
    sb.append(SPropertyOperations.getString(attr, MetaAdapterFactory.getProperty(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681447923l, 6666499814681447926l, "attrName")));
    sb.append("=");
    sb.append('"');
    for (SNode val : SLinkOperations.getChildren(attr, MetaAdapterFactory.getContainmentLink(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681447923l, 6666499814681541918l, "value"))) {
      if (SNodeOperations.isInstanceOf(val, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 3080189811177215998l, "jetbrains.mps.core.xml.structure.XmlCharRefValue"))) {
        sb.append("&#");
        sb.append(SPropertyOperations.getString(SNodeOperations.cast(val, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 3080189811177215998l, "jetbrains.mps.core.xml.structure.XmlCharRefValue")), MetaAdapterFactory.getProperty(new UUID(5160134014823646133l, -7982110198386724200l), 3080189811177215998l, 3080189811177216006l, "charCode")));
        sb.append(";");
      } else if (SNodeOperations.isInstanceOf(val, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681541921l, "jetbrains.mps.core.xml.structure.XmlEntityRefValue"))) {
        sb.append("&");
        sb.append(SPropertyOperations.getString(SNodeOperations.cast(val, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681541921l, "jetbrains.mps.core.xml.structure.XmlEntityRefValue")), MetaAdapterFactory.getProperty(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681541921l, 6666499814681543256l, "entityName")));
        sb.append(";");
      } else if (SNodeOperations.isInstanceOf(val, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 3080189811177426492l, "jetbrains.mps.core.xml.structure.XmlNoSpaceValue"))) {
        // ignore 
      } else if (SNodeOperations.isInstanceOf(val, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681541919l, "jetbrains.mps.core.xml.structure.XmlTextValue"))) {
        SNode tv = SNodeOperations.cast(val, MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681541919l, "jetbrains.mps.core.xml.structure.XmlTextValue"));
        if (BehaviorReflection.invokeVirtual(Boolean.TYPE, tv, "virtual_onNewLine_3080189811177340422", new Object[]{})) {
          sb.append("\n");
        }
        sb.append(SPropertyOperations.getString(tv, MetaAdapterFactory.getProperty(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681541919l, 6666499814681541920l, "text")));
        if (BehaviorReflection.invokeVirtual(Boolean.TYPE, tv, "virtual_hasNewLineAfter_3080189811177340429", new Object[]{})) {
          if (SNodeOperations.isInstanceOf(SNodeOperations.getNextSibling(tv), MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681541916l, "jetbrains.mps.core.xml.structure.XmlValuePart")) && BehaviorReflection.invokeVirtual(Boolean.TYPE, SNodeOperations.cast(SNodeOperations.getNextSibling(tv), MetaAdapterFactory.getConcept(new UUID(5160134014823646133l, -7982110198386724200l), 6666499814681541916l, "jetbrains.mps.core.xml.structure.XmlValuePart")), "virtual_onNewLine_3080189811177340422", new Object[]{})) {
            return;
          }
          sb.append("\n");
        }
      } else {
        hasErrors = true;
      }
    }
    sb.append('"');
  }
  public String getResult() {
    return sb.toString();
  }
  public boolean hasErrors() {
    return hasErrors;
  }
  private static boolean isEmptyString(String str) {
    return str == null || str.length() == 0;
  }
}
