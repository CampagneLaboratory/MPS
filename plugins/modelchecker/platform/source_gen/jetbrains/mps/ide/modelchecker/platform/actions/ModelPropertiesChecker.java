package jetbrains.mps.ide.modelchecker.platform.actions;

/*Generated by MPS */

import java.util.List;
import jetbrains.mps.ide.findusages.model.SearchResult;
import org.jetbrains.mps.openapi.model.SModel;
import org.jetbrains.mps.openapi.util.ProgressMonitor;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.project.validation.ValidationUtil;
import org.jetbrains.mps.openapi.util.Processor;
import jetbrains.mps.project.validation.ValidationProblem;

public class ModelPropertiesChecker extends SpecificChecker {
  public ModelPropertiesChecker() {
  }
  @Override
  public List<SearchResult<ModelCheckerIssue>> checkModel(final SModel model, ProgressMonitor monitor) {
    monitor.start("model properties", 1);

    final List<SearchResult<ModelCheckerIssue>> results = ListSequence.fromList(new ArrayList<SearchResult<ModelCheckerIssue>>());

    ValidationUtil.validateModel(model, new Processor<ValidationProblem>() {
      public boolean process(final ValidationProblem problem) {
        ListSequence.fromList(results).addElement(ModelCheckerIssue.getSearchResultForModel(model, problem.getMessage(), new IModelCheckerFix() {
          public boolean doFix() {
            if (!(problem.canFix())) {
              return false;
            }
            problem.fix();
            return true;
          }
        }, ModelChecker.SEVERITY_ERROR, "Model properties"));
        return true;
      }
    });
    monitor.done();
    return results;
  }
}
