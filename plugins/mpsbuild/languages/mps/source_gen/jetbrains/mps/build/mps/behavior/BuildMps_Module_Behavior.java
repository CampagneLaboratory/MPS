package jetbrains.mps.build.mps.behavior;

/*Generated by MPS */

import jetbrains.mps.smodel.SNode;
import jetbrains.mps.build.util.VisibleArtifacts;
import java.util.Set;
import java.util.LinkedHashSet;
import jetbrains.mps.build.mps.util.BuildModuleUtil;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.internal.collections.runtime.ISelector;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.List;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.ListSequence;

public class BuildMps_Module_Behavior {
  public static void init(SNode thisNode) {
  }

  public static Iterable<SNode> virtual_getDependencyTargets_841011766566205095(SNode thisNode, final VisibleArtifacts artifacts) {
    Set<SNode> modules = new LinkedHashSet<SNode>();
    Set<SNode> usedLanguages = new LinkedHashSet<SNode>();
    BuildModuleUtil.collectAllCompileTimeDependencies(thisNode, modules, usedLanguages);

    Iterable<SNode> requiredModules = Sequence.fromIterable(((Iterable<SNode>) modules)).concat(Sequence.fromIterable(((Iterable<SNode>) usedLanguages))).select(new ISelector<SNode, SNode>() {
      public SNode select(SNode it) {
        return SNodeOperations.as(artifacts.toOriginalNode(it), "jetbrains.mps.build.mps.structure.BuildMps_Module");
      }
    });
    List<SNode> result = new ArrayList<SNode>();
    for (SNode m : Sequence.fromIterable(requiredModules)) {
      if (SNodeOperations.getContainingRoot(m) == SNodeOperations.getContainingRoot(thisNode)) {
        continue;
      }

      SNode artifact = SNodeOperations.as(artifacts.findArtifact(m), "jetbrains.mps.build.structure.BuildLayout_Node");
      if (artifact != null) {
        ListSequence.fromList(result).addElement(artifact);
      }
    }
    Iterable<SNode> requiredJava = BuildModuleUtil.getRequiredJava(thisNode, modules).getModules();
    for (SNode jm : Sequence.fromIterable(requiredJava)) {
      if (SNodeOperations.getContainingRoot(jm) == SNodeOperations.getContainingRoot(thisNode)) {
        continue;
      }

      SNode artifact = SNodeOperations.as(artifacts.findArtifact(jm), "jetbrains.mps.build.structure.BuildLayout_Node");
      if (artifact != null) {
        ListSequence.fromList(result).addElement(artifact);
      }
    }

    if (ListSequence.fromList(result).isNotEmpty()) {
      artifacts.needsFetch(thisNode);
      return result;
    }
    return null;
  }
}
