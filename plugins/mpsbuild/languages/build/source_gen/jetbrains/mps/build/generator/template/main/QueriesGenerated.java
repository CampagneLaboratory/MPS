package jetbrains.mps.build.generator.template.main;

/*Generated by MPS */

import jetbrains.mps.smodel.IOperationContext;
import jetbrains.mps.generator.template.BaseMappingRuleContext;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.generator.template.PropertyMacroContext;
import jetbrains.mps.build.behavior.BuildLayout_Container_Behavior;
import jetbrains.mps.build.util.Context;
import jetbrains.mps.build.behavior.BuildLayout_NamedContainer_Behavior;
import jetbrains.mps.build.behavior.BuildLayout_Node_Behavior;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.build.behavior.BuildSourcePath_Behavior;
import jetbrains.mps.build.behavior.BuildString_Behavior;
import jetbrains.mps.smodel.SNode;
import jetbrains.mps.build.behavior.BuildProject_Behavior;
import jetbrains.mps.build.util.RelativePathHelper;
import org.apache.commons.lang.StringUtils;
import jetbrains.mps.build.util.MacroHelper;
import jetbrains.mps.baseLanguage.tuples.runtime.Tuples;
import jetbrains.mps.build.util.DependenciesHelper;
import jetbrains.mps.generator.template.ReferenceMacroContext;
import jetbrains.mps.generator.template.IfMacroContext;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.generator.template.SourceSubstituteMacroNodeContext;
import jetbrains.mps.build.util.JavaModulesClosure;
import jetbrains.mps.generator.template.TemplateQueryContext;
import jetbrains.mps.generator.template.SourceSubstituteMacroNodesContext;
import java.util.List;
import java.util.ArrayList;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import java.util.Collections;
import jetbrains.mps.lang.core.behavior.BaseConcept_Behavior;
import jetbrains.mps.generator.template.MappingScriptContext;
import jetbrains.mps.build.util.GenerationUtil;
import jetbrains.mps.build.generator.util.FetchDependenciesProcessor;
import jetbrains.mps.internal.collections.runtime.ISelector;
import jetbrains.mps.baseLanguage.tuples.runtime.MultiTuple;

public class QueriesGenerated {
  public static boolean baseMappingRule_Condition_5248329904288166450(final IOperationContext operationContext, final BaseMappingRuleContext _context) {
    return !(SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_ContainerAcceptingFileSet"));
  }

  public static boolean baseMappingRule_Condition_4701820937132270526(final IOperationContext operationContext, final BaseMappingRuleContext _context) {
    return !(SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_ContainerAcceptingFileSet"));
  }

  public static boolean baseMappingRule_Condition_6921160174096663332(final IOperationContext operationContext, final BaseMappingRuleContext _context) {
    return (SLinkOperations.getTarget(_context.getNode(), "defaultPath", true) == null);
  }

  public static boolean baseMappingRule_Condition_2591537044435952582(final IOperationContext operationContext, final BaseMappingRuleContext _context) {
    return SNodeOperations.isInstanceOf(SLinkOperations.getTarget(_context.getNode(), "module", false), "jetbrains.mps.build.structure.BuildSource_JavaModule");
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963267883(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getChildrenOutputDir_WithMacro_4701820937132344011(_context.getNode(), Context.defaultContext(_context));
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963268263(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(_context.getNode());
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963364006(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(_context.getNode());
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963358439(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getChildrenOutputDir_WithMacro_4701820937132344011(_context.getNode(), Context.defaultContext(_context));
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963358405(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(_context.getNode());
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963268231(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_NamedContainer_Behavior.call_getOutputPath_WithMacro_280273048052535414(_context.getNode(), Context.defaultContext(_context));
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963351294(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getChildrenOutputDir_WithMacro_4701820937132344011(_context.getNode(), Context.defaultContext(_context));
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963268242(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(_context.getNode());
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963358510(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getChildrenOutputDir_WithMacro_4701820937132344011(_context.getNode(), Context.defaultContext(_context));
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963358520(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(_context.getNode());
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963358535(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_NamedContainer_Behavior.call_getOutputPath_WithMacro_280273048052535414(_context.getNode(), Context.defaultContext(_context));
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963358569(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getChildrenOutputDir_WithMacro_4701820937132344011(_context.getNode(), Context.defaultContext(_context));
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963358598(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(_context.getNode());
  }

  public static Object propertyMacro_GetPropertyValue_2913098736709502287(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(_context.getNode());
  }

  public static Object propertyMacro_GetPropertyValue_2913098736709502392(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(_context.getNode());
  }

  public static Object propertyMacro_GetPropertyValue_5248329904288079307(final IOperationContext operationContext, final PropertyMacroContext _context) {
    if (!(SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"))) {
      _context.showErrorMessage(_context.getNode(), "parent should be layout container");
      return "???";
    }
    return BuildLayout_Container_Behavior.call_getChildrenOutputDir_WithMacro_4701820937132344011(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"), Context.defaultContext(_context));
  }

  public static Object propertyMacro_GetPropertyValue_5248329904288131577(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "copy." + _context.getNode().getId();
  }

  public static Object propertyMacro_GetPropertyValue_4701820937132270545(final IOperationContext operationContext, final PropertyMacroContext _context) {
    if (!(SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"))) {
      _context.showErrorMessage(_context.getNode(), "parent should be layout container");
      return "???";
    }
    String result = BuildLayout_Container_Behavior.call_getChildrenOutputDir_WithMacro_4701820937132344011(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"), Context.defaultContext(_context));
    if (BuildLayout_Node_Behavior.call_isFolder_1368030936106753980(SLinkOperations.getTarget(_context.getNode(), "target", false))) {
      String location = ((String) _context.getVariable("var:targetLocation"));
      int lastSlash = location.lastIndexOf('/');
      if (lastSlash >= 0) {
        result += location.substring(lastSlash);
      }
    }
    return result;
  }

  public static Object propertyMacro_GetPropertyValue_6547494638219491804(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return ((String) _context.getVariable("var:targetLocation"));
  }

  public static Object propertyMacro_GetPropertyValue_6547494638219491807(final IOperationContext operationContext, final PropertyMacroContext _context) {
    if (BuildLayout_Node_Behavior.call_isFile_1368030936106753986(SLinkOperations.getTarget(_context.getNode(), "target", false))) {
      return "file";
    }
    if (!(BuildLayout_Node_Behavior.call_isFolder_1368030936106753980(SLinkOperations.getTarget(_context.getNode(), "target", false)))) {
      _context.showErrorMessage(_context.getNode(), "cannot import abstract element, should be file or folder");
    }
    return "dir";
  }

  public static Object propertyMacro_GetPropertyValue_4701820937132270643(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "copy.artifacts." + _context.getNode().getId();
  }

  public static Object propertyMacro_GetPropertyValue_6921160174096729094(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return SPropertyOperations.getString(_context.getNode(), "name");
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963307392(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(_context.getNode(), "defaultPath", true));
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963307395(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return SPropertyOperations.getString(_context.getNode(), "name");
  }

  public static Object propertyMacro_GetPropertyValue_8237269006869516510(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return ((SLinkOperations.getTarget(_context.getNode(), "value", true) == null) ?
      "" :
      BuildString_Behavior.call_getText_4380385936562005550(SLinkOperations.getTarget(_context.getNode(), "value", true), Context.defaultContext(_context).getMacros(_context.getNode()))
    );
  }

  public static Object propertyMacro_GetPropertyValue_8237269006869516519(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return SPropertyOperations.getString(_context.getNode(), "name");
  }

  public static Object propertyMacro_GetPropertyValue_6420586245471622081(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return (SLinkOperations.getTarget(_context.getNode(), "value", true) == null);
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963346388(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return SPropertyOperations.getString(_context.getNode(), "name");
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963346427(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return Context.defaultContext(_context).getTempPath(_context.getNode(), SPropertyOperations.getString(_context.getNode(), "name"), "java", "out");
  }

  public static Object propertyMacro_GetPropertyValue_7926701909975671869(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildSource_JavaContentRoot"), "basePath", true)) + "/" + SPropertyOperations.getString(_context.getNode(), "relativePath");
  }

  public static Object propertyMacro_GetPropertyValue_6647099934207255538(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "java.library." + SPropertyOperations.getString(_context.getNode(), "name");
  }

  public static Object propertyMacro_GetPropertyValue_5248329904288079406(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(_context.getNode(), "dir", true));
  }

  public static Object propertyMacro_GetPropertyValue_7866279537988669079(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(_context.getNode(), "dir", true));
  }

  public static Object propertyMacro_GetPropertyValue_5248329904288079452(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(_context.getNode(), "path", true));
  }

  public static Object propertyMacro_GetPropertyValue_2303926226081012727(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(_context.getNode(), "path", true));
  }

  public static Object propertyMacro_GetPropertyValue_3717132724152837101(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(_context.getNode(), "path", true));
  }

  public static Object propertyMacro_GetPropertyValue_3717132724152837217(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(_context.getNode(), "dir", true));
  }

  public static Object propertyMacro_GetPropertyValue_5248329904288082868(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return SPropertyOperations.getString(_context.getNode(), "pattern");
  }

  public static Object propertyMacro_GetPropertyValue_8654221991637384417(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return SPropertyOperations.getString(_context.getNode(), "pattern");
  }

  public static Object propertyMacro_GetPropertyValue_5248329904288082882(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return SPropertyOperations.getString(_context.getNode(), "pattern");
  }

  public static Object propertyMacro_GetPropertyValue_4701820937132337491(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "layout." + SPropertyOperations.getString(_context.getNode(), "name");
  }

  public static Object propertyMacro_GetPropertyValue_5368511706901764962(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "${build.dir}/tmp/" + SPropertyOperations.getString(_context.getNode(), "name");
  }

  public static Object propertyMacro_GetPropertyValue_5368511706901764926(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "${build.dir}/artifacts/" + SPropertyOperations.getString(_context.getNode(), "name");
  }

  public static Object propertyMacro_GetPropertyValue_4129895186893528655(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "artifacts." + SPropertyOperations.getString(SLinkOperations.getTarget(SNodeOperations.cast(_context.getNode(), "jetbrains.mps.build.structure.BuildProjectDependency"), "script", false), "name");
  }

  public static Object propertyMacro_GetPropertyValue_4129895186893528776(final IOperationContext operationContext, final PropertyMacroContext _context) {
    if ((SLinkOperations.getTarget(SNodeOperations.cast(_context.getNode(), "jetbrains.mps.build.structure.BuildProjectDependency"), "artifacts", true) != null)) {
      return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(SNodeOperations.cast(_context.getNode(), "jetbrains.mps.build.structure.BuildProjectDependency"), "artifacts", true));
    }
    if (((String) _context.getVariable("var:basePath")) == null) {
      return ".";
    }
    SNode script = SLinkOperations.getTarget(SNodeOperations.cast(_context.getNode(), "jetbrains.mps.build.structure.BuildProjectDependency"), "script", false);
    String filePath = BuildProject_Behavior.call_getBasePath_4959435991187146924(script, Context.defaultContext(_context));
    if (filePath == null) {
      _context.showErrorMessage(script, "no base path for required script " + SPropertyOperations.getString(script, "name"));
      return ".";
    }
    try {
      String relative = new RelativePathHelper(((String) _context.getVariable("var:basePath"))).makeRelative(filePath);
      if (StringUtils.isEmpty(relative)) {
        return "${build.dir}/artifacts/" + SPropertyOperations.getString(script, "name");
      }
      if (!(relative.endsWith("/"))) {
        relative += "/";
      }
      return relative + "build/artifacts/" + SPropertyOperations.getString(script, "name");
    } catch (RelativePathHelper.PathException ex) {
      _context.showErrorMessage(_context.getNode(), "cannot calculate relative path: " + ex.getMessage());
      return ".";
    }
  }

  public static Object propertyMacro_GetPropertyValue_7181125477683419235(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "artifacts." + SPropertyOperations.getString(SLinkOperations.getTarget(SNodeOperations.cast(_context.getNode(), "jetbrains.mps.build.structure.BuildExternalLayoutDependency"), "layout", false), "name");
  }

  public static Object propertyMacro_GetPropertyValue_7181125477683419247(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(SNodeOperations.cast(_context.getNode(), "jetbrains.mps.build.structure.BuildExternalLayoutDependency"), "artifacts", true));
  }

  public static Object propertyMacro_GetPropertyValue_6520682027041002227(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "${artifacts." + SPropertyOperations.getString(SLinkOperations.getTarget(SNodeOperations.cast(_context.getNode(), "jetbrains.mps.build.structure.BuildProjectDependency"), "script", false), "name") + "}/variables.properties";
  }

  public static Object propertyMacro_GetPropertyValue_6520682027041002310(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return ((MacroHelper) _context.getVariable("var:macroHelper")).getPrefix(_context.getNode());
  }

  public static Object propertyMacro_GetPropertyValue_6520682027040940551(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return ((MacroHelper) _context.getVariable("var:macroHelper")).getName(_context.getNode());
  }

  public static Object propertyMacro_GetPropertyValue_6520682027041001064(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "${" + ((MacroHelper) _context.getVariable("var:macroHelper")).getImportName(_context.getNode()) + "}";
  }

  public static Object propertyMacro_GetPropertyValue_5662391463398094397(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "${build.layout}/variables.properties";
  }

  public static Object propertyMacro_GetPropertyValue_5662391463398078669(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return ((MacroHelper) _context.getVariable("var:macroHelper")).getExportName(_context.getNode()) + "=${" + ((MacroHelper) _context.getVariable("var:macroHelper")).getName(_context.getNode()) + "}";
  }

  public static Object propertyMacro_GetPropertyValue_6520682027041196886(final IOperationContext operationContext, final PropertyMacroContext _context) {
    if (((Tuples._2<Iterable<SNode>, String>) _context.getVariable("var:depsAndBasePath"))._1() == null) {
      return "?????";
    }
    SNode script = SLinkOperations.getTarget(_context.getNode(), "script", false);
    String filePath = BuildProject_Behavior.call_getScriptsPath_4796668409958419284(script, Context.defaultContext(_context));
    if (filePath == null) {
      _context.showErrorMessage(script, "no script path for required script " + SPropertyOperations.getString(script, "name"));
      return ".";
    }
    try {
      String relative = new RelativePathHelper(((Tuples._2<Iterable<SNode>, String>) _context.getVariable("var:depsAndBasePath"))._1()).makeRelative(filePath);
      if (StringUtils.isEmpty(relative)) {
        return SPropertyOperations.getString(script, "name") + ".xml";
      }
      if (!(relative.endsWith("/"))) {
        relative += "/";
      }
      return relative + SPropertyOperations.getString(script, "name") + ".xml";
    } catch (RelativePathHelper.PathException ex) {
      _context.showErrorMessage(_context.getNode(), "cannot calculate relative path: " + ex.getMessage());
      return "????";
    }
  }

  public static Object propertyMacro_GetPropertyValue_3595702787188242919(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return SPropertyOperations.getString(_context.getNode(), "name");
  }

  public static Object propertyMacro_GetPropertyValue_5096397858823409284(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return "${build.tmp}";
  }

  public static Object propertyMacro_GetPropertyValue_5178006408628664059(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return BuildProject_Behavior.call_getBasePathRelativeToScriptsPath_5178006408628632053(_context.getNode(), Context.defaultContext(_context));
  }

  public static Object propertyMacro_GetPropertyValue_1117643560963351184(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return Context.defaultContext(_context).getTempPath(SLinkOperations.getTarget(_context.getNode(), "module", false), SPropertyOperations.getString(SLinkOperations.getTarget(_context.getNode(), "module", false), "name"), "java", "out");
  }

  public static Object propertyMacro_GetPropertyValue_5979287180587467412(final IOperationContext operationContext, final PropertyMacroContext _context) {
    return _context.getNode().getProperty("pathValue");
  }

  public static Object propertyMacro_GetPropertyValue_4821808014881207505(final IOperationContext operationContext, final PropertyMacroContext _context) {
    SNode project = SNodeOperations.getAncestor(_context.getNode(), "jetbrains.mps.build.structure.BuildProject", false, false);
    if (project == null) {
      _context.showErrorMessage(_context.getNode(), "no context project defined");
      return "???";
    }
    DependenciesHelper helper = new DependenciesHelper(_context, project);
    SNode layoutNode = helper.artifacts().get(DependenciesHelper.getOriginalNode(((SNode) _context.getVariable("module")), _context));
    if (layoutNode == null) {
      _context.showErrorMessage(_context.getNode(), "java module " + SPropertyOperations.getString(((SNode) _context.getVariable("module")), "name") + " was not found in the layout");
      return "???";
    }
    String val = helper.locations().get(layoutNode);
    if (val == null) {
      _context.showErrorMessage(_context.getNode(), "no location for java module " + SPropertyOperations.getString(((SNode) _context.getVariable("module")), "name"));
      return "???";
    }
    return val;
  }

  public static Object propertyMacro_GetPropertyValue_8169228734285529581(final IOperationContext operationContext, final PropertyMacroContext _context) {
    if (SNodeOperations.getContainingRoot(((SNode) _context.getVariable("jar"))) == SNodeOperations.getContainingRoot(_context.getNode())) {
      return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(((SNode) _context.getVariable("jar")), "path", true));
    }
    SNode project = SNodeOperations.getAncestor(_context.getNode(), "jetbrains.mps.build.structure.BuildProject", false, false);
    if (project == null) {
      _context.showErrorMessage(_context.getNode(), "no context project defined");
      return "???";
    }
    DependenciesHelper helper = new DependenciesHelper(_context, project);
    SNode layoutNode = helper.artifacts().get(DependenciesHelper.getOriginalNode(SLinkOperations.getTarget(((SNode) _context.getVariable("jar")), "path", true), _context));
    if (layoutNode == null) {
      _context.showErrorMessage(_context.getNode(), "file " + BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(((SNode) _context.getVariable("jar")), "path", true)) + " was not found in the layout");
      return "???";
    }
    String val = helper.locations().get(layoutNode);
    if (val == null) {
      _context.showErrorMessage(_context.getNode(), "no location for jar " + BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(SLinkOperations.getTarget(((SNode) _context.getVariable("jar")), "path", true)));
      return "???";
    }
    return val;
  }

  public static Object propertyMacro_GetPropertyValue_6859736767834590113(final IOperationContext operationContext, final PropertyMacroContext _context) {
    if (SNodeOperations.getContainingRoot(((SNode) _context.getVariable("jar"))) == SNodeOperations.getContainingRoot(_context.getNode())) {
      return BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(((SNode) _context.getVariable("jar")));
    }
    SNode project = SNodeOperations.getAncestor(_context.getNode(), "jetbrains.mps.build.structure.BuildProject", false, false);
    if (project == null) {
      _context.showErrorMessage(_context.getNode(), "no context project defined");
      return "???";
    }
    DependenciesHelper helper = new DependenciesHelper(_context, project);
    SNode layoutNode = helper.artifacts().get(DependenciesHelper.getOriginalNode(((SNode) _context.getVariable("jar")), _context));
    if (layoutNode == null) {
      _context.showErrorMessage(_context.getNode(), "file " + BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(((SNode) _context.getVariable("jar"))) + " was not found in the layout");
      return "???";
    }
    String val = helper.locations().get(layoutNode);
    if (val == null) {
      _context.showErrorMessage(_context.getNode(), "no location for jar " + BuildSourcePath_Behavior.call_getRelativePath_5481553824944787371(((SNode) _context.getVariable("jar"))));
      return "???";
    }
    return val;
  }

  public static Object referenceMacro_GetReferent_1117643560963363815(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_1117643560963363967(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_1117643560963360514(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_1117643560963363928(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_1117643560963363847(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_1117643560963363898(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_2913098736709502314(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_2913098736709502421(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_5248329904288129346(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_5248329904288129316(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_4701820937132270603(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_4701820937132270633(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container"));
  }

  public static Object referenceMacro_GetReferent_4821808014881173680(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return _context.getOutputNodeByInputNodeAndMappingLabel(((SNode) _context.getVariable("library")), "javalibrary");
  }

  public static Object referenceMacro_GetReferent_4821808014881207365(final IOperationContext operationContext, final ReferenceMacroContext _context) {
    return _context.getOutputNodeByInputNodeAndMappingLabel(((SNode) _context.getVariable("module")), "javamodule");
  }

  public static boolean ifMacro_Condition_1117643560963363812(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_1117643560963363971(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_1117643560963369195(final IOperationContext operationContext, final IfMacroContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "children", true)).any(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return !(SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildLayout_FileSet"));
      }
    });
  }

  public static boolean ifMacro_Condition_1117643560963359504(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_1117643560963351259(final IOperationContext operationContext, final IfMacroContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "children", true)).any(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return !(SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildLayout_FileSet"));
      }
    });
  }

  public static boolean ifMacro_Condition_1117643560963363924(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_1117643560963369175(final IOperationContext operationContext, final IfMacroContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "children", true)).any(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return !(SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildLayout_FileSet"));
      }
    });
  }

  public static boolean ifMacro_Condition_1117643560963363844(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_1117643560963358578(final IOperationContext operationContext, final IfMacroContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "children", true)).any(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return !(SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildLayout_FileSet"));
      }
    });
  }

  public static boolean ifMacro_Condition_1117643560963363876(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_2913098736709502295(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_2913098736709502402(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_5248329904288129327(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_5248329904288129297(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_4701820937132270584(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getPrepareSubTaskId_4701820937132344041(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_4701820937132270614(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.isInstanceOf(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container") && BuildLayout_Container_Behavior.call_getAssembleSubTaskId_4701820937132344052(SNodeOperations.cast(SNodeOperations.getParent(_context.getNode()), "jetbrains.mps.build.structure.BuildLayout_Container")) != null;
  }

  public static boolean ifMacro_Condition_6520682027041189779(final IOperationContext operationContext, final IfMacroContext _context) {
    return new DependenciesHelper(_context, SNodeOperations.getAncestor(_context.getNode(), "jetbrains.mps.build.structure.BuildProject", false, false)).requiresFetch().containsKey(_context.getOriginalCopiedInputNode(_context.getNode()));
  }

  public static boolean ifMacro_Condition_6520682027040886838(final IOperationContext operationContext, final IfMacroContext _context) {
    Iterable<SNode> s = (Iterable<SNode>) ((MacroHelper) _context.getVariable("var:macroHelper")).getMacrosToExport();
    return Sequence.fromIterable(s).isNotEmpty();
  }

  public static boolean ifMacro_Condition_6520682027041156330(final IOperationContext operationContext, final IfMacroContext _context) {
    return new DependenciesHelper(_context, _context.getNode()).requiresFetch().containsKey(_context.getOriginalCopiedInputNode(SLinkOperations.getTarget(_context.getNode(), "layout", true)));
  }

  public static boolean ifMacro_Condition_6520682027041201801(final IOperationContext operationContext, final IfMacroContext _context) {
    return Sequence.fromIterable(((Tuples._2<Iterable<SNode>, String>) _context.getVariable("var:depsAndBasePath"))._0()).isNotEmpty();
  }

  public static boolean ifMacro_Condition_5979287180587467645(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.getContainingRoot(_context.getNode()) != SNodeOperations.getContainingRoot(((SNode) _context.getVariable("library")));
  }

  public static boolean ifMacro_Condition_4821808014881207369(final IOperationContext operationContext, final IfMacroContext _context) {
    return SNodeOperations.getContainingRoot(_context.getNode()) == SNodeOperations.getContainingRoot(((SNode) _context.getVariable("module")));
  }

  public static SNode sourceNodeQuery_5248329904288175557(final IOperationContext operationContext, final SourceSubstituteMacroNodeContext _context) {
    return SLinkOperations.getTarget(_context.getNode(), "fileset", true);
  }

  public static SNode sourceNodeQuery_4821808014881265837(final IOperationContext operationContext, final SourceSubstituteMacroNodeContext _context) {
    return ((JavaModulesClosure) _context.getVariable("var:dependenciesClosure")).getInitial();
  }

  public static SNode sourceNodeQuery_8169228734285529873(final IOperationContext operationContext, final SourceSubstituteMacroNodeContext _context) {
    return ((JavaModulesClosure) _context.getVariable("var:dependenciesClosure")).getInitial();
  }

  public static SNode sourceNodeQuery_6859736767834590341(final IOperationContext operationContext, final SourceSubstituteMacroNodeContext _context) {
    return ((JavaModulesClosure) _context.getVariable("var:dependenciesClosure")).getInitial();
  }

  public static SNode sourceNodeQuery_4821808014881265914(final IOperationContext operationContext, final SourceSubstituteMacroNodeContext _context) {
    return ((JavaModulesClosure) _context.getVariable("var:dependenciesClosure")).getInitial();
  }

  public static SNode sourceNodeQuery_1500819558096269424(final IOperationContext operationContext, final SourceSubstituteMacroNodeContext _context) {
    return SLinkOperations.getTarget(_context.getNode(), "resset", true);
  }

  public static SNode sourceNodeQuery_3717132724152951510(final IOperationContext operationContext, final SourceSubstituteMacroNodeContext _context) {
    return SLinkOperations.getTarget(_context.getNode(), "classpath", true);
  }

  public static SNode sourceNodeQuery_3717132724153138073(final IOperationContext operationContext, final SourceSubstituteMacroNodeContext _context) {
    return SLinkOperations.getTarget(_context.getNode(), "jars", true);
  }

  public static SNode sourceNodeQuery_5248329904288140540(final IOperationContext operationContext, final SourceSubstituteMacroNodeContext _context) {
    return SLinkOperations.getTarget(_context.getNode(), "fileset", true);
  }

  public static Object templateArgumentQuery_4821808014881251890(final IOperationContext operationContext, final TemplateQueryContext _context) {
    return (SNode) _context.getNode().getReferent("targetModule");
  }

  public static Object templateArgumentQuery_8169228734285529871(final IOperationContext operationContext, final TemplateQueryContext _context) {
    return (SNode) _context.getNode().getReferent("targetJar");
  }

  public static Object templateArgumentQuery_6859736767834590331(final IOperationContext operationContext, final TemplateQueryContext _context) {
    return SLinkOperations.getTarget(((SNode) _context.getNode().getReferent("targetJar")), "path", true);
  }

  public static Object templateArgumentQuery_4821808014881251899(final IOperationContext operationContext, final TemplateQueryContext _context) {
    return (SNode) _context.getNode().getReferent("targetLibrary");
  }

  public static Object templateArgumentQuery_4821808014881175180(final IOperationContext operationContext, final TemplateQueryContext _context) {
    return SLinkOperations.getTarget(_context.getNode(), "library", false);
  }

  public static Object templateArgumentQuery_4821808014881207678(final IOperationContext operationContext, final TemplateQueryContext _context) {
    return SLinkOperations.getTarget(_context.getNode(), "module", false);
  }

  public static Object templateArgumentQuery_8169228734285538410(final IOperationContext operationContext, final TemplateQueryContext _context) {
    return SLinkOperations.getTarget(_context.getNode(), "jar", true);
  }

  public static Object templateArgumentQuery_6859736767834590236(final IOperationContext operationContext, final TemplateQueryContext _context) {
    return SLinkOperations.getTarget(SLinkOperations.getTarget(_context.getNode(), "jar", false), "path", true);
  }

  public static Iterable sourceNodesQuery_1117643560963351248(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "children", true)).where(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildLayout_FileSet");
      }
    });
  }

  public static Iterable sourceNodesQuery_1117643560963358547(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "children", true)).where(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildLayout_FileSet");
      }
    });
  }

  public static Iterable sourceNodesQuery_7926701909975671841(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return SLinkOperations.getTargets(_context.getNode(), "sources", true);
  }

  public static Iterable sourceNodesQuery_5979287180587467230(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    List<SNode> result = new ArrayList<SNode>();
    for (SNode module : ((JavaModulesClosure) _context.getVariable("var:dependenciesClosure")).getModules()) {
      SNode loopnode = SModelOperations.createNewNode(_context.getOutputModel(), "jetbrains.mps.lang.core.structure.BaseConcept", null);
      loopnode.setReferent("targetModule", module, false);
      ListSequence.fromList(result).addElement(loopnode);
    }
    return result;
  }

  public static Iterable sourceNodesQuery_8169228734285529277(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    List<SNode> result = new ArrayList<SNode>();
    for (SNode jar : ((JavaModulesClosure) _context.getVariable("var:dependenciesClosure")).getJars()) {
      SNode loopnode = SModelOperations.createNewNode(_context.getOutputModel(), "jetbrains.mps.lang.core.structure.BaseConcept", null);
      loopnode.setReferent("targetJar", jar, false);
      ListSequence.fromList(result).addElement(loopnode);
    }
    return result;
  }

  public static Iterable sourceNodesQuery_6859736767834590289(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    List<SNode> result = new ArrayList<SNode>();
    for (SNode jar : ((JavaModulesClosure) _context.getVariable("var:dependenciesClosure")).getImportedJars()) {
      SNode loopnode = SModelOperations.createNewNode(_context.getOutputModel(), "jetbrains.mps.lang.core.structure.BaseConcept", null);
      loopnode.setReferent("targetJar", jar, false);
      ListSequence.fromList(result).addElement(loopnode);
    }
    return result;
  }

  public static Iterable sourceNodesQuery_5979287180587467321(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    List<SNode> result = new ArrayList<SNode>();
    for (SNode library : ((JavaModulesClosure) _context.getVariable("var:dependenciesClosure")).getLibraries()) {
      SNode loopnode = SModelOperations.createNewNode(_context.getOutputModel(), "jetbrains.mps.lang.core.structure.BaseConcept", null);
      loopnode.setReferent("targetLibrary", library, false);
      ListSequence.fromList(result).addElement(loopnode);
    }
    return result;
  }

  public static Iterable sourceNodesQuery_6647099934207033969(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "dependencies", true)).where(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return !(SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildSource_JavaDependencyLibrary")) && !(SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildSource_JavaDependencyModule")) && !(SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildSource_JavaDependencyJar")) && !(SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildSource_JavaDependencyImportedJar"));
      }
    });
  }

  public static Iterable sourceNodesQuery_7926701909975671863(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "folders", true)).where(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return SPropertyOperations.hasValue(it, "kind", "source", null);
      }
    });
  }

  public static Iterable sourceNodesQuery_6647099934207253927(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return SLinkOperations.getTargets(_context.getNode(), "elements", true);
  }

  public static Iterable sourceNodesQuery_8654221991637384265(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "selectors", true)).where(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildFileSelectorInAttribute");
      }
    });
  }

  public static Iterable sourceNodesQuery_5248329904288079434(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "selectors", true)).where(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return !(SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildFileSelectorInAttribute"));
      }
    });
  }

  public static Iterable sourceNodesQuery_8654221991637384349(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "selectors", true)).where(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildFileSelectorInAttribute");
      }
    });
  }

  public static Iterable sourceNodesQuery_7866279537988669091(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "selectors", true)).where(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return !(SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildFileSelectorInAttribute"));
      }
    });
  }

  public static Iterable sourceNodesQuery_4701820937132337458(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return SLinkOperations.getTargets(_context.getNode(), "parts", true);
  }

  public static Iterable sourceNodesQuery_4701820937132337542(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return SNodeOperations.getDescendants(_context.getNode(), "jetbrains.mps.build.structure.BuildLayout_Node", false, new String[]{});
  }

  public static Iterable sourceNodesQuery_1117643560963307378(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return SLinkOperations.getTargets(_context.getNode(), "macros", true);
  }

  public static Iterable sourceNodesQuery_4129895186893528610(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "dependencies", true)).where(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildProjectDependency");
      }
    });
  }

  public static Iterable sourceNodesQuery_7181125477683419217(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "dependencies", true)).where(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildExternalLayoutDependency");
      }
    });
  }

  public static Iterable sourceNodesQuery_6520682027041002163(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return (Iterable<SNode>) ((MacroHelper) _context.getVariable("var:macroHelper")).getVarsContainers();
  }

  public static Iterable sourceNodesQuery_6520682027040940372(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return (Iterable<SNode>) ((MacroHelper) _context.getVariable("var:macroHelper")).getMacrosToImport();
  }

  public static Iterable sourceNodesQuery_6647099934206970618(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return SLinkOperations.getTargets(_context.getNode(), "plugins", true);
  }

  public static Iterable sourceNodesQuery_1117643560963346309(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return SLinkOperations.getTargets(_context.getNode(), "parts", true);
  }

  public static Iterable sourceNodesQuery_4701820937132337365(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return SLinkOperations.getTargets(_context.getNode(), "aspects", true);
  }

  public static Iterable sourceNodesQuery_1117643560963267906(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return SNodeOperations.getDescendants(SLinkOperations.getTarget(_context.getNode(), "layout", true), "jetbrains.mps.build.structure.BuildLayout_Node", false, new String[]{});
  }

  public static Iterable sourceNodesQuery_5662391463398047139(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return (Iterable<SNode>) ((MacroHelper) _context.getVariable("var:macroHelper")).getMacrosToExport();
  }

  public static Iterable sourceNodesQuery_6520682027041196812(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return ((Tuples._2<Iterable<SNode>, String>) _context.getVariable("var:depsAndBasePath"))._0();
  }

  public static Iterable sourceNodesQuery_6647099934206970591(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    return SLinkOperations.getTargets(_context.getNode(), "plugins", true);
  }

  public static Iterable sourceNodesQuery_5979287180587467422(final IOperationContext operationContext, final SourceSubstituteMacroNodesContext _context) {
    SNode project = SNodeOperations.getAncestor(_context.getNode(), "jetbrains.mps.build.structure.BuildProject", false, false);
    if (project == null) {
      _context.showErrorMessage(_context.getNode(), "no context project defined");
      return Collections.emptyList();
    }
    DependenciesHelper helper = new DependenciesHelper(_context, project);
    SNode layoutNode = helper.artifacts().get(DependenciesHelper.getOriginalNode(((SNode) _context.getVariable("library")), _context));
    if (layoutNode == null) {
      _context.showErrorMessage(_context.getNode(), "java library " + SPropertyOperations.getString(((SNode) _context.getVariable("library")), "name") + " was not found in the layout");
      return Collections.emptyList();
    }
    Iterable<SNode> input;
    if (SNodeOperations.isInstanceOf(layoutNode, "jetbrains.mps.build.structure.BuildLayout_ExportAsJavaLibrary")) {
      input = SLinkOperations.getTargets(SNodeOperations.cast(layoutNode, "jetbrains.mps.build.structure.BuildLayout_ExportAsJavaLibrary"), "children", true);
    } else {
      input = Sequence.<SNode>singleton(layoutNode);
    }
    List<SNode> result = new ArrayList<SNode>();
    for (SNode pe : input) {
      String val = helper.locations().get(pe);
      if (val == null) {
        _context.showErrorMessage(pe, "no location for " + BaseConcept_Behavior.call_getPresentation_1213877396640(pe) + " (unsupported layout element)");
        continue;
      }
      SNode propertyNode = SModelOperations.createNewNode(_context.getOutputModel(), "jetbrains.mps.lang.core.structure.BaseConcept", null);
      propertyNode.setProperty("pathValue", val);
      ListSequence.fromList(result).addElement(propertyNode);
    }
    return result;
  }

  public static void mappingScript_CodeBlock_809559803149973643(final IOperationContext operationContext, final MappingScriptContext _context) {
    for (SNode buildProject : ListSequence.fromList(SModelOperations.getRoots(_context.getModel(), "jetbrains.mps.build.structure.BuildProject"))) {
      buildProject.putUserObject(GenerationUtil.SCRIPTS_DIR_PROPERTY, BuildProject_Behavior.call_getScriptsPath_4796668409958419284(buildProject, Context.defaultContext(_context)));
    }
  }

  public static void mappingScript_CodeBlock_841011766566205060(final IOperationContext operationContext, final MappingScriptContext _context) {
    for (SNode root : SModelOperations.getRoots(_context.getModel(), "jetbrains.mps.build.structure.BuildProject")) {
      if (!(_context.isDirty(root))) {
        continue;
      }

      new FetchDependenciesProcessor(root, _context).process();
    }
  }

  public static Object insertMacro_varValue_7517237557345560699(final IOperationContext operationContext, final TemplateQueryContext _context) {
    SNode project = SNodeOperations.getAncestor(_context.getNode(), "jetbrains.mps.build.structure.BuildProject", false, false);
    if (project == null) {
      _context.showErrorMessage(_context.getNode(), "no context project defined");
      return "???";
    }
    DependenciesHelper helper = new DependenciesHelper(_context, project);
    String val = helper.locations().get(DependenciesHelper.getOriginalNode(SLinkOperations.getTarget(_context.getNode(), "target", false), _context));
    if (val == null) {
      _context.showErrorMessage(_context.getNode(), "no location for " + BaseConcept_Behavior.call_getPresentation_1213877396640(SLinkOperations.getTarget(_context.getNode(), "target", false)));
    }
    return val;
  }

  public static Object insertMacro_varValue_5979287180587467220(final IOperationContext operationContext, final TemplateQueryContext _context) {
    return new JavaModulesClosure(_context, _context.getNode()).closure(false);
  }

  public static Object insertMacro_varValue_4129895186893528603(final IOperationContext operationContext, final TemplateQueryContext _context) {
    String basePath = BuildProject_Behavior.call_getBasePath_4959435991187146924(_context.getNode(), Context.defaultContext(_context));
    if (basePath == null) {
      _context.showErrorMessage(_context.getNode(), "no base path for script " + SPropertyOperations.getString(_context.getNode(), "name"));
    }
    return basePath;
  }

  public static Object insertMacro_varValue_6520682027041193831(final IOperationContext operationContext, final TemplateQueryContext _context) {
    Iterable<SNode> list = ListSequence.fromList(SLinkOperations.getTargets(_context.getNode(), "dependencies", true)).where(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return SNodeOperations.isInstanceOf(it, "jetbrains.mps.build.structure.BuildProjectDependency") && (SLinkOperations.getTarget(SNodeOperations.cast(it, "jetbrains.mps.build.structure.BuildProjectDependency"), "artifacts", true) == null) && !(BuildProject_Behavior.call_isPackaged_4129895186893455885(SLinkOperations.getTarget(SNodeOperations.cast(it, "jetbrains.mps.build.structure.BuildProjectDependency"), "script", false), Context.defaultContext(_context)));
      }
    }).select(new ISelector<SNode, SNode>() {
      public SNode select(SNode it) {
        return SNodeOperations.cast(it, "jetbrains.mps.build.structure.BuildProjectDependency");
      }
    });
    String basePath = BuildProject_Behavior.call_getBasePath_4959435991187146924(_context.getNode(), Context.defaultContext(_context));
    return MultiTuple.<Iterable<SNode>,String>from(list, basePath);
  }

  public static Object insertMacro_varValue_6520682027040940450(final IOperationContext operationContext, final TemplateQueryContext _context) {
    return new MacroHelper.MacroContext(_context.getNode(), _context).getMacros(_context.getNode());
  }
}
