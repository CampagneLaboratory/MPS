package jetbrains.mps.ide.java.platform.index;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.smodel.SModelReference;
import jetbrains.mps.smodel.SModelDescriptor;
import jetbrains.mps.smodel.SModelRepository;
import jetbrains.mps.smodel.SNodeId;
import org.jetbrains.mps.openapi.model.SReference;

public class GlobalSNodeId {
  private String myModelReference;
  private String myNodeId;

  public GlobalSNodeId(SNode node) {
    this(SNodeOperations.getModel(node).getReference().toString(), node.getNodeId().toString());
  }

  public GlobalSNodeId(String modelReference, String nodeId) {
    assert modelReference != null;
    assert nodeId != null;
    myModelReference = modelReference;
    myNodeId = nodeId;
  }

  public SNode getNode() {
    SModelReference sModelReference = SModelReference.fromString(getModelReference());
    SModelDescriptor sModelDescriptor = SModelRepository.getInstance().getModelDescriptor(sModelReference);
    return (sModelDescriptor == null ?
      null :
      sModelDescriptor.getSModel().getNode(SNodeId.fromString(getNodeId()))
    );
  }

  @Override
  public int hashCode() {
    return getNodeId().hashCode();
  }

  @Override
  public boolean equals(Object other) {
    if (other instanceof GlobalSNodeId) {
      GlobalSNodeId otherNodeId = (GlobalSNodeId) other;
      return getModelReference().equals(otherNodeId.getModelReference()) && getNodeId().equals(otherNodeId.getNodeId());
    }
    return false;
  }

  public final String getModelReference() {
    return myModelReference;
  }

  public final String getNodeId() {
    return myNodeId;
  }

  public static GlobalSNodeId createSNodeId(SReference reference) {
    SModelReference modelReference = null;
    org.jetbrains.mps.openapi.model.SNodeId nodeId = null;
    if (reference == null || (modelReference = reference.getTargetSModelReference()) == null || (nodeId = reference.getTargetNodeId()) == null) {
      return null;
    }
    return new GlobalSNodeId(modelReference.toString(), nodeId.toString());
  }
}
