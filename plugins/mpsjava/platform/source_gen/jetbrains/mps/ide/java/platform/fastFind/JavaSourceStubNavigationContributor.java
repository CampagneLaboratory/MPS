package jetbrains.mps.ide.java.platform.fastFind;

/*Generated by MPS */

import jetbrains.mps.extapi.persistence.indexing.NodeNavigationContributor;
import com.intellij.openapi.components.ApplicationComponent;
import java.util.Collection;
import jetbrains.mps.extapi.persistence.indexing.NodeDescriptor;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.project.Project;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.internal.collections.runtime.CollectionSequence;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.Sequence;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.model.SNodeReference;
import jetbrains.mps.smodel.SNodePointer;
import jetbrains.mps.extapi.persistence.indexing.FastGoToRegistry;
import org.jetbrains.annotations.NonNls;
import org.jetbrains.annotations.NotNull;

public class JavaSourceStubNavigationContributor implements NodeNavigationContributor, ApplicationComponent {
  public JavaSourceStubNavigationContributor() {
  }

  @Override
  public Collection<NodeDescriptor> getNodeDescriptors(final Collection<SModel> collection, Project project) {
    List<NodeDescriptor> nodes = ListSequence.fromList(new ArrayList<NodeDescriptor>());

    for (SModel model : CollectionSequence.fromCollection(collection)) {
      for (SNode root : Sequence.fromIterable(model.getRootNodes())) {
        final String name = root.getName();

        if (name == null || "".equals(name)) {
          continue;
        }
        if (!(root instanceof SNode)) {
          continue;
        }

        final SNode rootNode = root;

        ListSequence.fromList(nodes).addElement(new NodeDescriptor() {
          @Override
          public String getName() {
            return name;
          }

          @Override
          public SConcept getConcept() {
            return rootNode.getConcept();
          }

          @Override
          public SNodeReference getNodeReference() {
            return new SNodePointer((SNode) rootNode);
          }
        });
      }
    }

    return nodes;
  }

  @Override
  public void initComponent() {
    FastGoToRegistry.getInstance().setNavigationContributor("java_source_stubs", this);
  }

  @Override
  public void disposeComponent() {
    FastGoToRegistry.getInstance().setNavigationContributor("java_source_stubs", null);
  }

  @NonNls
  @NotNull
  @Override
  public String getComponentName() {
    return "Java source stubs navigation contributor";
  }
}
