package jetbrains.mps.ide.devkit.actions;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.IntentionActionsProvider;
import org.jetbrains.annotations.NotNull;
import com.intellij.openapi.actionSystem.AnAction;
import jetbrains.mps.intentions.IntentionExecutable;
import javax.swing.Icon;
import jetbrains.mps.workbench.action.BaseAction;
import com.intellij.openapi.actionSystem.AnActionEvent;
import java.util.Map;
import jetbrains.mps.smodel.ModelAccess;
import jetbrains.mps.smodel.IOperationContext;
import jetbrains.mps.ide.actions.MPSCommonDataKeys;
import org.jetbrains.mps.openapi.model.SNodeReference;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.smodel.MPSModuleRepository;
import com.intellij.openapi.ui.Messages;
import jetbrains.mps.ide.project.ProjectHelper;
import jetbrains.mps.openapi.navigation.NavigationSupport;
import jetbrains.mps.intentions.IntentionsManager;

public class IntentionActionsProviderImpl implements IntentionActionsProvider {
  @NotNull
  public AnAction[] getIntentionActions(@NotNull final IntentionExecutable intention) {
    Icon icon = intention.getDescriptor().getType().getIcon();

    AnAction[] actions = {new BaseAction("Go to Intention Declaration", "Go to declaration of this intention", icon) {
      @Override
      protected void doExecute(final AnActionEvent e, Map<String, Object> params) {
        ModelAccess.instance().runWriteInEDT(new Runnable() {
          public void run() {
            IOperationContext context = e.getData(MPSCommonDataKeys.OPERATION_CONTEXT);
            SNodeReference nodeRef = intention.getDescriptor().getIntentionNodeReference();
            SNode intentionNode = (nodeRef == null ? null : nodeRef.resolve(MPSModuleRepository.getInstance()));
            if (intentionNode == null) {
              Messages.showErrorDialog(ProjectHelper.toIdeaProject(context.getProject()), "Could not find declaration for " + intention.getClass().getSimpleName() + " intention (" + intention.getClass().getName() + ")", "Intention Declaration");
            } else {
              NavigationSupport.getInstance().openNode(context, intentionNode, true, true);
              NavigationSupport.getInstance().selectInTree(context, intentionNode, false);
            }
          }
        });
      }
    }, new BaseAction("Disable This Intention", "Disables this intention type", icon) {
      @Override
      protected void doExecute(AnActionEvent e, Map<String, Object> params) {
        IntentionsManager.getInstance().disableIntention(intention.getDescriptor().getPersistentStateKey());
      }
    }};

    return actions;
  }
}
