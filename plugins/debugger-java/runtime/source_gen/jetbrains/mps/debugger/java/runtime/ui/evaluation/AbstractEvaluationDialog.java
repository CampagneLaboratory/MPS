package jetbrains.mps.debugger.java.runtime.ui.evaluation;

/*Generated by MPS */

import com.intellij.openapi.ui.DialogWrapper;
import jetbrains.mps.debugger.java.runtime.evaluation.EvaluationProvider;
import jetbrains.mps.debugger.java.runtime.state.SessionStopDisposer;
import jetbrains.mps.smodel.IOperationContext;
import jetbrains.mps.debugger.java.runtime.evaluation.container.IEvaluationContainer;
import jetbrains.mps.ide.project.ProjectHelper;
import jetbrains.mps.debugger.java.runtime.state.DebugSession;
import java.awt.Dimension;
import com.intellij.openapi.application.ApplicationManager;
import javax.swing.JComponent;
import org.jetbrains.annotations.Nullable;

public abstract class AbstractEvaluationDialog extends DialogWrapper {
  protected final EvaluationProvider myProvider;
  protected final EvaluationPanel myEvaluationPanel;
  private final SessionStopDisposer mySessionStopDisposer;

  public AbstractEvaluationDialog(IOperationContext context, EvaluationProvider provider, IEvaluationContainer model, String title) {
    super(ProjectHelper.toIdeaProject(context.getProject()));
    setTitle(title);

    setModal(false);

    myProvider = provider;
    final DebugSession debugSession = provider.getDebugSession();
    myEvaluationPanel = new EvaluationPanel(ProjectHelper.toIdeaProject(context.getProject()), debugSession, model, false);
    myEvaluationPanel.setMinimumSize(new Dimension(500, 500));
    myEvaluationPanel.setErrorTextListener(new EvaluationUi.IErrorTextListener() {
      public void updateErrorText(String text) {
        setErrorText(text);
      }
    });

    mySessionStopDisposer = new SessionStopDisposer(debugSession) {
      public void doDispose() {
        ApplicationManager.getApplication().invokeLater(new Runnable() {
          public void run() {
            dispose();
          }
        });
      }
    };

    init();
  }

  protected JComponent getMainComponent() {
    return myEvaluationPanel;
  }

  @Nullable
  protected JComponent createCenterPanel() {
    return myEvaluationPanel;
  }

  @Override
  protected void dispose() {
    ApplicationManager.getApplication().assertIsDispatchThread();
    super.dispose();
    myEvaluationPanel.dispose();
  }
}
