package jetbrains.mps.baseLanguage.unitTest.typesystem;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.project.IModule;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.smodel.behaviour.BehaviorReflection;
import jetbrains.mps.project.Solution;
import jetbrains.mps.project.structure.modules.SolutionKind;
import jetbrains.mps.project.structure.modules.SolutionDescriptor;
import jetbrains.mps.smodel.SModelInternal;
import org.jetbrains.mps.openapi.model.SModel;

public class CheckUtils {
  private CheckUtils() {
  }



  public static boolean checkPluginKindForMPSTestCase(SNode testCase) {
    IModule module = check_c4dr2s_a0a0c(check_c4dr2s_a0a0a2(SNodeOperations.getModel(testCase)));
    if (BehaviorReflection.invokeVirtual(Boolean.TYPE, testCase, "virtual_isMpsStartRequired_3310779261129403089", new Object[]{})) {
      return module instanceof Solution && ((Solution) module).getModuleDescriptor().getKind() != SolutionKind.NONE;
    } else {
      return true;
    }
  }



  public static boolean fixPluginKindForMPSTestCase(SNode testCase) {
    if (checkPluginKindForMPSTestCase(testCase)) {
      // fix is successful 
      return true;
    }

    IModule module = check_c4dr2s_a0c0e(check_c4dr2s_a0a2a4(SNodeOperations.getModel(testCase)));
    if (module instanceof Solution) {
      SolutionDescriptor descriptor = ((Solution) module).getModuleDescriptor();
      // todo: PLUGIN_OTHER ? 
      // todo: set changed ? 
      descriptor.setKind(SolutionKind.PLUGIN_OTHER);
      module.setChanged();
      return true;
    } else {
      // todo: ? 
      return false;
    }
  }

  private static IModule check_c4dr2s_a0a0c(SModelInternal checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getModule();
    }
    return null;
  }

  private static SModelInternal check_c4dr2s_a0a0a2(SModel checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getModelDescriptor();
    }
    return null;
  }

  private static IModule check_c4dr2s_a0c0e(SModelInternal checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getModule();
    }
    return null;
  }

  private static SModelInternal check_c4dr2s_a0a2a4(SModel checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getModelDescriptor();
    }
    return null;
  }
}
