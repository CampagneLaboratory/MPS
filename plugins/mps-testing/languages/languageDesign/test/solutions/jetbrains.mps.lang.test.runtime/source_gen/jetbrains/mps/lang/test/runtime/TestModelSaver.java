package jetbrains.mps.lang.test.runtime;

/*Generated by MPS */

import org.junit.runner.notification.RunListener;
import jetbrains.mps.smodel.ModelAccess;
import org.junit.runner.Result;
import jetbrains.mps.lang.test.util.RunEventsDispatcher;

public class TestModelSaver {
  private static TestModelSaver ourInstance = new TestModelSaver();
  private static RunListener ourListener = createListener();
  private TransformationTest myTest = null;

  private TestModelSaver() {
  }

  public static TestModelSaver getInstance() {
    return TestModelSaver.ourInstance;
  }

  public TransformationTest getTest() {
    return myTest;
  }

  public void setTest(TransformationTest test) {
    myTest = test;
  }

  public void clean() {
    if (myTest != null) {
      ModelAccess.instance().runWriteAction(new Runnable() {
        public void run() {
          myTest.dispose();
        }
      });
      myTest = null;
    }
  }

  private static RunListener createListener() {
    RunListener listener = new RunListener() {
      @Override
      public void testRunFinished(Result result) throws Exception {
        TestModelSaver.ourInstance.clean();
      }
    };
    RunEventsDispatcher.getInstance().addListener(listener);
    return listener;
  }
}
