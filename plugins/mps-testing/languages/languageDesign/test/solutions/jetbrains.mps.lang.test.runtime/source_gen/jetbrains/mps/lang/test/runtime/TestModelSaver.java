package jetbrains.mps.lang.test.runtime;

/*Generated by MPS */

import jetbrains.mps.lang.test.util.MpsRunListener;
import jetbrains.mps.smodel.ModelAccess;
import jetbrains.mps.lang.test.util.RunEventsDispatcher;

public class TestModelSaver {
  private static TestModelSaver ourInstance = new TestModelSaver();
  private static MpsRunListener ourListener = createListener();
  private volatile TransformationTest myTest = null;

  private TestModelSaver() {
  }

  public static TestModelSaver getInstance() {
    return TestModelSaver.ourInstance;
  }

  public TransformationTest getTest() {
    return myTest;
  }

  public void setTest(TransformationTest test) {
    assert myTest == null;
    myTest = test;
  }

  public void clean() {
    if (myTest == null) {
      return;
    }
    ModelAccess.instance().runWriteInEDT(new Runnable() {
      public void run() {
        myTest.dispose();
        myTest = null;
      }
    });
  }

  private static MpsRunListener createListener() {
    MpsRunListener listener = new MpsRunListener() {
      @Override
      public void testRunDone() {
        TestModelSaver.ourInstance.clean();
      }
    };
    RunEventsDispatcher.getInstance().setListener(listener);
    return listener;
  }
}
