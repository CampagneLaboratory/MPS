package jetbrains.mps.lang.test.scripts;

/*Generated by MPS */

import jetbrains.mps.checkers.INodeChecker;
import jetbrains.mps.checkers.LanguageChecker;
import jetbrains.mps.errors.IErrorReporter;
import jetbrains.mps.errors.MessageStatus;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.smodel.IOperationContext;
import jetbrains.mps.typesystemEngine.checker.TypesystemChecker;
import org.jetbrains.mps.openapi.model.SNode;

import java.util.ArrayList;
import java.util.List;
import java.util.Set;

public class TestsErrorsChecker {
  private SNode node;


  public TestsErrorsChecker(SNode node) {
    this.node = node;
  }



  public List<IErrorReporter> getTypeSystemErrorReporters() {
    INodeChecker checker = new TypesystemChecker();
    final Set<IErrorReporter> errors = checker.getErrors(SNodeOperations.getContainingRoot(node), null);
    return filterReportersByNode(errors, node);
  }



  public List<IErrorReporter> getConstraintsErrorReporters() {
    INodeChecker checker = new LanguageChecker();
    IOperationContext context = null;
    final Set<IErrorReporter> errors = checker.getErrors(node, context);
    return filterReportersByNode(errors, node);
  }



  private List<IErrorReporter> filterReportersByNode(final Set<IErrorReporter> errors, final SNode node) {
    return SetSequence.fromSet(errors).where(new IWhereFilter<IErrorReporter>() {
      public boolean accept(IErrorReporter it) {
        return it.getSNode().equals(node);
      }
    }).toListSequence();
  }



  public List<IErrorReporter> getErrorReporters() {
    List<IErrorReporter> result = ListSequence.fromList(new ArrayList<IErrorReporter>());
    ListSequence.fromList(result).addSequence(ListSequence.fromList(getTypeSystemErrorReporters()));
    ListSequence.fromList(result).addSequence(ListSequence.fromList(getConstraintsErrorReporters()));
    return result;
  }



  public List<IErrorReporter> getErrorReportersSpecificType(final MessageStatus errorType) {
    List<IErrorReporter> result = ListSequence.fromList(new ArrayList<IErrorReporter>());
    ListSequence.fromList(result).addSequence(ListSequence.fromList(getErrorReporters()).where(new IWhereFilter<IErrorReporter>() {
      public boolean accept(IErrorReporter it) {
        return it.getMessageStatus() == errorType;
      }
    }));
    return result;
  }


}
