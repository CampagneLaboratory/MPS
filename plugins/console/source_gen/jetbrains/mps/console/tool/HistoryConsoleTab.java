package jetbrains.mps.console.tool;

/*Generated by MPS */

import org.jetbrains.annotations.Nullable;
import jetbrains.mps.smodel.ModelAccess;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import java.util.UUID;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.smodel.tempmodel.TemporaryModels;
import com.intellij.openapi.actionSystem.DefaultActionGroup;
import com.intellij.ui.content.tabs.PinToolwindowTabAction;
import com.intellij.openapi.actionSystem.AnActionEvent;
import com.intellij.icons.AllIcons;
import jetbrains.mps.workbench.action.BaseAction;
import java.util.Map;

public class HistoryConsoleTab extends BaseConsoleTab {

  public HistoryConsoleTab(ConsoleTool tool, String title, @Nullable String history) {
    super(tool, title, history);
  }

  protected void loadHistory(final String state) {
    ModelAccess.instance().runWriteActionInCommand(new Runnable() {
      public void run() {
        SModel loadedModel = loadHistoryModel(state);
        myRoot = SModelOperations.createNewRootNode(myModel, MetaAdapterFactory.getConcept(new UUID(-2442401883381282302l, -5546511894809623691l), 1377757278865717087l, "jetbrains.mps.console.base.structure.OutputConsoleRoot"));
        if (loadedModel == null || ListSequence.fromList(SModelOperations.roots(loadedModel, MetaAdapterFactory.getConcept(new UUID(-2442401883381282302l, -5546511894809623691l), 1377757278865717087l, "jetbrains.mps.console.base.structure.OutputConsoleRoot"))).isEmpty()) {
          SLinkOperations.setTarget(myRoot, MetaAdapterFactory.getContainmentLink(new UUID(-2442401883381282302l, -5546511894809623691l), 1583916890557930028l, 1583916890557930415l, "history"), SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(new UUID(-2442401883381282302l, -5546511894809623691l), 757553790980850366l, "jetbrains.mps.console.base.structure.History")));
        } else {
          SLinkOperations.setTarget(myRoot, MetaAdapterFactory.getContainmentLink(new UUID(-2442401883381282302l, -5546511894809623691l), 1583916890557930028l, 1583916890557930415l, "history"), SLinkOperations.getTarget(ListSequence.fromList(SModelOperations.roots(loadedModel, MetaAdapterFactory.getConcept(new UUID(-2442401883381282302l, -5546511894809623691l), 1377757278865717087l, "jetbrains.mps.console.base.structure.OutputConsoleRoot"))).first(), MetaAdapterFactory.getContainmentLink(new UUID(-2442401883381282302l, -5546511894809623691l), 1583916890557930028l, 1583916890557930415l, "history")));
        }
        SLinkOperations.setTarget(myRoot, MetaAdapterFactory.getContainmentLink(new UUID(-2442401883381282302l, -5546511894809623691l), 1583916890557930028l, 1583916890557930417l, "commandHolder"), SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(new UUID(-2442401883381282302l, -5546511894809623691l), 351968380916615243l, "jetbrains.mps.console.base.structure.CommandHolder")));
        TemporaryModels.getInstance().addMissingImports(myModel);
      }
    });
  }

  protected void registerActions(DefaultActionGroup group) {
    super.registerActions(group);
    group.add(new HistoryConsoleTab.CloseAction());
    group.add(new PinToolwindowTabAction() {
      @Override
      public void update(AnActionEvent event) {
        super.update(event);
        event.getPresentation().setIcon(AllIcons.General.Pin_tab);
        event.getPresentation().setEnabledAndVisible(true);
      }
    });
  }

  private class CloseAction extends BaseAction {
    public CloseAction() {
      super("Close", "Close tab", AllIcons.Actions.Cancel);
    }
    protected void doExecute(AnActionEvent event, Map<String, Object> arg) {
      myTool.closeTab(HistoryConsoleTab.this);
    }
  }

}
