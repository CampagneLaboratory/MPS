package jetbrains.mps.execution.configurations.implementation.plugin.plugin;

/*Generated by MPS */

import java.io.PrintStream;
import java.io.PipedInputStream;
import java.io.IOException;
import java.io.PipedOutputStream;
import java.io.InputStream;
import java.io.OutputStream;
import com.intellij.util.WaitFor;

public class FakeProcess extends Process {
  private final PrintStream myOldOut;
  private final PrintStream myOldErr;
  private final PipedInputStream myInputOut;
  private final PipedInputStream myInputErr;
  private boolean myDestroyed = false;

  public FakeProcess() {
    myOldOut = System.out;
    myOldErr = System.err;
    myInputOut = new PipedInputStream();
    myInputErr = new PipedInputStream();
  }

  public void init() throws IOException {
    System.setOut(new PrintStream(new PipedOutputStream(myInputOut), true));
    System.setErr(new PrintStream(new PipedOutputStream(myInputErr), true));
  }

  public void destroy() {
    assert !(myDestroyed);
    myDestroyed = true;
    System.setOut(myOldOut);
    System.setErr(myOldErr);
  }
  public int exitValue() {
    assert false;
    return 0;
  }
  public InputStream getErrorStream() {
    return myInputErr;
  }
  public InputStream getInputStream() {
    return myInputOut;
  }
  public OutputStream getOutputStream() {
    assert false;
    return null;
  }
  public int waitFor() throws InterruptedException {
    new WaitFor() {
      protected boolean condition() {
        return myDestroyed;
      }
    };
    return 0;
  }
}
