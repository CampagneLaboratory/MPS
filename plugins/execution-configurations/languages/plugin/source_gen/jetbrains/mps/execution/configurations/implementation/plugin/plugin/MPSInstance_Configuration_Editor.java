package jetbrains.mps.execution.configurations.implementation.plugin.plugin;

/*Generated by MPS */

import jetbrains.mps.execution.api.settings.SettingsEditorEx;
import javax.swing.JCheckBox;
import com.intellij.openapi.util.Disposer;
import org.jetbrains.annotations.NotNull;
import javax.swing.JPanel;
import javax.swing.border.CompoundBorder;
import javax.swing.border.TitledBorder;
import javax.swing.border.EmptyBorder;
import com.intellij.ui.components.JBCheckBox;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import com.intellij.util.Restarter;
import java.awt.GridBagLayout;
import jetbrains.mps.ide.common.LayoutUtil;
import com.intellij.openapi.options.ConfigurationException;

public class MPSInstance_Configuration_Editor extends SettingsEditorEx<MPSInstance_Configuration> {
  private MpsStartupSettingsEditorComponent myMpsStartupSettings;
  private JCheckBox myRestartCheckBox;
  private MpsStartupSettings_Configuration_Editor myMpsSettings;
  private DeployPluginsSettings_Configuration_Editor myPluginsSettings;

  public void disposeEditor() {
    Disposer.dispose(myMpsSettings);
    Disposer.dispose(myPluginsSettings);
  }

  @NotNull
  public JPanel createEditor() {
    myMpsStartupSettings = myMpsSettings.createEditor();
    myMpsStartupSettings.setBorder(new CompoundBorder(new TitledBorder("New MPS instance settings"), new EmptyBorder(3, 5, 3, 5)));
    myRestartCheckBox = new JBCheckBox("Restart current MPS instance");
    myRestartCheckBox.addActionListener(new ActionListener() {
      public void actionPerformed(ActionEvent e) {
        myMpsStartupSettings.setEditable(!(myRestartCheckBox.isSelected()));
      }
    });
    myRestartCheckBox.setEnabled(Restarter.isSupported());
    JPanel plugins = myPluginsSettings.createEditor();
    plugins.setBorder(new EmptyBorder(5, 0, 0, 0));

    JPanel panel = new JPanel(new GridBagLayout());
    panel.add(myRestartCheckBox, LayoutUtil.createLabelConstraints(0));
    panel.add(myMpsStartupSettings, LayoutUtil.createPanelConstraints(1));
    panel.add(plugins, LayoutUtil.createPanelConstraints(2));
    return panel;
  }

  public void applyEditorTo(final MPSInstance_Configuration configuration) throws ConfigurationException {
    myMpsSettings.applyEditorTo(configuration.getMpsSettings());
    myPluginsSettings.applyEditorTo(configuration.getPluginsSettings());
    configuration.setIsRestartCurrent(myRestartCheckBox.isSelected());
  }

  public void resetEditorFrom(final MPSInstance_Configuration configuration) {
    myMpsSettings.resetEditorFrom(configuration.getMpsSettings());
    myPluginsSettings.resetEditorFrom(configuration.getPluginsSettings());
    myRestartCheckBox.setSelected(configuration.getIsRestartCurrent());
    myMpsStartupSettings.setEditable(!(configuration.getIsRestartCurrent()));
  }

  public MPSInstance_Configuration_Editor(MpsStartupSettings_Configuration_Editor mpsSettings, DeployPluginsSettings_Configuration_Editor pluginsSettings) {
    myMpsSettings = mpsSettings;
    myPluginsSettings = pluginsSettings;
  }
}
