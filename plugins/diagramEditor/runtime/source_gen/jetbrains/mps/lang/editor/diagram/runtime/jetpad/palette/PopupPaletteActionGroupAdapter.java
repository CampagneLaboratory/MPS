package jetbrains.mps.lang.editor.diagram.runtime.jetpad.palette;

/*Generated by MPS */

import com.intellij.openapi.actionSystem.DefaultActionGroup;
import com.intellij.openapi.actionSystem.AnActionEvent;
import javax.swing.JPopupMenu;
import com.intellij.openapi.actionSystem.ActionManager;
import com.intellij.openapi.actionSystem.ActionPlaces;
import java.awt.event.InputEvent;
import java.awt.event.MouseEvent;

public class PopupPaletteActionGroupAdapter extends DiagramPaletteToggleAction {
  private PaletteActionGroup myPaletteActionGroup;
  private DefaultActionGroup myActionGroup = new DefaultActionGroup();


  public PopupPaletteActionGroupAdapter(DiagramPalette palette, PaletteActionGroup group) {
    super(palette, group);
    assert group.isPopup();
    myPaletteActionGroup = group;
    myActionGroup.setPopup(true);
  }

  private void updateActionGroup() {
    myActionGroup.removeAll();
    for (PaletteElement element : myPaletteActionGroup.getElements()) {
      myActionGroup.add(PaletteElementFactory.createPaletteElementAdapter(myPalette, element));
    }
  }

  @Override
  public void setSelected(AnActionEvent event, boolean isSelected) {
    super.setSelected(event, isSelected);
    if (event == null) {
      return;
    }
    updateActionGroup();
    JPopupMenu menu = ActionManager.getInstance().createActionPopupMenu(ActionPlaces.UNKNOWN, myActionGroup).getComponent();
    InputEvent inputEvent = event.getInputEvent();
    int x = 0;
    int y = 0;
    if (inputEvent instanceof MouseEvent) {
      x = ((MouseEvent) inputEvent).getX();
      y = ((MouseEvent) inputEvent).getY();
    }

    menu.show(inputEvent.getComponent(), x, y);
  }
}
