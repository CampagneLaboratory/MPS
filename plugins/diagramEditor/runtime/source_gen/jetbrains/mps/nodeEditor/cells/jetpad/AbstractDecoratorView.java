package jetbrains.mps.nodeEditor.cells.jetpad;

/*Generated by MPS */

import jetbrains.jetpad.projectional.view.GroupView;
import jetbrains.jetpad.model.property.Property;
import jetbrains.jetpad.model.property.ValueProperty;
import jetbrains.jetpad.projectional.view.View;
import jetbrains.jetpad.mapper.Mapper;
import jetbrains.jetpad.mapper.Synchronizers;
import jetbrains.jetpad.model.property.WritableProperty;
import jetbrains.jetpad.geometry.Vector;
import jetbrains.jetpad.projectional.view.PolyLineView;
import jetbrains.jetpad.values.Color;

public abstract class AbstractDecoratorView extends GroupView {
  protected static final int SELECTION_SQUARE_HALF_WIDTH = 3;
  protected GroupView myErrorView;
  protected GroupView mySelectionView;
  public final Property<Boolean> hasError = new ValueProperty<Boolean>(false);
  public final Property<Boolean> isSelected = new ValueProperty<Boolean>(false);


  public AbstractDecoratorView() {
    initSynchronizers();
  }



  protected View getSelectionView() {
    if (mySelectionView == null) {
      mySelectionView = createSelectionView();
    }
    return mySelectionView;
  }

  protected View getErrorView() {
    if (myErrorView == null) {
      myErrorView = createErrorView();
    }
    return myErrorView;
  }

  private void initSynchronizers() {
    new Mapper<AbstractDecoratorView, AbstractDecoratorView>(this, this) {
      @Override
      protected void registerSynchronizers(Mapper.SynchronizersConfiguration configuration) {
        super.registerSynchronizers(configuration);
        configuration.add(Synchronizers.forProperty(hasError, new WritableProperty<Boolean>() {
          public void set(Boolean hasError) {
            setError(hasError);
          }
        }));
        configuration.add(Synchronizers.forProperty(isSelected, new WritableProperty<Boolean>() {
          public void set(Boolean isSelected) {
            setSelected(isSelected);
          }
        }));

      }
    }.attachRoot();
  }



  protected abstract GroupView createSelectionView();

  protected abstract GroupView createErrorView();





  private void setSelected(boolean isSelected) {
    if (isSelected) {
      children().add(getSelectionView());
    } else {
      children().remove(getSelectionView());
    }
  }



  private void setError(boolean isError) {
    if (isError) {
      children().add(getErrorView());
    } else {
      children().remove(getErrorView());
    }
  }



  protected View createSelectionRect(Vector origin) {
    PolyLineView selectionRect = new AbstractDecoratorView.SimplePolylineView();
    selectionRect.background().set(Color.LIGHT_GRAY);
    selectionRect.color().set(Color.GRAY);
    selectionRect.points.add(new Vector(origin.x - SELECTION_SQUARE_HALF_WIDTH, origin.y - SELECTION_SQUARE_HALF_WIDTH));
    selectionRect.points.add(new Vector(origin.x + SELECTION_SQUARE_HALF_WIDTH, origin.y - SELECTION_SQUARE_HALF_WIDTH));
    selectionRect.points.add(new Vector(origin.x + SELECTION_SQUARE_HALF_WIDTH, origin.y + SELECTION_SQUARE_HALF_WIDTH));
    selectionRect.points.add(new Vector(origin.x - SELECTION_SQUARE_HALF_WIDTH, origin.y + SELECTION_SQUARE_HALF_WIDTH));
    selectionRect.points.add(new Vector(origin.x - SELECTION_SQUARE_HALF_WIDTH, origin.y - SELECTION_SQUARE_HALF_WIDTH));
    return selectionRect;
  }



  public static class SimplePolylineView extends PolyLineView {
    @Override
    protected boolean contains(Vector vector) {
      return false;
    }
  }
}
