package jetbrains.mps.vcs.changesmanager.editor;

/*Generated by MPS */

import javax.swing.JPopupMenu;
import jetbrains.mps.vcs.diff.ui.common.ChangeGroup;
import com.intellij.openapi.actionSystem.ActionToolbar;
import com.intellij.openapi.actionSystem.ActionManager;
import com.intellij.openapi.actionSystem.ActionPlaces;
import jetbrains.mps.workbench.action.BaseGroup;
import javax.swing.BorderFactory;
import java.awt.Color;
import javax.swing.event.PopupMenuListener;
import javax.swing.event.PopupMenuEvent;

/*package*/ class PopupToolbar extends JPopupMenu {
  private ChangeStripsPainter myPainter;
  private ChangeGroup myChangeGroup;

  public PopupToolbar(ChangeStripsPainter painter, ChangeGroup group) {
    myChangeGroup = group;
    myPainter = painter;
    final ActionToolbar toolbar = ActionManager.getInstance().createActionToolbar(ActionPlaces.UNKNOWN, ((BaseGroup) ActionManager.getInstance().getAction("jetbrains.mps.vcs.plugin.ChangesStrip_ActionGroup")), true);
    toolbar.setTargetComponent(myPainter.getEditorComponent());
    add(toolbar.getComponent());
    setBorder(BorderFactory.createLineBorder(Color.BLACK));
    addPopupMenuListener(new PopupMenuListener() {
      public void popupMenuWillBecomeVisible(PopupMenuEvent event) {
        myPainter.setGroupHighlighted(myChangeGroup, true);
        toolbar.updateActionsImmediately();
      }

      public void popupMenuWillBecomeInvisible(PopupMenuEvent event) {
        myPainter.setGroupHighlighted(myChangeGroup, false);
        myPainter.popupClosed();
      }

      public void popupMenuCanceled(PopupMenuEvent event) {
      }
    });
  }

  /*package*/ ChangeGroup getChangeGroup() {
    return myChangeGroup;
  }
}
