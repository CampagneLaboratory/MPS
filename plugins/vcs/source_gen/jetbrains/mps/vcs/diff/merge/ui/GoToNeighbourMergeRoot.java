package jetbrains.mps.vcs.diff.merge.ui;

/*Generated by MPS */

import jetbrains.mps.workbench.action.BaseAction;
import jetbrains.mps.vcs.diff.merge.MergeContext;
import javax.swing.Icon;
import com.intellij.openapi.actionSystem.AnActionEvent;
import java.util.Map;
import jetbrains.mps.smodel.SNodeId;
import jetbrains.mps.workbench.search.icons.Icons;

public abstract class GoToNeighbourMergeRoot extends BaseAction {
  private MergeContext myMergeContext;
  protected MergeRootsDialog myMergeRootsDialog;

  private GoToNeighbourMergeRoot(String type, MergeContext mergeContext, MergeRootsDialog mergeRootsDialog, Icon icon) {
    super("Go to " + type + " Root", null, icon);
    myMergeContext = mergeContext;
    myMergeRootsDialog = mergeRootsDialog;
    setDisableOnNoProject(false);
  }

  protected void doExecute(AnActionEvent event, Map<String, Object> map) {
    SNodeId neighbour = getNeighbourId();
    if (neighbour != null) {
      MergeModelsDialog mergeModelsDialog = myMergeRootsDialog.getModelsDialog();
      myMergeRootsDialog.saveAndClose();
      mergeModelsDialog.invokeMergeRoots(neighbour);
    }
  }

  @Override
  protected void doUpdate(AnActionEvent event, Map<String, Object> map) {
    super.doUpdate(event, map);
    event.getPresentation().setEnabled(getNeighbourId() != null);
  }

  protected abstract SNodeId getNeighbourId();

  public static GoToNeighbourMergeRoot nextInstance(MergeContext mergeContext, MergeRootsDialog mergeRootsDialog) {
    return new GoToNeighbourMergeRoot("Next", mergeContext, mergeRootsDialog, Icons.NEXT_ICON) {
      protected SNodeId getNeighbourId() {
        return myMergeRootsDialog.getModelsDialog().getNextRoot(myMergeRootsDialog.getRootId());
      }
    };
  }

  public static GoToNeighbourMergeRoot previousInstance(MergeContext mergeContext, MergeRootsDialog mergeRootsDialog) {
    return new GoToNeighbourMergeRoot("Previous", mergeContext, mergeRootsDialog, Icons.PREVIOUS_ICON) {
      protected SNodeId getNeighbourId() {
        return myMergeRootsDialog.getModelsDialog().getPreviousRoot(myMergeRootsDialog.getRootId());
      }
    };
  }
}
