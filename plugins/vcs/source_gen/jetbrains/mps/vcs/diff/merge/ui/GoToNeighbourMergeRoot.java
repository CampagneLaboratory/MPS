package jetbrains.mps.vcs.diff.merge.ui;

/*Generated by MPS */

import jetbrains.mps.workbench.action.BaseAction;
import javax.swing.Icon;
import com.intellij.openapi.util.IconLoader;
import jetbrains.mps.ide.projectPane.Icons;
import com.intellij.openapi.actionSystem.AnActionEvent;
import java.util.Map;
import jetbrains.mps.smodel.SNodeId;

public abstract class GoToNeighbourMergeRoot extends BaseAction {
  private static Icon PREVIOUS_ROOT_ICON = IconLoader.getIcon("/actions/prevfile.png", Icons.class);
  private static Icon NEXT_ROOT_ICON = IconLoader.getIcon("/actions/nextfile.png", Icons.class);

  protected MergeRootsDialog myMergeRootsDialog;

  private GoToNeighbourMergeRoot(String type, MergeRootsDialog mergeRootsDialog, Icon icon) {
    super("Go to " + type + " Root", null, icon);
    myMergeRootsDialog = mergeRootsDialog;
    setDisableOnNoProject(false);
  }

  protected void doExecute(AnActionEvent event, Map<String, Object> map) {
    SNodeId neighbour = getNeighbourId();
    if (neighbour != null) {
      MergeModelsDialog mergeModelsDialog = myMergeRootsDialog.getModelsDialog();
      myMergeRootsDialog.saveAndClose();
      mergeModelsDialog.invokeMergeRoots(neighbour);
    }
  }

  @Override
  protected void doUpdate(AnActionEvent event, Map<String, Object> map) {
    super.doUpdate(event, map);
    event.getPresentation().setEnabled(getNeighbourId() != null);
  }

  protected abstract SNodeId getNeighbourId();

  public static GoToNeighbourMergeRoot nextInstance(MergeRootsDialog mergeRootsDialog) {
    return new GoToNeighbourMergeRoot("Next", mergeRootsDialog, NEXT_ROOT_ICON) {
      protected SNodeId getNeighbourId() {
        return myMergeRootsDialog.getModelsDialog().getNextRoot(myMergeRootsDialog.getRootId());
      }
    };
  }

  public static GoToNeighbourMergeRoot previousInstance(MergeRootsDialog mergeRootsDialog) {
    return new GoToNeighbourMergeRoot("Previous", mergeRootsDialog, PREVIOUS_ROOT_ICON) {
      protected SNodeId getNeighbourId() {
        return myMergeRootsDialog.getModelsDialog().getPreviousRoot(myMergeRootsDialog.getRootId());
      }
    };
  }
}
