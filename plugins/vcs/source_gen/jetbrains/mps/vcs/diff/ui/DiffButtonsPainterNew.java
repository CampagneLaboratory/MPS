package jetbrains.mps.vcs.diff.ui;

/*Generated by MPS */

import jetbrains.mps.vcs.diff.ui.common.ButtonsPainter;
import jetbrains.mps.nodeEditor.EditorComponent;
import jetbrains.mps.vcs.diff.ui.common.ChangeGroupLayout;
import jetbrains.mps.vcs.diff.ui.common.FoldingAreaButton;
import jetbrains.mps.vcs.diff.ui.common.ChangeGroup;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import jetbrains.mps.vcs.diff.changes.ModelChange;
import jetbrains.mps.vcs.diff.changes.ChangeType;
import jetbrains.mps.ide.projectPane.Icons;
import java.util.Arrays;
import jetbrains.mps.vcs.diff.ui.common.DiffEditor;
import javax.swing.Icon;

public class DiffButtonsPainterNew extends ButtonsPainter {
  private RootDifferenceDialogNew myDialog;

  private DiffButtonsPainterNew(RootDifferenceDialogNew dialog, EditorComponent editorComponent, ChangeGroupLayout changeGroupLayout) {
    super(1, editorComponent, changeGroupLayout);
    myDialog = dialog;
  }

  protected Iterable<FoldingAreaButton> createButtonsForChangeGroup(ChangeGroup changeGroup, int y) {
    FoldingAreaButton button = null;
    boolean allInsert = ListSequence.fromList(changeGroup.getChanges()).all(new IWhereFilter<ModelChange>() {
      public boolean accept(ModelChange c) {
        return c.getType() == ChangeType.ADD;
      }
    });
    if (isHighlightLeft()) {
      if (!(allInsert)) {
        button = new DiffButtonsPainterNew.MyButton(changeGroup, getX(0), y, "Replace", DiffButtonsPainterNew.MIRRORED_APPLY_ICON);
      }
    } else {
      if (allInsert) {
        button = new DiffButtonsPainterNew.MyButton(changeGroup, getX(0), y, "Remove", Icons.EXCLUDE);
      }
    }
    if (button != null) {
      return Arrays.asList(button);
    } else {
      return null;
    }
  }

  public static DiffButtonsPainterNew addTo(RootDifferenceDialogNew dialog, DiffEditor diffEditor, ChangeGroupLayout changeGroupLayout, boolean inspector) {
    EditorComponent editorComponent = diffEditor.getEditorComponent(inspector);
    DiffButtonsPainterNew painter = new DiffButtonsPainterNew(dialog, editorComponent, changeGroupLayout);
    editorComponent.getLeftEditorHighlighter().addFoldingAreaPainter(painter);
    return painter;
  }

  private class MyButton extends FoldingAreaButton {
    private MyButton(ChangeGroup changeGroup, int x, int y, String name, Icon icon) {
      super(changeGroup, x, y, name, icon);
    }

    public void performAction() {
      myDialog.rollbackChanges(getChangeGroup().getChanges());
    }
  }
}
