package jetbrains.mps.build.deprecated.execution;

/*Generated by MPS */

import java.util.List;
import com.intellij.execution.junit.RuntimeConfigurationProducer;
import com.intellij.execution.configurations.ConfigurationType;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.plugins.pluginparts.runconfigs.BaseConfigCreator;
import jetbrains.mps.smodel.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.plugins.runconfigs.MPSPsiElement;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import jetbrains.mps.smodel.ModelAccess;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import com.intellij.execution.impl.RunManagerImpl;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import jetbrains.mps.smodel.behaviour.BehaviorReflection;

public class CustomMPSApplication_Producer {
  private static String CONFIGURATION_FACTORY_CLASS_NAME = "jetbrains.mps.build.deprecated.execution.CustomMPSApplication_Configuration_Factory";

  public CustomMPSApplication_Producer() {
  }

  public static List<RuntimeConfigurationProducer> getProducers(ConfigurationType configurationType) {
    List<RuntimeConfigurationProducer> creators = ListSequence.fromList(new ArrayList<RuntimeConfigurationProducer>());
    ListSequence.fromList(creators).addElement(new CustomMPSApplication_Producer.ProducerPart_NodeConfiguration_j54240_a(configurationType, CONFIGURATION_FACTORY_CLASS_NAME));
    ListSequence.fromList(creators).addElement(new CustomMPSApplication_Producer.ProducerPart_NodeLayout_j54240_b(configurationType, CONFIGURATION_FACTORY_CLASS_NAME));
    ListSequence.fromList(creators).addElement(new CustomMPSApplication_Producer.ProducerPart_NodeMPSBuild_j54240_c(configurationType, CONFIGURATION_FACTORY_CLASS_NAME));
    return creators;
  }

  public static class ProducerPart_NodeConfiguration_j54240_a extends BaseConfigCreator<SNode> {
    public ProducerPart_NodeConfiguration_j54240_a(ConfigurationType configurationType, String factoryName) {
      super(configurationType, factoryName);
    }

    protected boolean isApplicable(Object source) {
      return source instanceof SNode && SNodeOperations.isInstanceOf(((SNode) source), "jetbrains.mps.build.packaging.structure.Configuration");
    }

    protected CustomMPSApplication_Configuration doCreateConfiguration(final SNode source) {
      setSourceElement(new MPSPsiElement(source));
      final Wrappers._T<SNode> layout = new Wrappers._T<SNode>();
      final Wrappers._boolean isApplicable = new Wrappers._boolean();
      final Wrappers._T<String> configurationId = new Wrappers._T<String>();
      ModelAccess.instance().runReadAction(new Runnable() {
        public void run() {
          layout.value = SNodeOperations.getAncestor(source, "jetbrains.mps.build.packaging.structure.Layout", false, true);
          isApplicable.value = (layout.value != null) && (ListSequence.fromList(SNodeOperations.getDescendants(layout.value, "jetbrains.mps.build.custommps.structure.MPSBuild", false, new String[]{})).isNotEmpty());
          configurationId.value = source.getNodeId().toString();
        }
      });
      if (!(isApplicable.value)) {
        return null;
      }

      CustomMPSApplication_Configuration configuration = ((CustomMPSApplication_Configuration) getConfigurationFactory().createConfiguration(SPropertyOperations.getString(layout.value, "name") + "." + SPropertyOperations.getString(source, "name"), (CustomMPSApplication_Configuration) RunManagerImpl.getInstanceImpl(getContext().getProject()).getConfigurationTemplate(getConfigurationFactory()).getConfiguration()));
      configuration.getNode().setNode(layout.value);
      configuration.setConfigurationId(configurationId.value);
      return configuration;
    }

    @Override
    public CustomMPSApplication_Producer.ProducerPart_NodeConfiguration_j54240_a clone() {
      return (CustomMPSApplication_Producer.ProducerPart_NodeConfiguration_j54240_a) super.clone();
    }
  }

  public static class ProducerPart_NodeLayout_j54240_b extends BaseConfigCreator<SNode> {
    public ProducerPart_NodeLayout_j54240_b(ConfigurationType configurationType, String factoryName) {
      super(configurationType, factoryName);
    }

    protected boolean isApplicable(Object source) {
      return source instanceof SNode && SNodeOperations.isInstanceOf(((SNode) source), "jetbrains.mps.build.packaging.structure.Layout");
    }

    protected CustomMPSApplication_Configuration doCreateConfiguration(final SNode source) {
      setSourceElement(new MPSPsiElement(source));
      final Wrappers._boolean isApplicable = new Wrappers._boolean();
      ModelAccess.instance().runReadAction(new Runnable() {
        public void run() {
          isApplicable.value = ListSequence.fromList(SNodeOperations.getDescendants(source, "jetbrains.mps.build.custommps.structure.MPSBuild", false, new String[]{})).isNotEmpty();
        }
      });
      if (!(isApplicable.value)) {
        return null;
      }

      final Wrappers._T<String> configurationId = new Wrappers._T<String>();
      ModelAccess.instance().runReadAction(new Runnable() {
        public void run() {
          configurationId.value = ListSequence.fromList(SLinkOperations.getTargets(source, "configuration", true)).first().getNodeId().toString();
        }
      });

      CustomMPSApplication_Configuration configuration = ((CustomMPSApplication_Configuration) getConfigurationFactory().createConfiguration(SPropertyOperations.getString(source, "name"), (CustomMPSApplication_Configuration) RunManagerImpl.getInstanceImpl(getContext().getProject()).getConfigurationTemplate(getConfigurationFactory()).getConfiguration()));
      configuration.getNode().setNode(source);
      configuration.setConfigurationId(configurationId.value);
      return configuration;
    }

    @Override
    public CustomMPSApplication_Producer.ProducerPart_NodeLayout_j54240_b clone() {
      return (CustomMPSApplication_Producer.ProducerPart_NodeLayout_j54240_b) super.clone();
    }
  }

  public static class ProducerPart_NodeMPSBuild_j54240_c extends BaseConfigCreator<SNode> {
    public ProducerPart_NodeMPSBuild_j54240_c(ConfigurationType configurationType, String factoryName) {
      super(configurationType, factoryName);
    }

    protected boolean isApplicable(Object source) {
      return source instanceof SNode && SNodeOperations.isInstanceOf(((SNode) source), "jetbrains.mps.build.custommps.structure.MPSBuild");
    }

    protected CustomMPSApplication_Configuration doCreateConfiguration(final SNode source) {
      setSourceElement(new MPSPsiElement(source));
      final Wrappers._T<SNode> layout = new Wrappers._T<SNode>();
      final Wrappers._boolean isApplicable = new Wrappers._boolean();
      final Wrappers._T<String> configurationId = new Wrappers._T<String>();
      final Wrappers._T<SNode> configuration = new Wrappers._T<SNode>();
      ModelAccess.instance().runReadAction(new Runnable() {
        public void run() {
          layout.value = SNodeOperations.getAncestor(source, "jetbrains.mps.build.packaging.structure.Layout", false, true);
          isApplicable.value = (layout.value != null);
          configuration.value = ListSequence.fromList(SLinkOperations.getTargets(layout.value, "configuration", true)).findFirst(new IWhereFilter<SNode>() {
            public boolean accept(SNode it) {
              return BehaviorReflection.invokeNonVirtual(Boolean.TYPE, source, "jetbrains.mps.build.packaging.structure.AbstractProjectComponent", "call_included_1213877333807", new Object[]{it});
            }
          });
          configurationId.value = configuration.value.getNodeId().toString();
        }
      });
      if (!(isApplicable.value)) {
        return null;
      }

      CustomMPSApplication_Configuration runConfiguration = ((CustomMPSApplication_Configuration) getConfigurationFactory().createConfiguration(SPropertyOperations.getString(layout.value, "name") + ".mpsbuild." + SPropertyOperations.getString(configuration.value, "name"), (CustomMPSApplication_Configuration) RunManagerImpl.getInstanceImpl(getContext().getProject()).getConfigurationTemplate(getConfigurationFactory()).getConfiguration()));
      runConfiguration.getNode().setNode(source);
      runConfiguration.setConfigurationId(configurationId.value);
      return runConfiguration;
    }

    @Override
    public CustomMPSApplication_Producer.ProducerPart_NodeMPSBuild_j54240_c clone() {
      return (CustomMPSApplication_Producer.ProducerPart_NodeMPSBuild_j54240_c) super.clone();
    }
  }
}
