<project name="mps.tests" default="all">
    <property name="mps.home" value="${ant.file}/../../../.."/>

    <taskdef resource="jetbrains/mps/build/ant/antlib.xml"
             classpath="${mps.home}/platform/buildlanguage/ant/classes"/>

    <target name="all" depends="bootstrap.tests, application.tests, broken.references.test, refactorings.test"/>

    <target name="bootstrap.tests">
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <jvmarg value="-Xdebug"/>
            <jvmarg value="-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005"/>
            <project file="${mps.home}/core/languageDesign/actions/actions.mpr"/>
            <project file="${mps.home}/core/languageDesign/annotations/annotations.mpr"/>
            <project file="${mps.home}/core/languageDesign/constraints/constraints.mpr"/>
            <project file="${mps.home}/core/languageDesign/core/core.mpr"/>
            <project file="${mps.home}/core/languageDesign/dataFlow/dataFlow.mpr"/>
            <project file="${mps.home}/core/languageDesign/editor/editor.mpr"/>
            <project file="${mps.home}/core/languageDesign/findUsages/findUsages.mpr"/>
            <project file="${mps.home}/core/languageDesign/generator/generator.mpr"/>
            <project file="${mps.home}/core/languageDesign/intentions/intentions.mpr"/>
            <project file="${mps.home}/core/languageDesign/pattern/pattern.mpr"/>
            <project file="${mps.home}/core/languageDesign/plugin/plugin.mpr"/>
            <project file="${mps.home}/core/languageDesign/quotation/quotation.mpr"/>
            <project file="${mps.home}/core/languageDesign/refactoring/refactoring.mpr"/>
            <project file="${mps.home}/core/languageDesign/script/script.mpr"/>
            <project file="${mps.home}/core/languageDesign/sharedConcepts/sharedConcepts.mpr"/>
            <project file="${mps.home}/core/languageDesign/smodel/smodel.mpr"/>
            <project file="${mps.home}/core/languageDesign/structure/structure.mpr"/>
            <project file="${mps.home}/core/languageDesign/test/test.mpr"/>
            <project file="${mps.home}/core/languageDesign/typesystem/typesystem.mpr"/>
        </mps.test.generation>
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <!--<jvmarg value="-Xdebug"/>-->
            <!--<jvmarg value="-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005"/>-->
            <project file="${mps.home}/core/baseLanguage/baseLanguage/baseLanguage.mpr"/>
            <project file="${mps.home}/core/baseLanguage/baseLanguageInternal/baseLanguageInternal.mpr"/>
            <project file="${mps.home}/core/baseLanguage/collections/collections.mpr"/>
            <project file="${mps.home}/core/baseLanguage/dates/dates.mpr"/>
            <project file="${mps.home}/core/baseLanguage/tuples/tuples.mpr"/>
            <project file="${mps.home}/core/baseLanguage/closures/closures.mpr"/>
        </mps.test.generation>
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/platform/xmlDeprecated/xmlDeprecated.mpr"/>
        </mps.test.generation>
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/platform/regexp/regexp.mpr"/>
        </mps.test.generation>
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/platform/xml/xml/xml.mpr"/>
        </mps.test.generation>
    </target>

    <target name="application.tests">
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <!--<jvmarg value="-Xdebug"/>-->
            <!--<jvmarg value="-Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005"/>-->
            <project file="${mps.home}/platform/buildlanguage/BuildLanguage.mpr"/>
        </mps.test.generation>
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <!--<jvmarg value="-Xdebug"/>-->
            <!--<jvmarg value="-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005"/>-->
            <project file="${mps.home}/platform/uiLanguage/uiLanguage.mpr"/>
        </mps.test.generation>
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/workbench/ideSolution/ide.mpr"/>
        </mps.test.generation>
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <!--<jvmarg value="-Xdebug"/>-->
            <!--<jvmarg value="-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005"/>-->
            <project file="${mps.home}/core/languageDesign/mps-lite/mps-lite.mpr"/>
        </mps.test.generation>
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/samples/complexLanguage/Complex.mpr"/>
        </mps.test.generation>
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/samples/matrixLanguage/jetbrains.mps.matrixLanguage.mpr"/>
        </mps.test.generation>
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/platform/ypath/YPath.mpr"/>
        </mps.test.generation>
        <mps.test.generation fork="true" compile="true" showdiff="true" invoketests="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/samples/xmlLiterals/jetbrains.mps.samples.xmlLiterals.mpr"/>
        </mps.test.generation>
    </target>

    <target name="broken.references.test">
        <mps.test.broken.references fork="true" loglevel="info">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <!--<jvmarg value="-Xdebug"/>-->
            <!--<jvmarg value="-Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005"/>-->
            <modules dir="${mps.home}">
                <exclude name="**/classes/**"/>
                <exclude name="**/classes_gen/**"/>
                <exclude name="**/lib/**"/>
                <exclude name="**/testMaterial/**"/>
            </modules>
        </mps.test.broken.references>
    </target>

    <target name="refactorings.test">
        <mps.test.refactorings fork="true" loglevel="info"
                               refactoringclass="jetbrains.mps.refactoring.framework.tests.RenameConceptRefactoringTester">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/testMaterial/testRefactoring/testRefactoring.mpr"/>
        </mps.test.refactorings>
        <mps.test.refactorings fork="true" loglevel="info"
                               refactoringclass="jetbrains.mps.refactoring.framework.tests.RenameLinkRefactoringTester_Hierarchy">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/testMaterial/testRefactoring/testRefactoring.mpr"/>
        </mps.test.refactorings>
        <mps.test.refactorings fork="true" loglevel="info"
                               refactoringclass="jetbrains.mps.refactoring.framework.tests.RenameLinkRefactoringTester_Simple">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/testMaterial/testRefactoring/testRefactoring.mpr"/>
        </mps.test.refactorings>
        <mps.test.refactorings fork="true" loglevel="info"
                               refactoringclass="jetbrains.mps.refactoring.framework.tests.MoveConceptRefactoringTester">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/testMaterial/testRefactoring/testRefactoring.mpr"/>
        </mps.test.refactorings>
        <mps.test.refactorings fork="true" loglevel="info"
                               refactoringclass="jetbrains.mps.refactoring.framework.tests.RenamePropertyRefactoringTester_Simple">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/testMaterial/testRefactoring/testRefactoring.mpr"/>
        </mps.test.refactorings>
        <mps.test.refactorings fork="true" loglevel="info"
                               refactoringclass="jetbrains.mps.refactoring.framework.tests.DeleteLinkRefactoringTester_Simple">
            <jvmarg value="-Xss1024k"/>
            <jvmarg value="-Xmx1000m"/>
            <jvmarg value="-XX:MaxPermSize=92m"/>
            <project file="${mps.home}/testMaterial/testRefactoring/testRefactoring.mpr"/>
        </mps.test.refactorings>
    </target>
</project>
