package jetbrains.mps;

/*Generated by MPS */

import jetbrains.mps.project.Project;
import javax.swing.SwingUtilities;
import jetbrains.mps.testbench.IdeaEnvironment;
import java.io.File;
import org.apache.log4j.Logger;
import org.apache.log4j.LogManager;

public class TestMain {
  public static TestMain.ProjectContainer PROJECT_CONTAINER = new TestMain.ProjectContainer();

  public static class ProjectContainer {
    protected String projectName;
    protected Project lastProject;

    public ProjectContainer() {
    }



    public void clear() {
      try {
        SwingUtilities.invokeAndWait(new Runnable() {
          public void run() {
            if (ProjectContainer.this.lastProject != null) {
              ProjectContainer.this.lastProject.dispose();
              ProjectContainer.this.lastProject = null;
            }
            ProjectContainer.this.projectName = null;
          }
        });
      } catch (Exception e) {
        e.printStackTrace();
      }
    }



    public Project getProject(String name) {
      if (isLastProject(name)) {
        if (LOG.isInfoEnabled()) {
          LOG.info("Using the last created project");
        }
        return this.lastProject;
      } else {
        if (LOG.isInfoEnabled()) {
          LOG.info("Opening a new project");
        }
        Project currentProject = IdeaEnvironment.openProjectInIdeaEnvironment(new File(name));
        if (this.lastProject != null) {
          try {
            SwingUtilities.invokeAndWait(new Runnable() {
              public void run() {
                ProjectContainer.this.lastProject.dispose();
              }
            });
          } catch (Exception e) {
            e.printStackTrace();
          }
        }
        this.lastProject = currentProject;
        this.projectName = name;
        return currentProject;
      }
    }



    private boolean isLastProject(String name) {
      return ((name != null ? name.equals(this.projectName) : name == this.projectName));
    }
  }

  protected static Logger LOG = LogManager.getLogger(TestMain.class);
}
