package jetbrains.mps.testbench.junit.suites;

/*Generated by MPS */

import org.junit.runners.Suite;
import org.junit.runners.model.RunnerBuilder;
import org.junit.runners.model.InitializationError;
import java.util.List;
import org.junit.runner.Runner;
import org.junit.runner.notification.RunNotifier;
import jetbrains.mps.RuntimeFlags;
import jetbrains.mps.TestMode;
import jetbrains.mps.tool.environment.Environment;
import jetbrains.mps.tool.environment.EnvironmentContainer;

public class BaseMpsSuite extends Suite {
  public BaseMpsSuite(Class<?> aClass, RunnerBuilder builder) throws InitializationError {
    super(aClass, builder);
  }

  public BaseMpsSuite(Class<?> klass, List<Runner> runners) throws InitializationError {
    super(klass, runners);
  }

  @Override
  public void run(RunNotifier notifier) {
    try {
      RuntimeFlags.setTestMode(TestMode.SUITE);
      super.run(notifier);
    } finally {
      Environment env;
      while ((env = EnvironmentContainer.get()) != null) {
        // dispose works as #release for now 
        env.dispose();
      }
      RuntimeFlags.setTestMode(TestMode.NONE);
    }
  }
}
