<project name="unpackAndTest" default="default" basedir="../../../../../..">
  <!--Generated by MPS-->
  <property name="build.distribution" location="build/artifacts/mpsDistribution" />
  <loadproperties srcfile="${build.distribution}/build.properties" />
  <property name="mps.zip" location="${build.distribution}/${mps.build.number}.zip" />
  <property name="mps.ant.workdir" value="${java.io.tmpdir}/mps.ant.workdir" />
  <property name="tmpdir" value="${mps.ant.workdir}/testproject" />
  
  <property name="mps_build_home" location="${mps.ant.workdir}/MPS ${mpsBootstrapCore.version}" />
  
  <property name="projectsdir" value="${ant.file.unpackAndTest}/../../../../projects" />
  
  <target name="clean">
    <delete dir="${mps.ant.workdir}" />
  </target>
  
  <target name="unpack" depends="clean">
    <mkdir dir="${tmpdir}" />
    <unzip dest="${tmpdir}">
      <fileset dir="${projectsdir}" includes="*.zip" />
    </unzip>
    <unzip dest="${mps.ant.workdir}" src="${mps.zip}" />
  </target>
  
  <target name="test" depends="unpack">
    <ant antfile="${tmpdir}/TestMPSAntTask/generate.xml" dir="${tmpdir}/TestMPSAntTask" inheritall="false">
      <property name="mps_build" value="${mps_build_home}" />
    </ant>
    <ant antfile="${tmpdir}/TestMPSAntTask/test.xml" dir="${tmpdir}/TestMPSAntTask" inheritall="false">
      <property name="mps_build" value="${mps_build_home}" />
    </ant>
  </target>
  
  <target name="default" depends="test">
    <delete dir="${mps.ant.workdir}" deleteonexit="true" />
  </target>
  
</project>