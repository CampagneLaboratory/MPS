package jetbrains.mps.smodel.persistence.def.v5;

/*Generated by MPS */

import org.xml.sax.helpers.DefaultHandler;
import java.util.Stack;
import jetbrains.mps.smodel.SModel;
import org.xml.sax.SAXException;
import org.xml.sax.Attributes;
import org.xml.sax.SAXParseException;
import jetbrains.mps.smodel.SModelReference;

public class ModelReader5Handler extends DefaultHandler {
  private static ModelReader5Handler.modelElementHandler modelhandler = new ModelReader5Handler.modelElementHandler();
  private static ModelReader5Handler.persistenceElementHandler persistencehandler = new ModelReader5Handler.persistenceElementHandler();

  private Stack<ModelReader5Handler.ElementHandler> handlers = new Stack<ModelReader5Handler.ElementHandler>();
  private Stack<Object> values = new Stack<Object>();
  private SModel result;

  public ModelReader5Handler() {
  }

  public SModel getResult() {
    return result;
  }

  @Override
  public void characters(char[] array, int start, int len) throws SAXException {
    ModelReader5Handler.ElementHandler current = (handlers.empty() ?
      (ModelReader5Handler.ElementHandler) null :
      handlers.peek()
    );
    if (current != null) {
      current.handleText(values.peek(), new String(array, start, len));
    }
  }

  @Override
  public void endElement(String uri, String localName, String qName) throws SAXException {
    ModelReader5Handler.ElementHandler current = handlers.pop();
    Object childValue = values.pop();
    if (current != null) {
      current.validate(childValue);
      ModelReader5Handler.ElementHandler parent = (handlers.empty() ?
        (ModelReader5Handler.ElementHandler) null :
        handlers.peek()
      );
      if (parent != null) {
        parent.handleChild(values.peek(), qName, childValue);
      } else {
        result = (SModel) childValue;
      }
    }
  }

  @Override
  public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException {
    ModelReader5Handler.ElementHandler current = (handlers.empty() ?
      (ModelReader5Handler.ElementHandler) null :
      handlers.peek()
    );
    if (current == null) {
      // root 
      current = modelhandler;
    } else {
      current = current.createChild(qName);
    }
    Object result = current.createObject();

    // check required 
    for (String attr : current.requiredAttributes()) {
      if (attributes.getValue(attr) == null) {
        throw new SAXParseException("attribute " + attr + " is absent", null);
      }
    }

    // handle attributes 
    for (int i = 0; i < attributes.getLength(); i++) {
      String name = attributes.getQName(i);
      String value = attributes.getValue(i);
      current.handleAttribute(result, name, value);
    }
    handlers.push(current);
    values.push(result);
  }

  private static class ElementHandler {
    private static String[] EMPTY_ARRAY = new String[0];

    private ElementHandler() {
    }

    protected Object createObject() {
      return null;
    }

    protected void handleAttribute(Object resultObject, String name, String value) throws SAXParseException {
    }

    protected ModelReader5Handler.ElementHandler createChild(String tagName) throws SAXParseException {
      throw new SAXParseException("unknown tag: " + tagName, null);
    }

    protected void handleChild(Object resultObject, String tagName, Object value) throws SAXParseException {
      throw new SAXParseException("unknown child: " + tagName, null);
    }

    protected void handleText(Object resultObject, String value) throws SAXParseException {
      if (value.trim().length() == 0) {
        return;
      }
      throw new SAXParseException("text is not accepted", null);
    }

    protected String[] requiredAttributes() {
      return EMPTY_ARRAY;
    }

    protected void validate(Object resultObject) throws SAXParseException {
    }
  }

  public static class modelElementHandler extends ModelReader5Handler.ElementHandler {
    private static String[] requiredAttributes = new String[]{"modelUID"};

    public modelElementHandler() {
    }

    @Override
    protected SModel createObject() {
      return new SModel(null);
    }

    @Override
    protected String[] requiredAttributes() {
      return requiredAttributes;
    }

    @Override
    protected void handleAttribute(Object resultObject, String name, String value) throws SAXParseException {
      SModel result = (SModel) resultObject;
      if ("modelUID".equals(name)) {
        result.changeModelReference(SModelReference.fromString(value));
        return;
      }
      super.handleAttribute(resultObject, name, value);
    }

    @Override
    protected ModelReader5Handler.ElementHandler createChild(String tagName) throws SAXParseException {
      if ("persistence".equals(tagName)) {
        return ModelReader5Handler.persistencehandler;
      }
      return super.createChild(tagName);
    }

    @Override
    protected void handleChild(Object resultObject, String tagName, Object value) throws SAXParseException {
      SModel result = (SModel) resultObject;
      if ("persistence".equals(tagName)) {
        Object child = (Object) value;
        return;
      }
      super.handleChild(resultObject, tagName, value);
    }
  }

  public static class persistenceElementHandler extends ModelReader5Handler.ElementHandler {
    private static String[] requiredAttributes = new String[]{"version"};

    public persistenceElementHandler() {
    }

    @Override
    protected Object createObject() {
      return new Object();
    }

    @Override
    protected String[] requiredAttributes() {
      return requiredAttributes;
    }

    @Override
    protected void handleAttribute(Object resultObject, String name, String value) throws SAXParseException {
      Object result = (Object) resultObject;
      if ("version".equals(name)) {
        return;
      }
      super.handleAttribute(resultObject, name, value);
    }
  }
}
