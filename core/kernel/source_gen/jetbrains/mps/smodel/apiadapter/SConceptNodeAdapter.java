package jetbrains.mps.smodel.apiadapter;

/*Generated by MPS */

import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.SNode;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.ISelector;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.util.NameUtil;
import org.jetbrains.mps.openapi.language.SLink;
import jetbrains.mps.smodel.search.ConceptAndSuperConceptsScope;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SProperty;
import java.util.List;
import jetbrains.mps.smodel.search.SModelSearchUtil;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import org.jetbrains.mps.openapi.language.SLanguage;
import jetbrains.mps.smodel.Language;

public class SConceptNodeAdapter implements SConcept {
  private SNode myConcept;

  public SConceptNodeAdapter(@NotNull SNode concept) {
    myConcept = concept;
  }

  public SConcept getSuperConcept() {
    return new SConceptNodeAdapter(SLinkOperations.getTarget(myConcept, "extends", false));
  }

  public Iterable<SInterfaceConcept> getSuperInterfaces() {
    return ListSequence.fromList(SLinkOperations.getTargets(myConcept, "implements", true)).select(new ISelector<SNode, SInterfaceConcept>() {
      public SInterfaceConcept select(SNode it) {
        return ((SInterfaceConcept) new SInterfaceConceptNodeAdapter(it));
      }
    });
  }

  public String getName() {
    return SPropertyOperations.getString(myConcept, "name");
  }

  public String getId() {
    return NameUtil.nodeFQName(myConcept);
  }

  public SLink findLink(String role) {
    SNode ld = new ConceptAndSuperConceptsScope(myConcept).getLinkDeclarationByRole(role);
    return (ld == null ?
      null :
      new SLinkNodeAdapter(SNodeOperations.cast(ld, "jetbrains.mps.lang.structure.structure.LinkDeclaration"))
    );
  }

  public Iterable<SLink> getLinks() {
    return ListSequence.fromList(SLinkOperations.getTargets(myConcept, "linkDeclaration", true)).select(new ISelector<SNode, SLink>() {
      public SLink select(SNode it) {
        return ((SLink) new SLinkNodeAdapter(it));
      }
    });
  }

  public SProperty findProperty(final String name) {
    SNode property = ListSequence.fromList((List<SNode>) SModelSearchUtil.getPropertyDeclarations(myConcept)).findFirst(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return eq_12aglo_a0a0a0a0a0a0a6(SPropertyOperations.getString(it, "name"), name);
      }
    });
    return (property == null ?
      null :
      new SPropertyNodeAdapter(property)
    );
  }

  public Iterable<SProperty> getProperties() {
    return ListSequence.fromList(SLinkOperations.getTargets(myConcept, "propertyDeclaration", true)).select(new ISelector<SNode, SProperty>() {
      public SProperty select(SNode it) {
        return ((SProperty) new SPropertyNodeAdapter(it));
      }
    });
  }

  public boolean isSubConceptOf(SConcept concept) {
    SNode c;
    if (concept instanceof SConceptNodeAdapter) {
      c = ((SConceptNodeAdapter) concept).getConcept();
    } else if (concept instanceof SInterfaceConceptNodeAdapter) {
      c = ((SInterfaceConceptNodeAdapter) concept).getIConcept();
    } else {
      throw new IllegalArgumentException("not supported");
    }

    return SConceptOperations.isSubConceptOf(((SNode) myConcept), NameUtil.nodeFQName(c));
  }

  public SLanguage getLanguage() {
    return new SLanguageLanguageAdapter(((Language) SNodeOperations.getModel(myConcept).getModelDescriptor().getModule()));
  }

  public SNode getConcept() {
    return myConcept;
  }

  private static boolean eq_12aglo_a0a0a0a0a0a0a6(Object a, Object b) {
    return (a != null ?
      a.equals(b) :
      a == b
    );
  }
}
