package jetbrains.mps.smodel.apiadapter;

/*Generated by MPS */

import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.ISelector;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.util.NameUtil;
import org.jetbrains.mps.openapi.language.SLink;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import jetbrains.mps.kernel.model.SModelUtil;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import org.jetbrains.mps.openapi.language.SLanguage;
import jetbrains.mps.smodel.Language;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;

public class SConceptNodeAdapter implements SConcept {
  private SNode myConcept;

  public SConceptNodeAdapter(SNode concept) {
    myConcept = concept;
  }

  public SConcept getSuperConcept() {
    return new SConceptNodeAdapter(SLinkOperations.getTarget(myConcept, "extends", false));
  }

  public Iterable<SInterfaceConcept> getSuperInterfaces() {
    return ListSequence.fromList(SLinkOperations.getTargets(myConcept, "implements", true)).select(new ISelector<SNode, SInterfaceConcept>() {
      public SInterfaceConcept select(SNode it) {
        return ((SInterfaceConcept) new SInterfaceConceptNodeAdapter(it));
      }
    });
  }

  public String getName() {
    return SPropertyOperations.getString(myConcept, "name");
  }

  public String getQualifiedName() {
    return NameUtil.nodeFQName(myConcept);
  }

  public SLink getLink(final String role) {
    return new SLinkNodeAdapter(ListSequence.fromList(SLinkOperations.getTargets(myConcept, "linkDeclaration", true)).findFirst(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return eq_12aglo_a0a0a0a0a0a0a0e(SPropertyOperations.getString(SModelUtil.getGenuineLinkDeclaration(it), "role"), role);
      }
    }));
  }

  public Iterable<SLink> getLinks() {
    return ListSequence.fromList(SLinkOperations.getTargets(myConcept, "linkDeclaration", true)).select(new ISelector<SNode, SLink>() {
      public SLink select(SNode it) {
        return ((SLink) new SLinkNodeAdapter(it));
      }
    });
  }

  public SProperty getProperty(final String name) {
    return new SPropertyNodeAdapter(ListSequence.fromList(SLinkOperations.getTargets(myConcept, "propertyDeclaration", true)).findFirst(new IWhereFilter<SNode>() {
      public boolean accept(SNode it) {
        return eq_12aglo_a0a0a0a0a0a0a0g(SPropertyOperations.getString(it, "name"), name);
      }
    }));
  }

  public Iterable<SProperty> getProperties() {
    return ListSequence.fromList(SLinkOperations.getTargets(myConcept, "propertyDeclaration", true)).select(new ISelector<SNode, SProperty>() {
      public SProperty select(SNode it) {
        return ((SProperty) new SPropertyNodeAdapter(it));
      }
    });
  }

  public boolean isSubConceptOf(SConcept concept) {
    SNode c;
    if (concept instanceof SConceptNodeAdapter) {
      c = ((SConceptNodeAdapter) concept).getConcept();
    } else if (concept instanceof SInterfaceConceptNodeAdapter) {
      c = ((SInterfaceConceptNodeAdapter) concept).getIConcept();
    } else {
      throw new IllegalArgumentException("not supported");
    }

    return SConceptOperations.isSubConceptOf(((SNode) myConcept), NameUtil.nodeFQName(c));
  }

  public SLanguage getLanguage() {
    return new SLanguageLanguageAdapter(((Language) SNodeOperations.getModel(myConcept).getModelDescriptor().getModule()));
  }

  public SNode getConcept() {
    return myConcept;
  }

  private static boolean eq_12aglo_a0a0a0a0a0a0a0e(Object a, Object b) {
    return (a != null ?
      a.equals(b) :
      a == b
    );
  }

  private static boolean eq_12aglo_a0a0a0a0a0a0a0g(Object a, Object b) {
    return (a != null ?
      a.equals(b) :
      a == b
    );
  }
}
