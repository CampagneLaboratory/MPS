package jetbrains.mps.project.foreign;

/*Generated by MPS */

import jetbrains.mps.vfs.IFile;
import org.jdom.JDOMException;
import java.io.IOException;
import org.jdom.Element;
import jetbrains.mps.util.JDOMUtil;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.xmlQuery.runtime.AttributeUtils;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;

public class IdeaModuleConfiguration {
  private MPSFacetConfiguration myMpsFacetConfiguration;
  private IFile myFile;

  private IdeaModuleConfiguration(IFile file) {
    this.myFile = file;
  }

  public IFile getModuleFile() {
    return myFile;
  }

  public MPSFacetConfiguration getMPSFacetConfiguration() {
    return myMpsFacetConfiguration;
  }

  private void setMPSFacetConfiguration(MPSFacetConfiguration mpsFacet) {
    this.myMpsFacetConfiguration = mpsFacet;

  }

  public static IdeaModuleConfiguration readFile(IFile moduleFile) throws JDOMException, IOException, FacetConfigurationFormatException {
    IdeaModuleConfiguration imc = new IdeaModuleConfiguration(moduleFile);
    Element module = (Element) JDOMUtil.loadDocument(moduleFile).getRootElement();
    Element cfg = ListSequence.fromList(AttributeUtils.elementChildren(ListSequence.fromList(AttributeUtils.elementChildren(ListSequence.fromList(AttributeUtils.elementChildren(module, "component")).findFirst(new IWhereFilter<Element>() {
      public boolean accept(Element ch) {
        return "FacetManager".equals(ch.getAttributeValue("name"));
      }
    }), "facet")).findFirst(new IWhereFilter<Element>() {
      public boolean accept(Element fct) {
        return "MPS".equals(fct.getAttributeValue("name"));
      }
    }), "configuration")).first();
    if (cfg != null) {
      MPSFacetConfiguration mpsFacet = new MPSFacetConfiguration();
      mpsFacet.readFromXml(cfg);
      imc.setMPSFacetConfiguration(mpsFacet);
    }
    return imc;
  }
}
