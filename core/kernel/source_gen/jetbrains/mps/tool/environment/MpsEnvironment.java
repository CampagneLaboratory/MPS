package jetbrains.mps.tool.environment;

/*Generated by MPS */

import java.util.Set;
import jetbrains.mps.project.Project;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import org.apache.log4j.BasicConfigurator;
import org.apache.log4j.Logger;
import org.apache.log4j.Level;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.io.File;

public class MpsEnvironment implements Environment {
  private final Set<Project> openedProjects = SetSequence.fromSet(new HashSet<Project>());
  private final EnvironmentConfig config;


  public MpsEnvironment(EnvironmentConfig config) {
    this.config = config;

    // todo: if creationg of environment fails? is it publication before we need it? 
    ActiveEnvironment.activateEnvironment(this);

    // todo: plugins, libs 

    // from CheckProjectStructureHelper 
    BasicConfigurator.configure();
    Logger.getRootLogger().setLevel(Level.INFO);
    // IdeMain.setTestMode(TestMode.CORE_TEST) 
    // TestMain.configureMPS(new String[0]) 
    for (String macro : MapSequence.fromMap(config.macros()).keySet()) {
      // todo: Testbench.setMacro(macro, macros[macro].getPath()) 
    }
    // todo: Testbench.initLibs() 
    // we do not make anything here 
    // we have a special test (Making) that does make 
    // and more importantly checks that make is ok and fails if not 
    // that should be enough 
  }



  public EnvironmentConfig getConfig() {
    return config;
  }

  public boolean hasIdeaInstance() {
    return false;
  }



  public Project openProject(File projectFile) {
    throw new UnsupportedOperationException();
  }

  public Project createDummyProject() {
    throw new UnsupportedOperationException();
  }

  public void disposeProject(final Project project) {
    throw new UnsupportedOperationException();
  }

  public void disposeEnvironment() {
    for (Project project : SetSequence.fromSetWithValues(new HashSet<Project>(), openedProjects)) {
      disposeProject(project);
    }

    // from CheckProjectStructureHelper 
    // todo: TestMain.disposeMPS() 

    ActiveEnvironment.deactivateEnvironment(this);
  }
}
