<?xml version="1.0" encoding="UTF-8"?>
<model modelUID="r:00000000-0000-4000-0000-011c895902e4(jetbrains.mps.lang.generator.typesystem)">
  <persistence version="3" />
  <refactoringHistory />
  <language namespace="7a5dda62-9140-4668-ab76-d5ed1746f2b2(jetbrains.mps.lang.typesystem)" />
  <language namespace="f3061a53-9226-4cc5-a443-f952ceaf5816(jetbrains.mps.baseLanguage)" />
  <language namespace="7866978e-a0f0-4cc7-81bc-4d213d9375e1(jetbrains.mps.lang.smodel)" />
  <language namespace="83888646-71ce-4f1c-9c53-c54016f6ad4f(jetbrains.mps.baseLanguage.collections)" />
  <language namespace="3a13115c-633c-4c5c-bbcc-75c4219e9555(jetbrains.mps.lang.quotation)" />
  <language namespace="d4615e3b-d671-4ba9-af01-2b78369b0ba7(jetbrains.mps.lang.pattern)" />
  <language namespace="ceab5195-25ea-4f22-9b92-103b95ca8c0c(jetbrains.mps.lang.core)" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902ae(jetbrains.mps.lang.typesystem.constraints)" version="17" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902c1(jetbrains.mps.baseLanguage.constraints)" version="83" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902ca(jetbrains.mps.baseLanguage.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902fb(jetbrains.mps.lang.smodel.constraints)" version="21" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590301(jetbrains.mps.lang.smodel.structure)" version="8" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590328(jetbrains.mps.baseLanguage.collections.constraints)" version="6" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c8959032e(jetbrains.mps.baseLanguage.collections.structure)" version="2" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590340(jetbrains.mps.lang.pattern.constraints)" version="2" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590283(jetbrains.mps.lang.core.constraints)" version="2" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c8959030d(jetbrains.mps.lang.constraints.structure)" version="1" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902e8(jetbrains.mps.lang.generator.structure)" version="2" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590338(jetbrains.mps.baseLanguage.closures.structure)" version="1" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902e2(jetbrains.mps.lang.generator.constraints)" version="16" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c8959028c(jetbrains.mps.lang.structure.constraints)" version="11" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902ba(jetbrains.mps.lang.sharedConcepts.constraints)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590334(jetbrains.mps.baseLanguage.closures.constraints)" version="2" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895903e4(jetbrains.mps.internal.collections.constraints)" version="2" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902db(jetbrains.mps.baseLanguage.blTypes.constraints)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590292(jetbrains.mps.lang.structure.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902bc(jetbrains.mps.lang.sharedConcepts.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c8959033d(jetbrains.mps.lang.annotations.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c8959034b(jetbrains.mps.lang.quotation.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590345(jetbrains.mps.lang.pattern.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902f3(jetbrains.mps.lang.generator.generationContext.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902b4(jetbrains.mps.lang.typesystem.structure)" version="0" />
  <maxImportIndex value="25" />
  <import index="3" modelUID="r:00000000-0000-4000-0000-011c895902e8(jetbrains.mps.lang.generator.structure)" version="2" />
  <import index="5" modelUID="r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)" version="0" />
  <import index="6" modelUID="f:java_stub#jetbrains.mps.smodel(jetbrains.mps.smodel@java_stub)" version="-1" />
  <import index="8" modelUID="r:00000000-0000-4000-0000-011c89590292(jetbrains.mps.lang.structure.structure)" version="0" />
  <import index="10" modelUID="r:00000000-0000-4000-0000-011c895902ca(jetbrains.mps.baseLanguage.structure)" version="0" />
  <import index="11" modelUID="r:00000000-0000-4000-0000-011c89590301(jetbrains.mps.lang.smodel.structure)" version="8" />
  <import index="12" modelUID="r:00000000-0000-4000-0000-011c8959032e(jetbrains.mps.baseLanguage.collections.structure)" version="2" />
  <import index="16" modelUID="f:java_stub#java.lang(java.lang@java_stub)" version="-1" />
  <import index="17" modelUID="f:java_stub#java.util(java.util@java_stub)" version="-1" />
  <import index="21" modelUID="r:00000000-0000-4000-0000-011c895902fa(jetbrains.mps.lang.smodel.behavior)" version="-1" />
  <import index="22" modelUID="f:java_stub#jetbrains.mps.generator.template(jetbrains.mps.generator.template@java_stub)" version="-1" />
  <import index="23" modelUID="r:00000000-0000-4000-0000-011c895902b5(jetbrains.mps.lang.typesystem.dependencies)" version="-1" />
  <import index="24" modelUID="r:00000000-0000-4000-0000-011c895902e1(jetbrains.mps.lang.generator.behavior)" version="-1" />
  <import index="25" modelUID="f:java_stub#jetbrains.mps.lang.generator.structure(jetbrains.mps.lang.generator.structure@java_stub)" version="-1" />
  <node type="jetbrains.mps.lang.typesystem.structure.InferenceRule" id="1178562976720">
    <property name="name" value="typeof_TemplateFunctionParameter_sourceNode" />
    <property name="overrides" value="true" />
    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178562976721">
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1206286434318">
        <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1206286435351">
          <link role="classConcept" targetNodeId="1178666070052" resolveInfo="QueriesUtil" />
          <link role="baseMethodDeclaration" targetNodeId="1178844146368" resolveInfo="get_templateFunction_inputNodeType" />
          <node role="actualArgument" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1206286435352">
            <link role="applicableNode" targetNodeId="1178562976716" resolveInfo="sourceNode" />
          </node>
          <node role="actualArgument" type="jetbrains.mps.lang.typesystem.structure.TypeOfExpression" id="1206286439885">
            <node role="term" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1206286441106">
              <link role="applicableNode" targetNodeId="1178562976716" resolveInfo="sourceNode" />
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="applicableNode" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1178562976716">
      <property name="name" value="sourceNode" />
      <link role="concept" targetNodeId="3.1167169188348" />
    </node>
  </node>
  <node type="jetbrains.mps.lang.typesystem.structure.InferenceRule" id="1178562976728">
    <property name="name" value="typeof_Root_MappingRule" />
    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178562976729">
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178564471181">
        <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178564471182">
          <property name="name" value="template" />
          <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178564471183">
            <link role="concept" targetNodeId="5.1169194658468" />
          </node>
          <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227901229">
            <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1178564455057">
              <link role="applicableNode" targetNodeId="1178562976717" resolveInfo="rule" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178564462487">
              <link role="link" targetNodeId="3.1167514355421" />
            </node>
          </node>
        </node>
      </node>
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178564475898">
        <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178564475899">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178565150429">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178565150430">
              <property name="name" value="attrib" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178565173080" />
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204753470794">
                <node role="operand" type="jetbrains.mps.lang.smodel.structure.SemanticDowncastExpression" id="1178564514830">
                  <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178564512291">
                    <link role="variableDeclaration" targetNodeId="1178564471182" resolveInfo="template" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1204753470795">
                  <link role="baseMethodDeclaration" targetNodeId="6.~SNode.getAttribute(java.lang.String):jetbrains.mps.smodel.SNode" resolveInfo="getAttribute" />
                  <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1178565127726">
                    <link role="classifier" targetNodeId="25.~RootTemplateAnnotation_AnnotationLink" resolveInfo="RootTemplateAnnotation_AnnotationLink" />
                    <link role="variableDeclaration" targetNodeId="25.~RootTemplateAnnotation_AnnotationLink.ROOT_TEMPLATE_ANNOTATION" resolveInfo="ROOT_TEMPLATE_ANNOTATION" />
                  </node>
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178565177444">
            <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178565177445">
              <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178565253500">
                <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178565253501">
                  <property name="name" value="templateApplicableConcept" />
                  <node role="type" type="jetbrains.mps.lang.smodel.structure.SConceptType" id="1183152964098" />
                  <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227957919">
                    <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178565234287">
                      <link role="concept" targetNodeId="3.1168619357332" />
                      <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178565219730">
                        <link role="variableDeclaration" targetNodeId="1178565150430" resolveInfo="attrib" />
                      </node>
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178565244719">
                      <link role="link" targetNodeId="3.1168619429071" />
                    </node>
                  </node>
                </node>
              </node>
              <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178565280618">
                <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178565280619">
                  <property name="name" value="ruleApplicableConcept" />
                  <node role="type" type="jetbrains.mps.lang.smodel.structure.SConceptType" id="1183152968637" />
                  <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227943064">
                    <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1178565267021">
                      <link role="applicableNode" targetNodeId="1178562976717" resolveInfo="rule" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178565272475">
                      <link role="link" targetNodeId="3.1167169349424" />
                    </node>
                  </node>
                </node>
              </node>
              <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1183153521350">
                <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1183153521351">
                  <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1183153521352">
                    <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1183153521353">
                      <node role="statement" type="jetbrains.mps.lang.typesystem.structure.ReportErrorStatement" id="1183153521354">
                        <node role="errorString" type="jetbrains.mps.baseLanguage.structure.PlusExpression" id="1183153521355">
                          <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.PlusExpression" id="1183153620070">
                            <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227932839">
                              <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1183153585039">
                                <link role="variableDeclaration" targetNodeId="1178565280619" resolveInfo="ruleApplicableConcept" />
                              </node>
                              <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1183153617929">
                                <link role="property" targetNodeId="5.1169194664001" />
                              </node>
                            </node>
                            <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1183153626414">
                              <property name="value" value="'" />
                            </node>
                          </node>
                          <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1183153521357">
                            <property name="value" value="template is not applicable to the rule concept '" />
                          </node>
                        </node>
                        <node role="nodeToReport" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1183153590737">
                          <link role="applicableNode" targetNodeId="1178562976717" resolveInfo="rule" />
                        </node>
                      </node>
                    </node>
                    <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotExpression" id="1183153521359">
                      <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227899636">
                        <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1183153569711">
                          <link role="variableDeclaration" targetNodeId="1178565280619" resolveInfo="ruleApplicableConcept" />
                        </node>
                        <node role="operation" type="jetbrains.mps.lang.smodel.structure.Concept_IsSubConceptOfOperation" id="1183153521361">
                          <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.PoundExpression" id="1207675646022">
                            <node role="expression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1183153574797">
                              <link role="variableDeclaration" targetNodeId="1178565253501" resolveInfo="templateApplicableConcept" />
                            </node>
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
                <node role="condition" type="jetbrains.mps.baseLanguage.structure.AndExpression" id="1183153521365">
                  <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227905684">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1183153530451">
                      <link role="variableDeclaration" targetNodeId="1178565253501" resolveInfo="templateApplicableConcept" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsNotNullOperation" id="1183153561797" />
                  </node>
                  <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227852141">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1183153525832">
                      <link role="variableDeclaration" targetNodeId="1178565280619" resolveInfo="ruleApplicableConcept" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsNotNullOperation" id="1183153555933" />
                  </node>
                </node>
              </node>
            </node>
            <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227841233">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178565179598">
                <link role="variableDeclaration" targetNodeId="1178565150430" resolveInfo="attrib" />
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsNotNullOperation" id="1178565190589" />
            </node>
          </node>
        </node>
        <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227943460">
          <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178564479532">
            <link role="variableDeclaration" targetNodeId="1178564471182" resolveInfo="template" />
          </node>
          <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsNotNullOperation" id="1178564490343" />
        </node>
      </node>
    </node>
    <node role="applicableNode" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1178562976717">
      <property name="name" value="rule" />
      <link role="concept" targetNodeId="3.1167514355419" />
    </node>
  </node>
  <node type="jetbrains.mps.lang.typesystem.structure.InferenceRule" id="1178562976736">
    <property name="name" value="typeof_WeaveEach_RuleConsequence" />
    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178562976737">
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178722997399">
        <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178722997400">
          <property name="name" value="templateApplicableConcept" />
          <property name="isFinal" value="true" />
          <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178722997401">
            <link role="concept" targetNodeId="8.1169125787135" />
          </node>
          <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227942923">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227910194">
              <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1178722978043">
                <link role="applicableNode" targetNodeId="1178562976718" resolveInfo="weaveEach" />
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178722983223">
                <link role="link" targetNodeId="3.1169569853122" />
              </node>
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178722988454">
              <link role="link" targetNodeId="3.1168285871518" />
            </node>
          </node>
        </node>
      </node>
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178723004683">
        <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178723004684">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178723012441" />
        </node>
        <node role="condition" type="jetbrains.mps.baseLanguage.structure.EqualsExpression" id="1178723008594">
          <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178723010698" />
          <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178723006678">
            <link role="variableDeclaration" targetNodeId="1178722997400" resolveInfo="templateApplicableConcept" />
          </node>
        </node>
      </node>
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178723042344">
        <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178723042345">
          <property name="name" value="query" />
          <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178723042346">
            <link role="concept" targetNodeId="3.1167951910403" />
          </node>
          <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227942160">
            <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1178723028130">
              <link role="applicableNode" targetNodeId="1178562976718" resolveInfo="weaveEach" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178723037053">
              <link role="link" targetNodeId="3.1169569939267" />
            </node>
          </node>
        </node>
      </node>
      <node role="statement" type="jetbrains.mps.lang.typesystem.structure.TypeVarDeclaration" id="1186133119902">
        <property name="name" value="NodeType" />
      </node>
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1206286494390">
        <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1206286502783">
          <link role="baseMethodDeclaration" targetNodeId="1184801497276" resolveInfo="equate_outputNodeType_fromSourceQuery" />
          <link role="classConcept" targetNodeId="1178666070052" resolveInfo="QueriesUtil" />
          <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1206286502784">
            <link role="variableDeclaration" targetNodeId="1178723042345" resolveInfo="query" />
          </node>
          <node role="actualArgument" type="jetbrains.mps.lang.typesystem.structure.TypeVarReference" id="1206286508052">
            <link role="typeVarDeclaration" targetNodeId="1186133119902" resolveInfo="NodeType" />
          </node>
        </node>
      </node>
      <node role="statement" type="jetbrains.mps.lang.typesystem.structure.WhenConcreteStatement" id="1186133214609">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1186133214610">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1186133221693">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1186133221694">
              <property name="name" value="nodeConcept" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1186133221695">
                <link role="concept" targetNodeId="8.1169125787135" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227956339">
                <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1186133221697">
                  <link role="concept" targetNodeId="11.1138055754698" />
                  <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.WhenConcreteVariableReference" id="1206286533352">
                    <link role="whenConcreteVar" targetNodeId="1206286517366" resolveInfo="NT" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1186133221699">
                  <link role="link" targetNodeId="11.1138405853777" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1186133221700">
            <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1186133221701">
              <node role="statement" type="jetbrains.mps.lang.typesystem.structure.ReportErrorStatement" id="1186133221702">
                <node role="errorString" type="jetbrains.mps.baseLanguage.structure.PlusExpression" id="1186133221703">
                  <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.WhenConcreteVariableReference" id="1206286536041">
                    <link role="whenConcreteVar" targetNodeId="1206286517366" resolveInfo="NT" />
                  </node>
                  <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1186133221705">
                    <property name="value" value="template is not applicable to " />
                  </node>
                </node>
                <node role="nodeToReport" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1186133221706">
                  <link role="applicableNode" targetNodeId="1178562976718" resolveInfo="weaveEach" />
                </node>
              </node>
            </node>
            <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotExpression" id="1186133221707">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1186133221708">
                <link role="classConcept" targetNodeId="6.~SModelUtil_new" resolveInfo="SModelUtil_new" />
                <link role="baseMethodDeclaration" targetNodeId="6.~SModelUtil_new.isAssignableConcept(jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration,jetbrains.mps.lang.structure.structure.AbstractConceptDeclaration):boolean" resolveInfo="isAssignableConcept" />
                <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204672721403">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1186133221710">
                    <link role="variableDeclaration" targetNodeId="1186133221694" resolveInfo="nodeConcept" />
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetAdapterOperation" id="1186133221711" />
                </node>
                <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204672721668">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1186133221713">
                    <link role="variableDeclaration" targetNodeId="1178722997400" resolveInfo="templateApplicableConcept" />
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetAdapterOperation" id="1186133221714" />
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="argument" type="jetbrains.mps.lang.typesystem.structure.TypeVarReference" id="1186133217378">
          <link role="typeVarDeclaration" targetNodeId="1186133119902" resolveInfo="NodeType" />
        </node>
        <node role="argumentRepresentator" type="jetbrains.mps.lang.typesystem.structure.WhenConcreteVariableDeclaration" id="1206286517366">
          <property name="name" value="NT" />
          <node role="type" type="jetbrains.mps.baseLanguage.structure.Type" id="1206286517367" />
        </node>
      </node>
    </node>
    <node role="applicableNode" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1178562976718">
      <property name="name" value="weaveEach" />
      <link role="concept" targetNodeId="3.1169569792945" />
    </node>
  </node>
  <node type="jetbrains.mps.lang.typesystem.structure.InferenceRule" id="1178562976744">
    <property name="name" value="typeof_TemplateDeclarationReference" />
    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178562976745">
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178721749744">
        <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178721749745">
          <property name="name" value="rule" />
          <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178721749746">
            <link role="concept" targetNodeId="3.1167169308231" />
          </node>
          <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227881089">
            <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1178721708334">
              <link role="applicableNode" targetNodeId="1178562976719" resolveInfo="templateReference" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetAncestorOperation" id="1178721716014">
              <node role="parameter" type="jetbrains.mps.lang.smodel.structure.OperationParm_Concept" id="1178721719658">
                <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1207675648303">
                  <link role="conceptDeclaration" targetNodeId="3.1167169308231" resolveInfo="BaseMappingRule" />
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178721780457">
        <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178721780458">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1183153405890">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1183153405891">
              <property name="name" value="templateApplicableConcept" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SConceptType" id="1183153405892" />
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227957814">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227934531">
                  <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1183153408091">
                    <link role="applicableNode" targetNodeId="1178562976719" resolveInfo="templateReference" />
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1183153405896">
                    <link role="link" targetNodeId="3.1168559393589" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1183153405897">
                  <link role="link" targetNodeId="3.1168285871518" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178721808199">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178721808200">
              <property name="name" value="ruleApplicableConcept" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SConceptType" id="1183153284041" />
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227919706">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178721793216">
                  <link role="variableDeclaration" targetNodeId="1178721749745" resolveInfo="rule" />
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178721802505">
                  <link role="link" targetNodeId="3.1167169349424" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178721817697">
            <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178721817698">
              <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1183153339133">
                <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1183153339134">
                  <node role="statement" type="jetbrains.mps.lang.typesystem.structure.ReportErrorStatement" id="1183153489205">
                    <node role="errorString" type="jetbrains.mps.baseLanguage.structure.PlusExpression" id="1183153489206">
                      <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.PlusExpression" id="1183153701928">
                        <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1183153712857">
                          <property name="value" value="'" />
                        </node>
                        <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227833280">
                          <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1183153495352">
                            <link role="variableDeclaration" targetNodeId="1178721808200" resolveInfo="ruleApplicableConcept" />
                          </node>
                          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1183153699884">
                            <link role="property" targetNodeId="5.1169194664001" />
                          </node>
                        </node>
                      </node>
                      <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1183153489208">
                        <property name="value" value="template is not applicable to the rule concept '" />
                      </node>
                    </node>
                    <node role="nodeToReport" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1183153499531">
                      <link role="applicableNode" targetNodeId="1178562976719" resolveInfo="templateReference" />
                    </node>
                  </node>
                </node>
                <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotExpression" id="1183153477564">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227919329">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1183153477569">
                      <link role="variableDeclaration" targetNodeId="1178721808200" resolveInfo="ruleApplicableConcept" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.Concept_IsSubConceptOfOperation" id="1183153477566">
                      <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.PoundExpression" id="1207675646020">
                        <node role="expression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1183153477568">
                          <link role="variableDeclaration" targetNodeId="1183153405891" resolveInfo="templateApplicableConcept" />
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
            <node role="condition" type="jetbrains.mps.baseLanguage.structure.AndExpression" id="1183153423895">
              <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1183153429351">
                <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1183153431063" />
                <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1183153427529">
                  <link role="variableDeclaration" targetNodeId="1183153405891" resolveInfo="templateApplicableConcept" />
                </node>
              </node>
              <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1178721993099">
                <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178721993097">
                  <link role="variableDeclaration" targetNodeId="1178721808200" resolveInfo="ruleApplicableConcept" />
                </node>
                <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178721993098" />
              </node>
            </node>
          </node>
        </node>
        <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1178721788032">
          <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178721790116" />
          <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178721785479">
            <link role="variableDeclaration" targetNodeId="1178721749745" resolveInfo="rule" />
          </node>
        </node>
      </node>
    </node>
    <node role="applicableNode" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1178562976719">
      <property name="name" value="templateReference" />
      <link role="concept" targetNodeId="3.1168559333462" />
    </node>
  </node>
  <node type="jetbrains.mps.baseLanguage.structure.ClassConcept" id="1178666070052">
    <property name="name" value="QueriesUtil" />
    <node role="staticMethod" type="jetbrains.mps.baseLanguage.structure.StaticMethodDeclaration" id="1178844146368">
      <property name="name" value="equate_templateFunction_inputNodeType" />
      <node role="returnType" type="jetbrains.mps.baseLanguage.structure.VoidType" id="1206286331315" />
      <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178844146371">
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178907996306">
          <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178907996307">
            <property name="name" value="enclosingMacro" />
            <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178907996308" />
            <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227916835">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178908018055">
                <link role="variableDeclaration" targetNodeId="1178844345408" resolveInfo="contextNode" />
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetAncestorOperation" id="1178907996311">
                <node role="parameter" type="jetbrains.mps.lang.smodel.structure.OperationParm_ConceptList" id="1178907996312">
                  <node role="concept" type="jetbrains.mps.lang.smodel.structure.ConceptReference" id="1178907996313">
                    <link role="concept" targetNodeId="3.1087833241328" />
                  </node>
                  <node role="concept" type="jetbrains.mps.lang.smodel.structure.ConceptReference" id="1178907996314">
                    <link role="concept" targetNodeId="3.1088761943574" />
                  </node>
                  <node role="concept" type="jetbrains.mps.lang.smodel.structure.ConceptReference" id="1178907996315">
                    <link role="concept" targetNodeId="3.1087833466690" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178907996316">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178907996317">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1184800063360">
              <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1184800063361">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.RemarkStatement" id="1203116019273">
                  <property name="value" value="inside mapper func?" />
                </node>
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1203116192572">
                  <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1203116192573">
                    <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1203116363339">
                      <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1203116363340">
                        <property name="name" value="query" />
                        <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1203116363341">
                          <link role="concept" targetNodeId="3.1168024337012" resolveInfo="SourceSubstituteMacro_SourceNodeQuery" />
                        </node>
                        <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227925557">
                          <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1203116363344">
                            <link role="concept" targetNodeId="3.1131073187192" resolveInfo="MapSrcNodeMacro" />
                            <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1203116363345">
                              <link role="variableDeclaration" targetNodeId="1178907996307" resolveInfo="enclosingMacro" />
                            </node>
                          </node>
                          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1203116363343">
                            <link role="link" targetNodeId="3.1168281849769" />
                          </node>
                        </node>
                      </node>
                    </node>
                    <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1203116363346">
                      <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1203116363347">
                        <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1203116363348" />
                        <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1203116363349">
                          <link role="variableDeclaration" targetNodeId="1203116363340" resolveInfo="query" />
                        </node>
                      </node>
                      <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1203116363350">
                        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1206286346476">
                          <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1206286347494">
                            <link role="baseMethodDeclaration" targetNodeId="1184801497276" resolveInfo="equate_outputNodeType_fromSourceQuery" />
                            <link role="classConcept" targetNodeId="1178666070052" resolveInfo="QueriesUtil" />
                            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1206286347495">
                              <link role="variableDeclaration" targetNodeId="1203116363340" resolveInfo="query" />
                            </node>
                            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1206286347496">
                              <link role="variableDeclaration" targetNodeId="1206286195782" resolveInfo="InputNodeType" />
                            </node>
                          </node>
                        </node>
                        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1203116363351" />
                      </node>
                    </node>
                  </node>
                  <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227849948">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227927582">
                      <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1203116241920">
                        <link role="variableDeclaration" targetNodeId="1178844345408" resolveInfo="contextNode" />
                      </node>
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetAncestorOperation" id="1203116256002">
                        <node role="parameter" type="jetbrains.mps.lang.smodel.structure.OperationParm_Inclusion" id="1203116260690" />
                        <node role="parameter" type="jetbrains.mps.lang.smodel.structure.OperationParm_Concept" id="1203116264505">
                          <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1207675648309">
                            <link role="conceptDeclaration" targetNodeId="3.1170725621272" resolveInfo="MapSrcMacro_MapperFunction" />
                          </node>
                        </node>
                      </node>
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsNotNullOperation" id="1203116331181" />
                  </node>
                </node>
              </node>
              <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227945548">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1184800088677">
                  <link role="variableDeclaration" targetNodeId="1178907996307" resolveInfo="enclosingMacro" />
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1184800093524">
                  <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1184800115792">
                    <link role="conceptDeclaration" targetNodeId="3.1131073187192" />
                  </node>
                </node>
              </node>
            </node>
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1184800575856">
              <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1184800575857">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.RemarkStatement" id="1203116379495">
                  <property name="value" value="inside mapper func?" />
                </node>
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1203116393387">
                  <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1203116393388">
                    <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1203116401819">
                      <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1203116401820">
                        <property name="name" value="query" />
                        <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1203116401821">
                          <link role="concept" targetNodeId="3.1167951910403" resolveInfo="SourceSubstituteMacro_SourceNodesQuery" />
                        </node>
                        <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227938736">
                          <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1203116401824">
                            <link role="concept" targetNodeId="3.1133037731736" resolveInfo="MapSrcListMacro" />
                            <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1203116401825">
                              <link role="variableDeclaration" targetNodeId="1178907996307" resolveInfo="enclosingMacro" />
                            </node>
                          </node>
                          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1203116401823">
                            <link role="link" targetNodeId="3.1168291362368" />
                          </node>
                        </node>
                      </node>
                    </node>
                    <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1203116401826">
                      <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1203116401827">
                        <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1203116401828" />
                        <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1203116401829">
                          <link role="variableDeclaration" targetNodeId="1203116401820" resolveInfo="query" />
                        </node>
                      </node>
                      <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1203116401830">
                        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1206286314291">
                          <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1206286315184">
                            <link role="classConcept" targetNodeId="1178666070052" resolveInfo="QueriesUtil" />
                            <link role="baseMethodDeclaration" targetNodeId="1184801497276" resolveInfo="equate_outputNodeType_fromSourceQuery" />
                            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1206286315185">
                              <link role="variableDeclaration" targetNodeId="1203116401820" resolveInfo="query" />
                            </node>
                            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1206286322283">
                              <link role="variableDeclaration" targetNodeId="1206286195782" resolveInfo="InputNodeType" />
                            </node>
                          </node>
                        </node>
                        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1203116401831" />
                      </node>
                    </node>
                  </node>
                  <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227841180">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227918665">
                      <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1203116393410">
                        <link role="variableDeclaration" targetNodeId="1178844345408" resolveInfo="contextNode" />
                      </node>
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetAncestorOperation" id="1203116393407">
                        <node role="parameter" type="jetbrains.mps.lang.smodel.structure.OperationParm_Inclusion" id="1203116393408" />
                        <node role="parameter" type="jetbrains.mps.lang.smodel.structure.OperationParm_Concept" id="1203116393409">
                          <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1207675648338">
                            <link role="conceptDeclaration" targetNodeId="3.1170725621272" resolveInfo="MapSrcMacro_MapperFunction" />
                          </node>
                        </node>
                      </node>
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsNotNullOperation" id="1203116393405" />
                  </node>
                </node>
              </node>
              <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227933902">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1184800575876">
                  <link role="variableDeclaration" targetNodeId="1178907996307" resolveInfo="enclosingMacro" />
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1184800575874">
                  <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1184800588487">
                    <link role="conceptDeclaration" targetNodeId="3.1133037731736" />
                  </node>
                </node>
              </node>
            </node>
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1184078877493">
              <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1184078877494">
                <property name="name" value="enclosingNodeMacro" />
                <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1184078877495" />
                <node role="initializer" type="jetbrains.mps.baseLanguage.structure.TernaryOperatorExpression" id="1184078907583">
                  <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1184078912453">
                    <link role="variableDeclaration" targetNodeId="1178907996307" resolveInfo="enclosingMacro" />
                  </node>
                  <node role="ifFalse" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1184078916088" />
                  <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227937606">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1184078888841">
                      <link role="variableDeclaration" targetNodeId="1178907996307" resolveInfo="enclosingMacro" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1184078899083">
                      <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1184078901968">
                        <link role="conceptDeclaration" targetNodeId="3.1087833466690" />
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178907996318">
              <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178907996319">
                <property name="name" value="macroOwner" />
                <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178907996320" />
                <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227939555">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178907996322">
                    <link role="variableDeclaration" targetNodeId="1178907996307" resolveInfo="enclosingMacro" />
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetParentOperation" id="1178907996323" />
                </node>
              </node>
            </node>
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178907996324">
              <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178907996325">
                <property name="name" value="prevSourceSubstituteMacro" />
                <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178907996326">
                  <link role="concept" targetNodeId="3.1167951328751" />
                </node>
                <node role="initializer" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1178907996327">
                  <link role="classConcept" targetNodeId="1178666070052" resolveInfo="Util_TLBase_types" />
                  <link role="baseMethodDeclaration" targetNodeId="1178667009993" resolveInfo="getEnclosing_SourceSubstituteMacro" />
                  <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178907996328">
                    <link role="variableDeclaration" targetNodeId="1178907996319" resolveInfo="macroOwner" />
                  </node>
                  <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1184078946330">
                    <link role="variableDeclaration" targetNodeId="1184078877494" resolveInfo="enclosingNodeMacro" />
                  </node>
                </node>
              </node>
            </node>
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178907996330">
              <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178907996331">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178907996332">
                  <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178907996333">
                    <property name="name" value="query" />
                    <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178907996334">
                      <link role="concept" targetNodeId="10.1137021947720" />
                    </node>
                    <node role="initializer" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1178907996335">
                      <link role="classConcept" targetNodeId="1178666070052" resolveInfo="Util_TLBase_types" />
                      <link role="baseMethodDeclaration" targetNodeId="1178667968416" resolveInfo="getQueryFunction_fromSourceSubstituteMacro" />
                      <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178907996336">
                        <link role="variableDeclaration" targetNodeId="1178907996325" resolveInfo="prevSourceSubstituteMacro" />
                      </node>
                    </node>
                  </node>
                </node>
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178907996337">
                  <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178907996338">
                    <property name="name" value="nodeType" />
                    <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178907996339">
                      <link role="concept" targetNodeId="11.1138055754698" />
                    </node>
                  </node>
                </node>
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1206286291237">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1206286292083">
                    <link role="baseMethodDeclaration" targetNodeId="1184801497276" resolveInfo="equate_outputNodeType_fromSourceQuery" />
                    <link role="classConcept" targetNodeId="1178666070052" resolveInfo="QueriesUtil" />
                    <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1206286292084">
                      <link role="variableDeclaration" targetNodeId="1178907996333" resolveInfo="query" />
                    </node>
                    <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1206286296758">
                      <link role="variableDeclaration" targetNodeId="1206286195782" resolveInfo="InputNodeType" />
                    </node>
                  </node>
                </node>
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178907996345" />
              </node>
              <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1178907996346">
                <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178907996347" />
                <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178907996348">
                  <link role="variableDeclaration" targetNodeId="1178907996325" resolveInfo="prevSourceSubstituteMacro" />
                </node>
              </node>
            </node>
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1178907996349">
            <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178907996350" />
            <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178907996351">
              <link role="variableDeclaration" targetNodeId="1178907996307" resolveInfo="enclosingMacro" />
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.RemarkStatement" id="1178907996352">
          <property name="value" value="===============" />
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178907996353">
          <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178907996354">
            <property name="name" value="applicableConcept" />
            <node role="type" type="jetbrains.mps.lang.smodel.structure.SConceptType" id="1178907996355" />
            <node role="initializer" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1178907996356">
              <link role="classConcept" targetNodeId="1178666070052" resolveInfo="Util_TLBase_types" />
              <link role="baseMethodDeclaration" targetNodeId="1178670165537" resolveInfo="getApplicableConcept_fromEnvironment" />
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178908209916">
                <link role="variableDeclaration" targetNodeId="1178844345408" resolveInfo="contextNode" />
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateEquationStatement" id="1206286374200">
          <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1206286379689">
            <node role="normalType" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1206286379690">
              <link role="variableDeclaration" targetNodeId="1206286195782" resolveInfo="InputNodeType" />
            </node>
          </node>
          <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1206286374203">
            <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1197310837748">
              <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197310837749">
                <node role="referenceAntiquotation$link_attribute$concept" type="jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation" id="1197310837752">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197310837753">
                    <link role="variableDeclaration" targetNodeId="1178907996354" resolveInfo="applicableConcept" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
      <node role="parameter" type="jetbrains.mps.baseLanguage.structure.ParameterDeclaration" id="1178844345408">
        <property name="name" value="contextNode" />
        <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178844345409" />
      </node>
      <node role="parameter" type="jetbrains.mps.baseLanguage.structure.ParameterDeclaration" id="1206286195782">
        <property name="name" value="InputNodeType" />
        <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1206286205643" />
      </node>
      <node role="annotation" type="jetbrains.mps.baseLanguage.structure.AnnotationInstance" id="1200405794119">
        <link role="annotation" targetNodeId="23.1196177069451" resolveInfo="InferenceMethod" />
      </node>
      <node role="visibility" type="jetbrains.mps.baseLanguage.structure.PublicVisibility" id="1200913807646" />
    </node>
    <node role="staticMethod" type="jetbrains.mps.baseLanguage.structure.StaticMethodDeclaration" id="1178667009993">
      <property name="name" value="getEnclosing_SourceSubstituteMacro" />
      <node role="returnType" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178667032128">
        <link role="concept" targetNodeId="3.1167951328751" />
      </node>
      <node role="visibility" type="jetbrains.mps.baseLanguage.structure.PrivateVisibility" id="1178908772191" />
      <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178667009996">
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178667729634">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178667729635">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178667738589">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178667740485" />
            </node>
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.EqualsExpression" id="1178667733925">
            <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178667736578" />
            <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178667732569">
              <link role="variableDeclaration" targetNodeId="1178667020595" resolveInfo="node" />
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178667158264">
          <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178667158265">
            <property name="name" value="attributes" />
            <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeListType" id="1178667166192" />
            <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204753471282">
              <node role="operand" type="jetbrains.mps.lang.smodel.structure.SemanticDowncastExpression" id="1178667139226">
                <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178667130053">
                  <link role="variableDeclaration" targetNodeId="1178667020595" resolveInfo="node" />
                </node>
              </node>
              <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1204753471283">
                <link role="baseMethodDeclaration" targetNodeId="6.~SNode.getAllAttributes():java.util.List" resolveInfo="getAllAttributes" />
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178667187693">
          <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178667187694">
            <property name="name" value="prevMacro" />
            <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178667187695">
              <link role="concept" targetNodeId="3.1167951328751" />
            </node>
            <node role="initializer" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178667202119" />
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.collections.structure.ForEachStatement" id="1178667279971">
          <node role="variable" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariable" id="1178667279972">
            <property name="name" value="attribute" />
          </node>
          <node role="inputSequence" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178667290337">
            <link role="variableDeclaration" targetNodeId="1178667158265" resolveInfo="attributes" />
          </node>
          <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178667279974">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178667342919">
              <node role="condition" type="jetbrains.mps.baseLanguage.structure.EqualsExpression" id="1178667347905">
                <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178667350288">
                  <link role="variableDeclaration" targetNodeId="1178667326734" resolveInfo="currMacroNode" />
                </node>
                <node role="leftExpression" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariableReference" id="1178667346287">
                  <link role="variable" targetNodeId="1178667279972" resolveInfo="attribute" />
                </node>
              </node>
              <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178667342921">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.BreakStatement" id="1178667352826" />
              </node>
            </node>
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178667366463">
              <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178667366464">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178667390814">
                  <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178667390815">
                    <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178667428180">
                      <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178667428181">
                        <node role="statement" type="jetbrains.mps.baseLanguage.structure.RemarkStatement" id="1178667477624">
                          <property name="value" value="the query is optional - continue 'enclosing macro' look-up" />
                        </node>
                        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ContinueStatement" id="1178667500375" />
                      </node>
                      <node role="condition" type="jetbrains.mps.baseLanguage.structure.EqualsExpression" id="1178667460402">
                        <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178667462881" />
                        <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227845120">
                          <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178667435854">
                            <link role="concept" targetNodeId="3.1131073187192" />
                            <node role="leftExpression" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariableReference" id="1178667433580">
                              <link role="variable" targetNodeId="1178667279972" resolveInfo="attribute" />
                            </node>
                          </node>
                          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178667456282">
                            <link role="link" targetNodeId="3.1168281849769" />
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                  <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227884728">
                    <node role="operand" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariableReference" id="1178667393776">
                      <link role="variable" targetNodeId="1178667279972" resolveInfo="attribute" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1178667399010">
                      <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1178667410580">
                        <link role="conceptDeclaration" targetNodeId="3.1131073187192" />
                      </node>
                    </node>
                  </node>
                </node>
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178667527165">
                  <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178667527166">
                    <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178667527167">
                      <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178667527168">
                        <node role="statement" type="jetbrains.mps.baseLanguage.structure.RemarkStatement" id="1178667527169">
                          <property name="value" value="the query is optional - continue 'enclosing macro' look-up" />
                        </node>
                        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ContinueStatement" id="1178667527170" />
                      </node>
                      <node role="condition" type="jetbrains.mps.baseLanguage.structure.EqualsExpression" id="1178667527171">
                        <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178667527172" />
                        <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227884119">
                          <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178667527174">
                            <link role="concept" targetNodeId="3.1112731569622" />
                            <node role="leftExpression" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariableReference" id="1178667527175">
                              <link role="variable" targetNodeId="1178667279972" resolveInfo="attribute" />
                            </node>
                          </node>
                          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178667548747">
                            <link role="link" targetNodeId="3.1168380395224" />
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                  <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227887370">
                    <node role="operand" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariableReference" id="1178667527178">
                      <link role="variable" targetNodeId="1178667279972" resolveInfo="attribute" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1178667527179">
                      <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1178667535665">
                        <link role="conceptDeclaration" targetNodeId="3.1112731569622" />
                      </node>
                    </node>
                  </node>
                </node>
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.RemarkStatement" id="1178667578205">
                  <property name="value" value="========" />
                </node>
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1178667585446">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.AssignmentExpression" id="1178667587754">
                    <node role="rValue" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178667595294">
                      <link role="concept" targetNodeId="3.1167951328751" />
                      <node role="leftExpression" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariableReference" id="1178667591532">
                        <link role="variable" targetNodeId="1178667279972" resolveInfo="attribute" />
                      </node>
                    </node>
                    <node role="lValue" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178667585447">
                      <link role="variableDeclaration" targetNodeId="1178667187694" resolveInfo="prevMacro" />
                    </node>
                  </node>
                </node>
              </node>
              <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227932873">
                <node role="operand" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariableReference" id="1178667369285">
                  <link role="variable" targetNodeId="1178667279972" resolveInfo="attribute" />
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1178667373675">
                  <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1178667379276">
                    <link role="conceptDeclaration" targetNodeId="3.1167951328751" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.RemarkStatement" id="1178667632123">
          <property name="value" value="========" />
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178667637097">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178667637098">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178667656177">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178667658407">
                <link role="variableDeclaration" targetNodeId="1178667187694" resolveInfo="prevMacro" />
              </node>
            </node>
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1178667647529">
            <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178667649385" />
            <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178667643829">
              <link role="variableDeclaration" targetNodeId="1178667187694" resolveInfo="prevMacro" />
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178667747405">
          <node role="expression" type="jetbrains.mps.baseLanguage.structure.LocalStaticMethodCall" id="1178667747406">
            <link role="baseMethodDeclaration" targetNodeId="1178667009993" resolveInfo="getEnclosing_SourceSubstituteMacro" />
            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227923222">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178667747408">
                <link role="variableDeclaration" targetNodeId="1178667020595" resolveInfo="node" />
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetParentOperation" id="1178667747409" />
            </node>
            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178667756518" />
          </node>
        </node>
      </node>
      <node role="parameter" type="jetbrains.mps.baseLanguage.structure.ParameterDeclaration" id="1178667020595">
        <property name="name" value="node" />
        <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178667020596" />
      </node>
      <node role="parameter" type="jetbrains.mps.baseLanguage.structure.ParameterDeclaration" id="1178667326734">
        <property name="name" value="currMacroNode" />
        <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178667330163" />
      </node>
    </node>
    <node role="staticMethod" type="jetbrains.mps.baseLanguage.structure.StaticMethodDeclaration" id="1178667968416">
      <property name="name" value="getQueryFunction_fromSourceSubstituteMacro" />
      <node role="returnType" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178667975635">
        <link role="concept" targetNodeId="10.1137021947720" />
      </node>
      <node role="visibility" type="jetbrains.mps.baseLanguage.structure.PrivateVisibility" id="1178908794040" />
      <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178667968419">
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178668081224">
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.EqualsExpression" id="1178668087405">
            <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178668089558" />
            <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668085986">
              <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
            </node>
          </node>
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178668081226">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178668091849">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178668094042" />
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178668204449">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178668204450">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178668204451">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227932845">
                <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178668204453">
                  <link role="concept" targetNodeId="3.1112731569622" />
                  <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668204454">
                    <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178668204455">
                  <link role="link" targetNodeId="3.1168380395224" />
                </node>
              </node>
            </node>
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227842555">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668204457">
              <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1178668204458">
              <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1178668204459">
                <link role="conceptDeclaration" targetNodeId="3.1112731569622" />
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178668229889">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178668229890">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178668229891">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227910227">
                <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178668229893">
                  <link role="concept" targetNodeId="3.1114706874351" />
                  <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668229894">
                    <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178668253446">
                  <link role="link" targetNodeId="3.1168024447342" />
                </node>
              </node>
            </node>
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227847836">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668229897">
              <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1178668229898">
              <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1178668239168">
                <link role="conceptDeclaration" targetNodeId="3.1114706874351" />
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178668256716">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178668256717">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178668256718">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227911266">
                <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178668256720">
                  <link role="concept" targetNodeId="3.1131073187192" />
                  <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668256721">
                    <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178668274733">
                  <link role="link" targetNodeId="3.1168281849769" />
                </node>
              </node>
            </node>
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227848722">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668256724">
              <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1178668256725">
              <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1178668266154">
                <link role="conceptDeclaration" targetNodeId="3.1131073187192" />
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178668278568">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178668278569">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178668278570">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227909188">
                <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178668278572">
                  <link role="concept" targetNodeId="3.1118786554307" />
                  <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668278573">
                    <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178668294481">
                  <link role="link" targetNodeId="3.1167952069335" />
                </node>
              </node>
            </node>
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227920697">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668278576">
              <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1178668278577">
              <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1178668288601">
                <link role="conceptDeclaration" targetNodeId="3.1118786554307" />
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178668307724">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178668307725">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178668307726">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227957656">
                <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178668307728">
                  <link role="concept" targetNodeId="3.1114729360583" />
                  <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668307729">
                    <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178668320721">
                  <link role="link" targetNodeId="3.1168278589236" />
                </node>
              </node>
            </node>
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227900742">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668307732">
              <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1178668307733">
              <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1178668314275">
                <link role="conceptDeclaration" targetNodeId="3.1114729360583" />
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178668329576">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178668329577">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178668329578">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227880910">
                <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178668329580">
                  <link role="concept" targetNodeId="3.1133037731736" />
                  <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668329581">
                    <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178668345407">
                  <link role="link" targetNodeId="3.1168291362368" />
                </node>
              </node>
            </node>
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227841980">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178668329584">
              <link role="variableDeclaration" targetNodeId="1178668019953" resolveInfo="macro" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1178668329585">
              <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1178668338598">
                <link role="conceptDeclaration" targetNodeId="3.1133037731736" />
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178668380671">
          <node role="expression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1178668383059" />
        </node>
      </node>
      <node role="parameter" type="jetbrains.mps.baseLanguage.structure.ParameterDeclaration" id="1178668019953">
        <property name="name" value="macro" />
        <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178668019954">
          <link role="concept" targetNodeId="3.1167951328751" />
        </node>
      </node>
    </node>
    <node role="staticMethod" type="jetbrains.mps.baseLanguage.structure.StaticMethodDeclaration" id="1184801497276">
      <property name="name" value="equate_outputNodeType_fromSourceQuery" />
      <node role="annotation" type="jetbrains.mps.baseLanguage.structure.AnnotationInstance" id="1200405732320">
        <link role="annotation" targetNodeId="23.1196177069451" resolveInfo="InferenceMethod" />
      </node>
      <node role="returnType" type="jetbrains.mps.baseLanguage.structure.VoidType" id="1206283701357" />
      <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1184801497279">
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1184801497280">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1184801497281">
            <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateEquationStatement" id="1206286245992">
              <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1206286253949">
                <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1206286255843">
                  <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1206286255844" />
                </node>
              </node>
              <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1206286245995">
                <node role="normalType" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1206286244631">
                  <link role="variableDeclaration" targetNodeId="1206283500724" resolveInfo="TypeToEquate" />
                </node>
              </node>
            </node>
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1184801497282" />
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.EqualsExpression" id="1184801497285">
            <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1184801497286" />
            <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1184801497287">
              <link role="variableDeclaration" targetNodeId="1184801497342" resolveInfo="query" />
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.lang.typesystem.structure.WhenConcreteStatement" id="1186132825697">
          <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1186132825698">
            <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateLessThanInequationStatement" id="1190121627948">
              <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1190121627949">
                <node role="normalType" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1206283644055">
                  <link role="variableDeclaration" targetNodeId="1206283500724" resolveInfo="TypeToEquate" />
                </node>
              </node>
              <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1190121627951">
                <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1197310837787">
                  <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197310837788" />
                </node>
              </node>
            </node>
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1186132844861">
              <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1186132844862">
                <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateEquationStatement" id="1186132911051">
                  <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1186132913476">
                    <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1197310837789">
                      <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197310837790">
                        <node role="referenceAntiquotation$link_attribute$concept" type="jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation" id="1197310837812">
                          <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227935550">
                            <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1197310837814">
                              <link role="concept" targetNodeId="11.1145383075378" resolveInfo="SNodeListType" />
                              <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.WhenConcreteVariableReference" id="1206283613410">
                                <link role="whenConcreteVar" targetNodeId="1206283558560" resolveInfo="OutputType" />
                              </node>
                            </node>
                            <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197310837816">
                              <link role="link" targetNodeId="11.1145383142433" />
                            </node>
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                  <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1186132911053">
                    <node role="normalType" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1206283648447">
                      <link role="variableDeclaration" targetNodeId="1206283500724" resolveInfo="TypeToEquate" />
                    </node>
                  </node>
                </node>
              </node>
              <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227957712">
                <node role="operand" type="jetbrains.mps.lang.typesystem.structure.WhenConcreteVariableReference" id="1206283606174">
                  <link role="whenConcreteVar" targetNodeId="1206283558560" resolveInfo="OutputType" />
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1186132844873">
                  <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1186132844874">
                    <link role="conceptDeclaration" targetNodeId="11.1145383075378" />
                  </node>
                </node>
              </node>
              <node role="ifFalseStatement" type="jetbrains.mps.baseLanguage.structure.BlockStatement" id="1186132931626">
                <node role="statements" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1186132931627">
                  <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1186132937832">
                    <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1186132937833">
                      <property name="name" value="outputSNodeType" />
                      <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1186132937834">
                        <link role="concept" targetNodeId="11.1138055754698" />
                      </node>
                      <node role="initializer" type="jetbrains.mps.lang.typesystem.structure.CoerceExpression" id="1186132937835">
                        <node role="pattern" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1186132937836">
                          <property name="name" value="v" />
                          <link role="concept" targetNodeId="11.1138055754698" />
                        </node>
                        <node role="nodeToCoerce" type="jetbrains.mps.lang.typesystem.structure.WhenConcreteVariableReference" id="1206283614942">
                          <link role="whenConcreteVar" targetNodeId="1206283558560" resolveInfo="OutputType" />
                        </node>
                      </node>
                    </node>
                  </node>
                  <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1186132937838">
                    <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1186132937839">
                      <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateEquationStatement" id="1186132959877">
                        <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1186132966992">
                          <node role="normalType" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1206283652791">
                            <link role="variableDeclaration" targetNodeId="1206283500724" resolveInfo="TypeToEquate" />
                          </node>
                        </node>
                        <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1186132962896">
                          <node role="normalType" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1186132962897">
                            <link role="variableDeclaration" targetNodeId="1186132937833" resolveInfo="outputSNodeType" />
                          </node>
                        </node>
                      </node>
                    </node>
                    <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1186132937842">
                      <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1186132937843" />
                      <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1186132937844">
                        <link role="variableDeclaration" targetNodeId="1186132937833" resolveInfo="outputSNodeType" />
                      </node>
                    </node>
                    <node role="ifFalseStatement" type="jetbrains.mps.baseLanguage.structure.BlockStatement" id="1186132972932">
                      <node role="statements" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1186132972933">
                        <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1186133012556">
                          <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1186133012557">
                            <property name="name" value="outputSequenceType" />
                            <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1186133012558">
                              <link role="concept" targetNodeId="12.1151689724996" />
                            </node>
                            <node role="initializer" type="jetbrains.mps.lang.typesystem.structure.CoerceExpression" id="1186133012559">
                              <node role="pattern" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1186133012560">
                                <property name="name" value="v" />
                                <link role="concept" targetNodeId="12.1151689724996" />
                              </node>
                              <node role="nodeToCoerce" type="jetbrains.mps.lang.typesystem.structure.WhenConcreteVariableReference" id="1206283617615">
                                <link role="whenConcreteVar" targetNodeId="1206283558560" resolveInfo="OutputType" />
                              </node>
                            </node>
                          </node>
                        </node>
                        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1186133012562">
                          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1186133012563">
                            <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1186133012564">
                              <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1186133012565">
                                <property name="name" value="elementType" />
                                <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1186133012566">
                                  <link role="concept" targetNodeId="10.1068431790189" />
                                </node>
                                <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227846157">
                                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1186133012569">
                                    <link role="variableDeclaration" targetNodeId="1186133012557" resolveInfo="outputSequenceType" />
                                  </node>
                                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1186133012568">
                                    <link role="link" targetNodeId="12.1151689745422" />
                                  </node>
                                </node>
                              </node>
                            </node>
                            <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1186133012570">
                              <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1186133012571">
                                <property name="name" value="outputSNodeType2" />
                                <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1186133012572">
                                  <link role="concept" targetNodeId="11.1138055754698" />
                                </node>
                                <node role="initializer" type="jetbrains.mps.lang.typesystem.structure.CoerceExpression" id="1186133012573">
                                  <node role="pattern" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1186133012574">
                                    <property name="name" value="v" />
                                    <link role="concept" targetNodeId="11.1138055754698" />
                                  </node>
                                  <node role="nodeToCoerce" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1186133012575">
                                    <link role="variableDeclaration" targetNodeId="1186133012565" resolveInfo="elementType" />
                                  </node>
                                </node>
                              </node>
                            </node>
                            <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1186133012576">
                              <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1186133012577">
                                <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateEquationStatement" id="1186133027887">
                                  <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1186133032249">
                                    <node role="normalType" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1186133032250">
                                      <link role="variableDeclaration" targetNodeId="1186133012571" resolveInfo="outputSNodeType2" />
                                    </node>
                                  </node>
                                  <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1186133027889">
                                    <node role="normalType" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1206283664668">
                                      <link role="variableDeclaration" targetNodeId="1206283500724" resolveInfo="TypeToEquate" />
                                    </node>
                                  </node>
                                </node>
                              </node>
                              <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1186133012580">
                                <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1186133012581" />
                                <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1186133012582">
                                  <link role="variableDeclaration" targetNodeId="1186133012571" resolveInfo="outputSNodeType2" />
                                </node>
                              </node>
                            </node>
                          </node>
                          <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1186133012583">
                            <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1186133012584" />
                            <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1186133012585">
                              <link role="variableDeclaration" targetNodeId="1186133012557" resolveInfo="outputSequenceType" />
                            </node>
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
          <node role="argument" type="jetbrains.mps.lang.typesystem.structure.TypeOfExpression" id="1206283548589">
            <property name="skipDependencyOnCurrent" value="true" />
            <node role="term" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1206283548590">
              <link role="variableDeclaration" targetNodeId="1184801497342" resolveInfo="query" />
            </node>
          </node>
          <node role="argumentRepresentator" type="jetbrains.mps.lang.typesystem.structure.WhenConcreteVariableDeclaration" id="1206283558560">
            <property name="name" value="OutputType" />
            <node role="type" type="jetbrains.mps.baseLanguage.structure.Type" id="1206283558561" />
          </node>
        </node>
      </node>
      <node role="parameter" type="jetbrains.mps.baseLanguage.structure.ParameterDeclaration" id="1184801497342">
        <property name="name" value="query" />
        <property name="isFinal" value="true" />
        <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1184801497343">
          <link role="concept" targetNodeId="10.1137021947720" />
        </node>
      </node>
      <node role="parameter" type="jetbrains.mps.baseLanguage.structure.ParameterDeclaration" id="1206283500724">
        <property name="name" value="TypeToEquate" />
        <property name="isFinal" value="true" />
        <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1206283507507" />
      </node>
    </node>
    <node role="staticMethod" type="jetbrains.mps.baseLanguage.structure.StaticMethodDeclaration" id="1178670165537">
      <property name="name" value="getApplicableConcept_fromEnvironment" />
      <node role="returnType" type="jetbrains.mps.lang.smodel.structure.SConceptType" id="1178670176491" />
      <node role="visibility" type="jetbrains.mps.baseLanguage.structure.PrivateVisibility" id="1178908833826" />
      <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178670165540">
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178670295328">
          <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178670295329">
            <property name="name" value="ancestor" />
            <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178670295330" />
            <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227918506">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178670237345">
                <link role="variableDeclaration" targetNodeId="1178670218097" resolveInfo="node" />
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetAncestorOperation" id="1178670265054">
                <node role="parameter" type="jetbrains.mps.lang.smodel.structure.OperationParm_ConceptList" id="1178670269940">
                  <node role="concept" type="jetbrains.mps.lang.smodel.structure.ConceptReference" id="1178670275608">
                    <link role="concept" targetNodeId="3.1092059087312" />
                  </node>
                  <node role="concept" type="jetbrains.mps.lang.smodel.structure.ConceptReference" id="1178670288161">
                    <link role="concept" targetNodeId="3.1167169308231" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178670301351">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178670301352">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178670323505">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227889076">
                <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178670332042">
                  <link role="concept" targetNodeId="3.1092059087312" />
                  <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178670326198">
                    <link role="variableDeclaration" targetNodeId="1178670295329" resolveInfo="ancestor" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178670343745">
                  <link role="link" targetNodeId="3.1168285871518" />
                </node>
              </node>
            </node>
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227898539">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178670304427">
              <link role="variableDeclaration" targetNodeId="1178670295329" resolveInfo="ancestor" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1178670311841">
              <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1178670320900">
                <link role="conceptDeclaration" targetNodeId="3.1092059087312" />
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1178670348233">
          <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1178670348234">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178670348235">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227925527">
                <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178670348237">
                  <link role="concept" targetNodeId="3.1167169308231" />
                  <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178670348238">
                    <link role="variableDeclaration" targetNodeId="1178670295329" resolveInfo="ancestor" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178670364619">
                  <link role="link" targetNodeId="3.1167169349424" />
                </node>
              </node>
            </node>
          </node>
          <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227956635">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178670348241">
              <link role="variableDeclaration" targetNodeId="1178670295329" resolveInfo="ancestor" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_IsInstanceOfOperation" id="1178670348242">
              <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1178670353872">
                <link role="conceptDeclaration" targetNodeId="3.1167169308231" />
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.RemarkStatement" id="1178670368555">
          <property name="value" value="============" />
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1178670506571">
          <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1178670506572">
            <property name="name" value="rootAnnotation" />
            <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178670513604" />
            <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204753471402">
              <node role="operand" type="jetbrains.mps.lang.smodel.structure.SemanticDowncastExpression" id="1178670407833">
                <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227905149">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1178670386461">
                    <link role="variableDeclaration" targetNodeId="1178670218097" resolveInfo="node" />
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetContainingRootOperation" id="1178670392116" />
                </node>
              </node>
              <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1204753471403">
                <link role="baseMethodDeclaration" targetNodeId="6.~SNode.getAttribute(java.lang.String):jetbrains.mps.smodel.SNode" resolveInfo="getAttribute" />
                <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1178670470383">
                  <link role="classifier" targetNodeId="25.~RootTemplateAnnotation_AnnotationLink" resolveInfo="RootTemplateAnnotation_AnnotationLink" />
                  <link role="variableDeclaration" targetNodeId="25.~RootTemplateAnnotation_AnnotationLink.ROOT_TEMPLATE_ANNOTATION" resolveInfo="ROOT_TEMPLATE_ANNOTATION" />
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1178670551053">
          <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227867953">
            <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1178670551055">
              <link role="concept" targetNodeId="3.1168619357332" />
              <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1178670551056">
                <link role="variableDeclaration" targetNodeId="1178670506572" resolveInfo="rootAnnotation" />
              </node>
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1178670551057">
              <link role="link" targetNodeId="3.1168619429071" />
            </node>
          </node>
        </node>
      </node>
      <node role="parameter" type="jetbrains.mps.baseLanguage.structure.ParameterDeclaration" id="1178670218097">
        <property name="name" value="node" />
        <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1178670218098" />
      </node>
    </node>
    <node role="visibility" type="jetbrains.mps.baseLanguage.structure.PublicVisibility" id="1178666070053" />
  </node>
  <node type="jetbrains.mps.lang.typesystem.structure.NonTypesystemRule" id="1195601047105">
    <property name="name" value="check_MappingConfiguration" />
    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1195601047106">
      <node role="statement" type="jetbrains.mps.baseLanguage.collections.structure.ForEachStatement" id="1195601206269">
        <node role="variable" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariable" id="1195601206270">
          <property name="name" value="scriptReference" />
        </node>
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1195601206272">
          <node role="statement" type="jetbrains.mps.lang.typesystem.structure.AssertStatement" id="1195601255636">
            <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227915059">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227847646">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227849810">
                  <node role="operand" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariableReference" id="1195601271390">
                    <link role="variable" targetNodeId="1195601206270" resolveInfo="scriptReference" />
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1195601278659">
                    <link role="link" targetNodeId="3.1195502167610" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1195601282945">
                  <link role="property" targetNodeId="3.1195595592106" resolveInfo="scriptKind" />
                </node>
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Property_HasValue_Enum" id="1195601288011">
                <node role="value" type="jetbrains.mps.lang.smodel.structure.EnumMemberReference" id="1195601288012">
                  <link role="enumMember" targetNodeId="3.1195595264962" />
                </node>
              </node>
            </node>
            <node role="errorString" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1195601298357">
              <property name="value" value="pre-processing script kind is expected" />
            </node>
            <node role="nodeToReport" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariableReference" id="1195601332327">
              <link role="variable" targetNodeId="1195601206270" resolveInfo="scriptReference" />
            </node>
          </node>
        </node>
        <node role="inputSequence" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227847944">
          <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1195601242432">
            <link role="applicableNode" targetNodeId="1195601061062" resolveInfo="mc" />
          </node>
          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkListAccess" id="1195601242431">
            <link role="link" targetNodeId="3.1195502100749" />
          </node>
        </node>
      </node>
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.RemarkStatement" id="1195601339922">
        <property name="value" value="--" />
      </node>
      <node role="statement" type="jetbrains.mps.baseLanguage.collections.structure.ForEachStatement" id="1195601346470">
        <node role="variable" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariable" id="1195601346471">
          <property name="name" value="scriptReference" />
        </node>
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1195601346472">
          <node role="statement" type="jetbrains.mps.lang.typesystem.structure.AssertStatement" id="1195601346473">
            <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227838459">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227934328">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227959175">
                  <node role="operand" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariableReference" id="1195601346481">
                    <link role="variable" targetNodeId="1195601346471" resolveInfo="scriptReference" />
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1195601346480">
                    <link role="link" targetNodeId="3.1195502167610" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1195601346478">
                  <link role="property" targetNodeId="3.1195595592106" resolveInfo="scriptKind" />
                </node>
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Property_HasValue_Enum" id="1195601346475">
                <node role="value" type="jetbrains.mps.lang.smodel.structure.EnumMemberReference" id="1195601346476">
                  <link role="enumMember" targetNodeId="3.1195595382324" />
                </node>
              </node>
            </node>
            <node role="errorString" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1195601346482">
              <property name="value" value="post-processing script kind is expected" />
            </node>
            <node role="nodeToReport" type="jetbrains.mps.baseLanguage.collections.structure.ForEachVariableReference" id="1195601346483">
              <link role="variable" targetNodeId="1195601346471" resolveInfo="scriptReference" />
            </node>
          </node>
        </node>
        <node role="inputSequence" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227850569">
          <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1195601346486">
            <link role="applicableNode" targetNodeId="1195601061062" resolveInfo="mc" />
          </node>
          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkListAccess" id="1195601353190">
            <link role="link" targetNodeId="3.1195502346405" />
          </node>
        </node>
      </node>
    </node>
    <node role="applicableNode" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1195601061062">
      <property name="name" value="mc" />
      <link role="concept" targetNodeId="3.1095416546421" resolveInfo="MappingConfiguration" />
    </node>
  </node>
  <node type="jetbrains.mps.lang.typesystem.structure.InferenceRule" id="1200915146064">
    <property name="name" value="typeof_Node_FindOutputNode" />
    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1200915146065">
      <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateEquationStatement" id="1200915155775">
        <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1200915157654">
          <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1200915157655">
            <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1200915162954">
              <link role="concept" targetNodeId="8.1169125787135" resolveInfo="AbstractConceptDeclaration" />
              <node role="referenceAntiquotation$link_attribute$concept" type="jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation" id="1200915165862">
                <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227865808">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227922703">
                    <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1200915167645">
                      <link role="applicableNode" targetNodeId="1200915146066" resolveInfo="nodeToCheck" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1200915169430">
                      <link role="link" targetNodeId="3.1200913726734" />
                    </node>
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1200915171497">
                    <link role="link" targetNodeId="3.1200913004646" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1200915155778">
          <node role="normalType" type="jetbrains.mps.lang.typesystem.structure.TypeOfExpression" id="1200915152288">
            <node role="term" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1200915153212">
              <link role="applicableNode" targetNodeId="1200915146066" resolveInfo="nodeToCheck" />
            </node>
          </node>
        </node>
      </node>
      <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateLessThanInequationStatement" id="1207675008261">
        <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1207675008262">
          <node role="normalType" type="jetbrains.mps.lang.typesystem.structure.TypeOfExpression" id="1207675008263">
            <node role="term" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1207675008264">
              <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1207675008265">
                <link role="applicableNode" targetNodeId="1200915146066" resolveInfo="nodeToCheck" />
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_ConceptMethodCall" id="1207675008266">
                <link role="conceptMethodDeclaration" targetNodeId="21.1213877508894" resolveInfo="getLeftExpression" />
              </node>
            </node>
          </node>
        </node>
        <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1207675008267">
          <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1207675008268">
            <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1207675008269">
              <node role="referenceAntiquotation$link_attribute$concept" type="jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation" id="1207675008270">
                <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1207675008271">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1207675008272">
                    <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1207675008273">
                      <link role="applicableNode" targetNodeId="1200915146066" resolveInfo="nodeToCheck" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1207675008274">
                      <link role="link" targetNodeId="3.1200913726734" />
                    </node>
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1207675008275">
                    <link role="link" targetNodeId="3.1200911342686" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="applicableNode" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1200915146066">
      <property name="name" value="nodeToCheck" />
      <link role="concept" targetNodeId="3.1200913690460" resolveInfo="Node_FindOutputNode" />
    </node>
  </node>
  <node type="jetbrains.mps.lang.typesystem.structure.InferenceRule" id="1200921388036">
    <property name="name" value="typeof_BaseMappingRule" />
    <property name="package" value="rule" />
    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1200921388037">
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1200921432950">
        <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1200921435724">
          <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1200921437258" />
          <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1215476945936">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227838651">
              <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1200921433766">
                <link role="applicableNode" targetNodeId="1200921388038" resolveInfo="nodeToCheck" />
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1200921435145">
                <link role="link" targetNodeId="3.1200917515464" />
              </node>
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1215476954158">
              <link role="link" targetNodeId="3.1200911342686" />
            </node>
          </node>
        </node>
        <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1200921432952">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1203556587899">
            <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotExpression" id="1203556587900">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1203556596415">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227897003">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227922443">
                    <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1203556587910">
                      <link role="applicableNode" targetNodeId="1200921388038" resolveInfo="nodeToCheck" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1203556587909">
                      <link role="link" targetNodeId="3.1200917515464" />
                    </node>
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1203556587907">
                    <link role="link" targetNodeId="3.1200911342686" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.Concept_IsSuperConceptOfOperation" id="1203556600620">
                  <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.PoundExpression" id="1207675646024">
                    <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1203556624812">
                      <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1203556620155">
                        <link role="applicableNode" targetNodeId="1200921388038" resolveInfo="nodeToCheck" />
                      </node>
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1203556629236">
                        <link role="link" targetNodeId="3.1167169349424" />
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
            <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1203556587911">
              <node role="statement" type="jetbrains.mps.lang.typesystem.structure.ReportErrorStatement" id="1203556587912">
                <node role="errorString" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1203556587913">
                  <property name="value" value="Label has incorrect type" />
                </node>
                <node role="nodeToReport" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1203556587914">
                  <link role="applicableNode" targetNodeId="1200921388038" resolveInfo="nodeToCheck" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateStrongLessThanInequationStatement" id="1200922039515">
            <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1200922167816">
              <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1200922167817">
                <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1200922169147">
                  <node role="referenceAntiquotation$link_attribute$concept" type="jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation" id="1200922170680">
                    <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227942403">
                      <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1200922173385">
                        <link role="applicableNode" targetNodeId="1200921388038" resolveInfo="nodeToCheck" />
                      </node>
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_ConceptMethodCall" id="1200922175826">
                        <link role="conceptMethodDeclaration" targetNodeId="24.1213877498511" resolveInfo="getTemplateType" />
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
            <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1200922044206">
              <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1200922044207">
                <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1200922045303">
                  <node role="referenceAntiquotation$link_attribute$concept" type="jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation" id="1200922046710">
                    <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227932759">
                      <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227884641">
                        <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1200922048150">
                          <link role="applicableNode" targetNodeId="1200921388038" resolveInfo="nodeToCheck" />
                        </node>
                        <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1200922155389">
                          <link role="link" targetNodeId="3.1200917515464" />
                        </node>
                      </node>
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1200922161581">
                        <link role="link" targetNodeId="3.1200913004646" />
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="applicableNode" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1200921388038">
      <property name="name" value="nodeToCheck" />
      <link role="concept" targetNodeId="3.1167169308231" resolveInfo="BaseMappingRule" />
    </node>
  </node>
  <node type="jetbrains.mps.lang.typesystem.structure.InferenceRule" id="1200923760356">
    <property name="name" value="typeof_CreateRootRule" />
    <property name="package" value="rule" />
    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1200923760357">
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1200923775259">
        <node role="condition" type="jetbrains.mps.baseLanguage.structure.NotEqualsExpression" id="1200923777923">
          <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1200923778911" />
          <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227942557">
            <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1200923776075">
              <link role="applicableNode" targetNodeId="1200923760358" resolveInfo="nodeToCheck" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1200923777297">
              <link role="link" targetNodeId="3.1200923511980" />
            </node>
          </node>
        </node>
        <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1200923775261">
          <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateStrongLessThanInequationStatement" id="1200923779365">
            <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1200923779366">
              <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1200923779367">
                <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1200923793681">
                  <node role="referenceAntiquotation$link_attribute$concept" type="jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation" id="1200923794495">
                    <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227888245">
                      <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227867957">
                        <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1200923795622">
                          <link role="applicableNode" targetNodeId="1200923760358" resolveInfo="nodeToCheck" />
                        </node>
                        <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1200923797579">
                          <link role="link" targetNodeId="3.1167087469901" />
                        </node>
                      </node>
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetConceptOperation" id="1200923803489" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
            <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1200923779369">
              <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1200923779370">
                <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1200923784419">
                  <node role="referenceAntiquotation$link_attribute$concept" type="jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation" id="1200923786514">
                    <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227910172">
                      <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227946462">
                        <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1200923787359">
                          <link role="applicableNode" targetNodeId="1200923760358" resolveInfo="nodeToCheck" />
                        </node>
                        <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1200923788395">
                          <link role="link" targetNodeId="3.1200923511980" />
                        </node>
                      </node>
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1200923791180">
                        <link role="link" targetNodeId="3.1200913004646" />
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="applicableNode" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1200923760358">
      <property name="name" value="nodeToCheck" />
      <link role="concept" targetNodeId="3.1167087469898" resolveInfo="CreateRootRule" />
    </node>
  </node>
  <node type="jetbrains.mps.lang.typesystem.structure.InferenceRule" id="1200923993013">
    <property name="name" value="typeof_ConditionalRootExpression" />
    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1200923993014">
      <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateEquationStatement" id="1200923995907">
        <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1200923998066">
          <node role="normalType" type="jetbrains.mps.lang.typesystem.structure.TypeOfExpression" id="1200923998067">
            <node role="term" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1200923998866">
              <link role="applicableNode" targetNodeId="1200923993015" resolveInfo="nodeToCheck" />
            </node>
          </node>
        </node>
        <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1200924001430">
          <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1200924001431">
            <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1200924003339">
              <node role="referenceAntiquotation$link_attribute$concept" type="jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation" id="1200924003653">
                <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227926154">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1204227879792">
                    <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1200924004748">
                      <link role="applicableNode" targetNodeId="1200923993015" resolveInfo="nodeToCheck" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1200924005768">
                      <link role="link" targetNodeId="3.1200923917743" />
                    </node>
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1200924007163">
                    <link role="link" targetNodeId="3.1200913004646" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="applicableNode" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1200923993015">
      <property name="name" value="nodeToCheck" />
      <link role="concept" targetNodeId="3.1200923907774" resolveInfo="ConditionalRootExpression" />
    </node>
  </node>
  <node type="jetbrains.mps.lang.typesystem.structure.InferenceRule" id="1221153432505">
    <property name="name" value="typeof_TemplateFunctionParameter_outputNode" />
    <property name="package" value="functionParameter" />
    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1221153432506">
      <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1221153504858">
        <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1221153504859">
          <property name="name" value="concept" />
          <node role="type" type="jetbrains.mps.lang.smodel.structure.SConceptType" id="1221153504860" />
          <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1221153504861">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1221153504862">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1221153504863">
                <node role="operand" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1221153504864">
                  <link role="applicableNode" targetNodeId="1221153432507" resolveInfo="node" />
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetAncestorOperation" id="1221153504865">
                  <node role="parameter" type="jetbrains.mps.lang.smodel.structure.OperationParm_Concept" id="1221153504866">
                    <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1221153504867">
                      <link role="conceptDeclaration" targetNodeId="3.1088761943574" resolveInfo="ReferenceMacro" />
                    </node>
                  </node>
                </node>
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetParentOperation" id="1221153504868" />
            </node>
            <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetConceptOperation" id="1221153504869" />
          </node>
        </node>
      </node>
      <node role="statement" type="jetbrains.mps.lang.typesystem.structure.CreateEquationStatement" id="1221153528155">
        <node role="leftExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1221153528158">
          <node role="normalType" type="jetbrains.mps.lang.typesystem.structure.TypeOfExpression" id="1221153521184">
            <node role="term" type="jetbrains.mps.lang.typesystem.structure.ApplicableNodeReference" id="1221153540206">
              <link role="applicableNode" targetNodeId="1221153432507" resolveInfo="node" />
            </node>
          </node>
        </node>
        <node role="rightExpression" type="jetbrains.mps.lang.typesystem.structure.NormalTypeClause" id="1221153576521">
          <node role="normalType" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1221153576522">
            <node role="quotedNode" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1221153585103">
              <node role="referenceAntiquotation$link_attribute$concept" type="jetbrains.mps.lang.quotation.structure.ReferenceAntiquotation" id="1221153594307">
                <node role="expression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1221153602215">
                  <link role="variableDeclaration" targetNodeId="1221153504859" resolveInfo="concept" />
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="applicableNode" type="jetbrains.mps.lang.typesystem.structure.ConceptReference" id="1221153432507">
      <property name="name" value="node" />
      <link role="concept" targetNodeId="3.1184690432998" resolveInfo="TemplateFunctionParameter_outputNode" />
    </node>
  </node>
</model>

