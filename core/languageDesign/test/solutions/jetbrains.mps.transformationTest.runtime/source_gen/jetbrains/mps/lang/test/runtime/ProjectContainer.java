package jetbrains.mps.lang.test.runtime;

/*Generated by MPS */

import jetbrains.mps.project.MPSProject;
import javax.swing.SwingUtilities;
import jetbrains.mps.ide.IdeMain;
import org.apache.commons.lang.ObjectUtils;
import jetbrains.mps.TestMain;
import java.io.File;

public class ProjectContainer {
  private String projectName;
  private MPSProject lastProject;

  public ProjectContainer() {
  }

  public void clear() {
    try {
      SwingUtilities.invokeAndWait(new Runnable() {
        public void run() {
          ProjectContainer.this.lastProject.dispose();
          ProjectContainer.this.lastProject = null;
          ProjectContainer.this.projectName = null;
        }
      });
    } catch (Exception e) {
      e.printStackTrace();
    }
  }

  public MPSProject getProject(String name) {
    IdeMain.setTestMode(IdeMain.TestMode.CORE_TEST);
    if (ObjectUtils.equals(name, this.projectName)) {
      return this.lastProject;
    } else {
      MPSProject p = TestMain.loadProject(new File(name));
      if (this.lastProject != null) {
        try {
          SwingUtilities.invokeAndWait(new Runnable() {
            public void run() {
              ProjectContainer.this.lastProject.dispose();
            }
          });
        } catch (Exception e) {
          e.printStackTrace();
        }
      }
      this.lastProject = p;
      this.projectName = name;
      return p;
    }
  }
}
