package jetbrains.mps.debug.evaluation;

/*Generated by MPS */

import jetbrains.mps.debug.evaluation.proxies.IObjectValueProxy;
import com.sun.jdi.ObjectReference;
import jetbrains.mps.debug.evaluation.proxies.MirrorUtil;
import com.sun.jdi.ThreadReference;
import com.sun.jdi.StackFrame;
import com.sun.jdi.VirtualMachine;
import jetbrains.mps.debugger.java.runtime.JavaUiStateImpl;
import org.jetbrains.annotations.Nullable;
import com.sun.jdi.Location;
import jetbrains.mps.debug.evaluation.proxies.IValueProxy;

public abstract class Evaluator {
  private JavaUiStateImpl myUiState;
  private IObjectValueProxy myThisObject;

  public Evaluator(JavaUiStateImpl uiState) {
    myUiState = uiState;
    ObjectReference objectReference = uiState.getThisObject();
    if (objectReference != null) {
      myThisObject = (IObjectValueProxy) MirrorUtil.getValueProxy(objectReference, uiState.getThread().getThread());
    }
  }

  protected IObjectValueProxy getThisObject() {
    return myThisObject;
  }

  public ThreadReference getThreadReference() {
    return myUiState.getThread().getThread();
  }

  public StackFrame getStackFrame() {
    return myUiState.getStackFrame().getStackFrame();
  }

  public VirtualMachine getVM() {
    return myUiState.getThread().getThread().virtualMachine();
  }

  @Nullable
  protected String getThisFQName() {
    Location location = this.myUiState.getStackFrame().getLocation().getLocation();
    return location.declaringType().name();
  }

  public abstract IValueProxy evaluate() throws EvaluationException;
}
