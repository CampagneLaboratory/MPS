package jetbrains.mps.debug.evaluation.ui;

/*Generated by MPS */

import jetbrains.mps.ide.dialogs.BaseDialog;
import jetbrains.mps.smodel.IOperationContext;
import jetbrains.mps.debug.runtime.JavaUiState;
import jetbrains.mps.debug.evaluation.EvaluationProvider;
import java.awt.Dimension;
import jetbrains.mps.debug.runtime.DebugSession;
import jetbrains.mps.debug.api.SessionChangeAdapter;
import jetbrains.mps.debug.api.AbstractDebugSession;
import com.intellij.openapi.application.ApplicationManager;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import javax.swing.JComponent;

public class EvaluationDialog extends BaseDialog {
  private final EvaluationPanel myEvaluationPanel;

  public EvaluationDialog(final IOperationContext context, JavaUiState uiState, EvaluationProvider provider) {
    super(context.getMainFrame(), "Evaluate");
    setSize(new Dimension(500, 500));
    setModal(false);

    myEvaluationPanel = new EvaluationPanel(context.getProject(), uiState, provider);
    myEvaluationPanel.setErrorTextListener(new EvaluationPanel.IErrorTextListener() {
      public void updateErrorText(String text) {
        setErrorText(text);
      }
    });

    final DebugSession debugSession = provider.getDebugSession();
    debugSession.addChangeListener(new SessionChangeAdapter() {
      public void resumed(final AbstractDebugSession session) {
        ApplicationManager.getApplication().invokeLater(new Runnable() {
          public void run() {
            if (debugSession == session && session.isStopped()) {
              dispose();
            }
          }
        });
      }
    });

    addWindowListener(new WindowAdapter() {
      @Override
      public void windowClosed(WindowEvent event) {
        myEvaluationPanel.dispose();
      }
    });
  }

  public JComponent getMainComponent() {
    return myEvaluationPanel;
  }

  @BaseDialog.Button(position = 0, name = "Evaluate", mnemonic = 'E', defaultButton = true)
  public void buttonEvaluate() {
    myEvaluationPanel.evaluate();
  }

  @BaseDialog.Button(position = 1, name = "Cancel", mnemonic = 'C', defaultButton = false)
  public void buttonCancel() {
    this.dispose();
  }
}
