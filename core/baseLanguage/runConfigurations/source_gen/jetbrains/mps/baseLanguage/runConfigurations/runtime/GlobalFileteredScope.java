package jetbrains.mps.baseLanguage.runConfigurations.runtime;

/*Generated by MPS */

import jetbrains.mps.project.GlobalScope;
import java.util.Set;
import jetbrains.mps.project.IModule;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.internal.collections.runtime.ISequenceClosure;
import jetbrains.mps.smodel.MPSModuleRepository;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import jetbrains.mps.smodel.SModelDescriptor;
import jetbrains.mps.smodel.SModelReference;
import jetbrains.mps.smodel.SModelRepository;
import java.util.List;
import jetbrains.mps.smodel.SModelStereotype;
import jetbrains.mps.generator.TransientModelsModule;
import jetbrains.mps.smodel.Generator;

public class GlobalFileteredScope extends GlobalScope {
  private static final GlobalFileteredScope ourInstance;

  public GlobalFileteredScope() {
  }

  public Set<IModule> getVisibleModules() {
    Iterable<IModule> s = Sequence.fromClosure(new ISequenceClosure<IModule>() {
      public Iterable<IModule> iterable() {
        return MPSModuleRepository.getInstance().getAllModules();
      }
    });
    return SetSequence.fromSetAndArray(new HashSet(), Sequence.fromIterable(s).where(new IWhereFilter<IModule>() {
      public boolean accept(IModule it) {
        return GlobalFileteredScope.this.acceptModule(it);
      }
    }));
  }

  public SModelDescriptor getModelDescriptor(SModelReference reference) {
    SModelDescriptor descriptor = SModelRepository.getInstance().getModelDescriptor(reference);
    if (this.acceptModel(descriptor)) {
      return descriptor;
    }
    return null;
  }

  public List<SModelDescriptor> getModelDescriptors(final String modelName) {
    return Sequence.fromIterable(Sequence.fromClosure(new ISequenceClosure<SModelDescriptor>() {
      public Iterable<SModelDescriptor> iterable() {
        return SModelRepository.getInstance().getModelDescriptorsByModelName(modelName);
      }
    })).where(new IWhereFilter<SModelDescriptor>() {
      public boolean accept(SModelDescriptor it) {
        return GlobalFileteredScope.this.acceptModel(it);
      }
    }).toListSequence();
  }

  public List<SModelDescriptor> getModelDescriptors() {
    return Sequence.fromIterable(Sequence.fromClosure(new ISequenceClosure<SModelDescriptor>() {
      public Iterable<SModelDescriptor> iterable() {
        return SModelRepository.getInstance().getModelDescriptors();
      }
    })).where(new IWhereFilter<SModelDescriptor>() {
      public boolean accept(SModelDescriptor it) {
        return GlobalFileteredScope.this.acceptModel(it);
      }
    }).toListSequence();
  }

  protected boolean acceptModel(SModelDescriptor descriptor) {
    return SModelStereotype.isUserModel(descriptor) && !(SModelStereotype.isGeneratorModel(descriptor)) && !(descriptor.getModule() instanceof TransientModelsModule);
  }

  protected boolean acceptModule(IModule m) {
    return !(m instanceof TransientModelsModule) && !(m instanceof Generator);
  }

  public static GlobalFileteredScope getInstance() {
    return ourInstance;
  }

  static {
    ourInstance = new GlobalFileteredScope();
  }
}
