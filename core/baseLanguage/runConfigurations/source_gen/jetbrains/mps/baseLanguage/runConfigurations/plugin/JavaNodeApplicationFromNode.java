package jetbrains.mps.baseLanguage.runConfigurations.plugin;

/*Generated by MPS */

import jetbrains.mps.plugins.pluginparts.runconfigs.BaseConfigCreator;
import jetbrains.mps.smodel.SNode;
import com.intellij.execution.configurations.RunConfiguration;
import com.intellij.util.containers.ContainerUtil;
import com.intellij.openapi.extensions.Extensions;
import com.intellij.execution.configurations.ConfigurationType;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import jetbrains.mps.baseLanguage.runConfigurations.behavior.IMainClass_Behavior;
import org.apache.commons.lang.StringUtils;
import jetbrains.mps.plugins.pluginparts.runconfigs.MPSPsiElement;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;

public class JavaNodeApplicationFromNode extends BaseConfigCreator<SNode> implements Cloneable {
  private RunConfiguration myConfig;

  public JavaNodeApplicationFromNode() {
    super(ContainerUtil.findInstance(Extensions.getExtensions(ConfigurationType.CONFIGURATION_TYPE_EP), new _FunctionTypes._return_P0_E0<Class<ConfigurationType>>() {
      public Class<ConfigurationType> invoke() {
        try {
          return (Class<ConfigurationType>) getClass().getClassLoader().loadClass("jetbrains.mps.baseLanguage.plugin.JavaApplication_ConfigurationType");
        } catch (ClassNotFoundException cl) {
          return (Class<ConfigurationType>) null;
        }
      }
    }.invoke()), "JavaNodeApplication_Factory");
  }

  protected RunConfiguration doCreateConfiguration(SNode node) {
    this.createConfig(node);
    return this.myConfig;
  }

  private void createConfig(final SNode parameter) {
    final String unitName = IMainClass_Behavior.call_getUnitName_4482685194810363969(parameter);
    if (StringUtils.isEmpty(unitName)) {
      return;
    }
    JavaNodeApplicationFromNode.this.setSourceElement(new MPSPsiElement(parameter));

    {
      ConfigurationType configType = ContainerUtil.findInstance(Extensions.getExtensions(ConfigurationType.CONFIGURATION_TYPE_EP), new _FunctionTypes._return_P0_E0<Class<ConfigurationType>>() {
        public Class<ConfigurationType> invoke() {
          try {
            return (Class<ConfigurationType>) getClass().getClassLoader().loadClass("jetbrains.mps.baseLanguage.plugin.JavaApplication_ConfigurationType");
          } catch (ClassNotFoundException cl) {
            return (Class<ConfigurationType>) null;
          }
        }
      }.invoke());
      JavaNodeApplication_Configuration _config = new JavaNodeApplication_Configuration(JavaNodeApplicationFromNode.this.getContext().getProject(), findFactory(configType, "JavaNodeApplication"), "NewConfig") {
        @Override
        public String suggestedName() {
          return unitName;
        }
      };
      _config.setName(unitName);
      _config.getStateObject().nodeId = parameter.getId();
      _config.getStateObject().modelId = parameter.getModel().getModelDescriptor().getSModelReference().toString();
      JavaNodeApplicationFromNode.this.myConfig = _config;
    }
  }

  @Override
  public JavaNodeApplicationFromNode clone() {
    return ((JavaNodeApplicationFromNode) super.clone());
  }

  protected boolean isApplicable(final Object element) {
    return element instanceof SNode && SNodeOperations.isInstanceOf(((SNode) element), "jetbrains.mps.baseLanguage.runConfigurations.structure.IMainClass");
  }
}
