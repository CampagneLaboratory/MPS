package jetbrains.mps.baseLanguage.unitTest.plugin;

/*Generated by MPS */

import jetbrains.mps.smodel.SNode;
import jetbrains.mps.project.MPSProject;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.internal.collections.runtime.ISequenceClosure;
import java.util.Iterator;
import jetbrains.mps.baseLanguage.closures.runtime.YieldingIterator;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.baseLanguage.unitTest.behavior.ITestCase_Behavior;
import java.util.Collections;
import jetbrains.mps.project.IModule;
import jetbrains.mps.internal.collections.runtime.ITranslator2;
import jetbrains.mps.workbench.MPSDataKeys;
import com.intellij.ide.DataManager;

public enum JUnitRunTypes {
  METHOD() {

    public Iterable<SNode> collect(final DefaultJUnit_Configuration configuration, MPSProject project) {
      return Sequence.fromClosure(new ISequenceClosure<SNode>() {
        public Iterable<SNode> iterable() {
          return new Iterable<SNode>() {
            public Iterator<SNode> iterator() {
              return new YieldingIterator<SNode>() {
                private int __CP__ = 0;
                private int _9_i;
                private String _16_methodName;
                private Iterator<String> _16_methodName_it;
                private int _20_separatorIndex;

                protected boolean moveToNext() {
__loop__:
                  do {
__switch__:
                    switch (this.__CP__) {
                      case -1:
                        assert false : "Internal error";
                        return false;
                      case 9:
                        this._9_i = 0;
                      case 10:
                        if (!(_9_i < configuration.getStateObject().methods.size())) {
                          this.__CP__ = 8;
                          break;
                        }
                        this.__CP__ = 11;
                        break;
                      case 12:
                        _9_i++;
                        this.__CP__ = 10;
                        break;
                      case 16:
                        this._16_methodName_it = ListSequence.fromList(configuration.getStateObject().fullMethodNames).iterator();
                      case 17:
                        if (!(this._16_methodName_it.hasNext())) {
                          this.__CP__ = 1;
                          break;
                        }
                        this._16_methodName = this._16_methodName_it.next();
                        this.__CP__ = 18;
                        break;
                      case 3:
                        if (configuration.getStateObject().node != null && configuration.getStateObject().method != null) {
                          this.__CP__ = 4;
                          break;
                        }
                        this.__CP__ = 5;
                        break;
                      case 5:
                        if (configuration.getStateObject().nodes != null && configuration.getStateObject().methods != null) {
                          this.__CP__ = 7;
                          break;
                        }
                        this.__CP__ = 8;
                        break;
                      case 14:
                        if (configuration.getStateObject().fullMethodNames != null) {
                          this.__CP__ = 15;
                          break;
                        }
                        this.__CP__ = 1;
                        break;
                      case 6:
                        this.__CP__ = 5;
                        this.yield(TestRunUtil.getTestMethod(configuration.getStateObject().node, configuration.getStateObject().method));
                        return true;
                      case 13:
                        this.__CP__ = 12;
                        this.yield(TestRunUtil.getTestMethod(configuration.getStateObject().nodes.get(_9_i), configuration.getStateObject().methods.get(_9_i)));
                        return true;
                      case 21:
                        this.__CP__ = 17;
                        this.yield(TestRunUtil.getTestMethod(_16_methodName.substring(0, _20_separatorIndex), _16_methodName.substring(_20_separatorIndex + 1)));
                        return true;
                      case 0:
                        // legacy, we use fullMethodNames now 
                        this.__CP__ = 3;
                        break;
                      case 8:

                        this.__CP__ = 14;
                        break;
                      case 4:
                        this.__CP__ = 6;
                        break;
                      case 7:
                        this.__CP__ = 9;
                        break;
                      case 11:
                        this.__CP__ = 13;
                        break;
                      case 15:
                        this.__CP__ = 16;
                        break;
                      case 18:
                        this._20_separatorIndex = _16_methodName.lastIndexOf(TestRunUtil.SEPARATOR);
                        this.__CP__ = 21;
                        break;
                      default:
                        break __loop__;
                    }
                  } while (true);
                  return false;
                }
              };
            }
          };
        }
      });
    }

    public String check(DefaultJUnit_Configuration configuration) {
      if (configuration.getStateObject().fullMethodNames != null) {
        if (TestRunUtil.validateMethods(configuration.getStateObject().fullMethodNames)) {
          return null;
        } else {
          return "methods are not valid";
        }
      }

      // legacy 
      if (Sequence.fromIterable(TestRunUtil.getValues(configuration.getStateObject().method, configuration.getStateObject().methods)).isEmpty()) {
        return "methods list is empty";
      } else if (!(TestRunUtil.validateMethods(configuration.getStateObject().node, configuration.getStateObject().nodes, configuration.getStateObject().method, configuration.getStateObject().methods))) {
        return "methods are not valid";
      }

      return null;
    }

  },
  NODE() {

    public Iterable<SNode> collect(final DefaultJUnit_Configuration configuration, MPSProject project) {
      return Sequence.fromClosure(new ISequenceClosure<SNode>() {
        public Iterable<SNode> iterable() {
          return new Iterable<SNode>() {
            public Iterator<SNode> iterator() {
              return new YieldingIterator<SNode>() {
                private int __CP__ = 0;
                private SNode _6_testNode;
                private SNode _16_testNode;
                private int _11_i;

                protected boolean moveToNext() {
__loop__:
                  do {
__switch__:
                    switch (this.__CP__) {
                      case -1:
                        assert false : "Internal error";
                        return false;
                      case 11:
                        this._11_i = 0;
                      case 12:
                        if (!(_11_i < configuration.getStateObject().nodes.size())) {
                          this.__CP__ = 1;
                          break;
                        }
                        this.__CP__ = 13;
                        break;
                      case 14:
                        _11_i++;
                        this.__CP__ = 12;
                        break;
                      case 2:
                        if (configuration.getStateObject().node != null) {
                          this.__CP__ = 3;
                          break;
                        }
                        this.__CP__ = 4;
                        break;
                      case 7:
                        if (ListSequence.fromList(ITestCase_Behavior.call_getTestSet_1216130724401(_6_testNode)).isNotEmpty()) {
                          this.__CP__ = 8;
                          break;
                        }
                        this.__CP__ = 4;
                        break;
                      case 4:
                        if (configuration.getStateObject().nodes != null) {
                          this.__CP__ = 10;
                          break;
                        }
                        this.__CP__ = 1;
                        break;
                      case 17:
                        if (ListSequence.fromList(ITestCase_Behavior.call_getTestSet_1216130724401(_16_testNode)).isNotEmpty()) {
                          this.__CP__ = 18;
                          break;
                        }
                        this.__CP__ = 14;
                        break;
                      case 9:
                        this.__CP__ = 4;
                        this.yield(_6_testNode);
                        return true;
                      case 19:
                        this.__CP__ = 14;
                        this.yield(_16_testNode);
                        return true;
                      case 0:
                        this.__CP__ = 2;
                        break;
                      case 3:
                        this._6_testNode = TestRunUtil.getTestNode(configuration.getStateObject().node);
                        this.__CP__ = 7;
                        break;
                      case 8:
                        this.__CP__ = 9;
                        break;
                      case 10:
                        this.__CP__ = 11;
                        break;
                      case 13:
                        this._16_testNode = TestRunUtil.getTestNode(configuration.getStateObject().nodes.get(_11_i));
                        this.__CP__ = 17;
                        break;
                      case 18:
                        this.__CP__ = 19;
                        break;
                      default:
                        break __loop__;
                    }
                  } while (true);
                  return false;
                }
              };
            }
          };
        }
      });
    }

    public String check(DefaultJUnit_Configuration configuration) {
      String errorReport = null;
      if (Sequence.fromIterable(TestRunUtil.getValues(configuration.getStateObject().node, configuration.getStateObject().nodes)).isEmpty()) {
        errorReport = "classes list is empty";
      } else if (!(TestRunUtil.validateNodes(configuration.getStateObject().node, configuration.getStateObject().nodes))) {
        errorReport = "nodes are not valid";
      }
      return errorReport;
    }

  },
  MODEL() {

    public Iterable<SNode> collect(DefaultJUnit_Configuration configuration, MPSProject project) {
      return TestRunUtil.getModelTests(TestRunUtil.getModel(configuration.getStateObject().model));
    }

    public String check(DefaultJUnit_Configuration configuration) {
      String errorReport = null;
      if (configuration.getStateObject().model == null) {
        errorReport = "model is not selected or does not exist";
      } else if (!(TestRunUtil.validateModel(configuration.getStateObject().model))) {
        errorReport = "model is not valid";
      }
      return errorReport;
    }

  },
  MODULE() {

    public Iterable<SNode> collect(DefaultJUnit_Configuration configuration, MPSProject project) {
      return TestRunUtil.getModuleTests(configuration.getStateObject().module);
    }

    public String check(DefaultJUnit_Configuration configuration) {
      String errorReport = null;
      if (configuration.getStateObject().module == null) {
        errorReport = "module is not selected or does not exist";
      } else if (!(TestRunUtil.validateModule(configuration.getStateObject().module))) {
        errorReport = "module is not valid";
      }
      return errorReport;
    }

  },
  PROJECT() {

    public Iterable<SNode> collect(DefaultJUnit_Configuration configuration, final MPSProject project) {
      if (project == null) {
        return Sequence.fromIterable(Collections.<SNode>emptyList());
      }

      return Sequence.fromIterable(Sequence.fromClosure(new ISequenceClosure<IModule>() {
        public Iterable<IModule> iterable() {
          return project.getModules();
        }
      })).translate(new ITranslator2<IModule, SNode>() {
        public Iterable<SNode> translate(IModule it) {
          return TestRunUtil.getModuleTests(it);
        }
      });
    }

    public String check(DefaultJUnit_Configuration configuration) {
      String errorReport = null;
      MPSProject mpsProject = MPSDataKeys.MPS_PROJECT.getData(DataManager.getInstance().getDataContext());
      if (mpsProject != null) {
        if (!(TestRunUtil.containsTest(mpsProject))) {
          errorReport = "project does not contain tests";
        }
      }
      return errorReport;
    }

  };

  JUnitRunTypes() {
  }

  public abstract Iterable<SNode> collect(DefaultJUnit_Configuration configuration, MPSProject project);

  public abstract String check(DefaultJUnit_Configuration cofiguration);
}
