package jetbrains.mps.baseLanguage.plugin;

/*Generated by MPS */

import com.intellij.execution.configurations.RunConfigurationBase;
import com.intellij.util.xmlb.annotations.Tag;
import com.intellij.openapi.project.Project;
import com.intellij.execution.configurations.ConfigurationFactory;
import com.intellij.execution.configurations.RuntimeConfigurationException;
import com.intellij.execution.configurations.RunProfileState;
import org.jetbrains.annotations.NotNull;
import com.intellij.execution.Executor;
import com.intellij.execution.runners.ExecutionEnvironment;
import com.intellij.execution.ExecutionException;
import org.jetbrains.annotations.Nullable;
import com.intellij.execution.ExecutionResult;
import com.intellij.execution.runners.ProgramRunner;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import javax.swing.JComponent;
import java.util.List;
import com.intellij.openapi.actionSystem.AnAction;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import com.intellij.execution.process.ProcessHandler;
import jetbrains.mps.smodel.ModelAccess;
import jetbrains.mps.workbench.MPSDataKeys;
import com.intellij.execution.ui.ExecutionConsole;
import com.intellij.execution.configurations.RunnerSettings;
import com.intellij.execution.configurations.ConfigurationPerRunnerSettings;
import com.intellij.openapi.util.JDOMExternalizable;
import com.intellij.execution.configurations.ConfigurationInfoProvider;
import com.intellij.openapi.options.SettingsEditor;
import com.intellij.execution.configurations.RunConfiguration;
import jetbrains.mps.smodel.SNode;
import jetbrains.mps.smodel.SNodePointer;
import com.intellij.ide.DataManager;
import org.jdom.Element;
import com.intellij.openapi.util.WriteExternalException;
import com.intellij.util.xmlb.XmlSerializer;
import com.intellij.openapi.util.InvalidDataException;

public class DefaultJavaApplication_Configuration extends RunConfigurationBase {

  @Tag(value = "state")
  private DefaultJavaApplication_Configuration.MyState myState = new DefaultJavaApplication_Configuration.MyState();

  public DefaultJavaApplication_Configuration(Project p, ConfigurationFactory f, String name) {
    super(p, f, name);
  }

  public void checkConfiguration() throws RuntimeConfigurationException {
    StringBuilder error = new StringBuilder();
    if (error.length() != 0) {
      throw new RuntimeConfigurationException(error.toString());
    }
  }

  public RunProfileState getState(@NotNull() final Executor executor, @NotNull() final ExecutionEnvironment environment) throws ExecutionException {
    return new RunProfileState() {

      @Nullable()
      public ExecutionResult execute(Executor executor, @NotNull() ProgramRunner runner) throws ExecutionException {
        final Wrappers._T<JComponent> consoleComponent = new Wrappers._T<JComponent>();
        final Wrappers._T<Runnable> consoleDispose = new Wrappers._T<Runnable>(null);
        final List<AnAction> actions = ListSequence.fromList(new ArrayList<AnAction>());
        ProcessHandler handler = null;
        ModelAccess.instance().runReadAction(new Runnable() {

          public void run() {
            Project project = MPSDataKeys.PROJECT.getData(environment.getDataContext());
            final RunComponent runComponent = new RunComponent(project);

            consoleComponent.value = runComponent;
            consoleDispose.value = new Runnable() {

              public void run() {
                runComponent.dispose();
              }
            };

            ClassRunner classRunner = new ClassRunner(runComponent);
            classRunner.run(DefaultJavaApplication_Configuration.this.getStateObject().myNode.getNode());
          }
        });
        final JComponent finalConsoleComponent = consoleComponent.value;
        final Runnable finalConsoleDispose = consoleDispose.value;
        final ProcessHandler finalHandler = handler;
        return new ExecutionResult() {

          public ExecutionConsole getExecutionConsole() {
            return new ExecutionConsole() {

              public void dispose() {
                if (finalConsoleDispose == null) {
                  return;
                }
                finalConsoleDispose.run();
              }

              public JComponent getComponent() {
                return finalConsoleComponent;
              }

              public JComponent getPreferredFocusableComponent() {
                return finalConsoleComponent;
              }
            };
          }

          public AnAction[] getActions() {
            return ListSequence.fromList(actions).toGenericArray(AnAction.class);
          }

          public ProcessHandler getProcessHandler() {
            return finalHandler;
          }
        };
      }

      public RunnerSettings getRunnerSettings() {
        return null;
      }

      public ConfigurationPerRunnerSettings getConfigurationSettings() {
        return null;
      }
    };
  }

  public JDOMExternalizable createRunnerSettings(ConfigurationInfoProvider p0) {
    return null;
  }

  public SettingsEditor<? extends RunConfiguration> getConfigurationEditor() {
    return new SettingsEditor <DefaultJavaApplication_Configuration>() {

      private ConfigEditor myComponent = null;

      protected void resetEditorFrom(DefaultJavaApplication_Configuration c) {
        System.out.printf("asd");
      }

      protected void applyEditorTo(final DefaultJavaApplication_Configuration c) {
        final SNode node = this.myComponent.getNode();
        ModelAccess.instance().runReadAction(new Runnable() {

          public void run() {
            c.getStateObject().myNode = new SNodePointer(node);
          }
        });
      }

      @NotNull()
      protected JComponent createEditor() {
        this.myComponent = new ConfigEditor(MPSDataKeys.MPS_PROJECT.getData(DataManager.getInstance().getDataContext()));
        return this.myComponent;
      }

      protected void disposeEditor() {
      }
    };
  }

  @Nullable()
  public SettingsEditor<JDOMExternalizable> getRunnerSettingsEditor(ProgramRunner p0) {
    return null;
  }

  public void writeExternal(Element e) throws WriteExternalException {
    e.addContent(XmlSerializer.serialize(this.myState));
  }

  public void readExternal(Element e) throws InvalidDataException {
    XmlSerializer.deserializeInto(this.myState, ((Element)e.getChildren().get(0)));
  }

  public DefaultJavaApplication_Configuration.MyState getStateObject() {
    return this.myState;
  }

  public static class MyState {

    public SNodePointer myNode;

    public MyState() {
    }
}

}
