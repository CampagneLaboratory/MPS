package jetbrains.mps.build.ant.generation;

/*Generated by MPS */

import jetbrains.mps.tool.common.ScriptProperties;
import jetbrains.mps.build.ant.MyExecuteStreamHandler;
import jetbrains.mps.build.ant.MyTeamcityAwareExecuteStreamHandler;
import jetbrains.mps.tool.common.TeamCityMessageFormat;
import jetbrains.mps.build.ant.ProjectNested;
import java.util.Iterator;
import org.apache.tools.ant.types.resources.FileResource;

public class TestGenerationOnTeamcity extends GenerateTask {
  {
    myWhatToDo.putProperty(ScriptProperties.INVOKE_TESTS, Boolean.toString(false));
    myWhatToDo.putProperty(ScriptProperties.SHOW_DIFF, Boolean.toString(false));
    myWhatToDo.putProperty(ScriptProperties.GENERATE_PERFORMANCE_REPORT, "");
  }

  public TestGenerationOnTeamcity() {
  }

  public boolean getShowDiff() {
    return Boolean.parseBoolean(myWhatToDo.getProperty(ScriptProperties.SHOW_DIFF));
  }

  public void setShowDiff(boolean isDifferenceCalculated) {
    myWhatToDo.putProperty(ScriptProperties.SHOW_DIFF, Boolean.toString(isDifferenceCalculated));
  }

  public boolean getInvokeTests() {
    return Boolean.parseBoolean(myWhatToDo.getProperty(ScriptProperties.INVOKE_TESTS));
  }

  public void setInvokeTests(boolean invokeTests) {
    myWhatToDo.putProperty(ScriptProperties.INVOKE_TESTS, Boolean.toString(invokeTests));
  }

  public boolean getSaveOnDisk() {
    return Boolean.parseBoolean(myWhatToDo.getProperty(ScriptProperties.SAVE_ON_DISK));
  }

  public void setSaveOnDisk(boolean saveOnDisk) {
    myWhatToDo.putProperty(ScriptProperties.SAVE_ON_DISK, Boolean.toString(saveOnDisk));
  }

  public void addConfiguredPerfomanceReport(PerfomanceReport report) {
    myWhatToDo.addPerfomanceReport(report.toString());
  }

  @Override
  protected String getWorkerClass() {
    return "jetbrains.mps.tool.builder.make.TestGenerationWorker";
  }

  @Override
  protected MyExecuteStreamHandler getExecuteStreamHandler() {
    return new MyTeamcityAwareExecuteStreamHandler(this, new TeamCityMessageFormat());
  }

  public void addConfiguredProject(ProjectNested projectInner) {
    if (projectInner.getWholeProject()) {
      Iterator it = projectInner.iterator();
      while (it.hasNext()) {
        FileResource next = (FileResource) it.next();
        myWhatToDo.addProjectFile(next.getFile(), ScriptProperties.WHOLE_PROJECT);
      }
    } else {
      super.addConfiguredProject(projectInner);
    }
  }
}
