<?xml version="1.0" encoding="UTF-8"?>
<project name="MPS-external" default="main">
  <import file="MPS-languages.xml" />
  <property file=".\MPS.properties" />
  <target name="main" depends="clean.before,folders.create,do.the.job,clean.after" />
  <target name="clean.before">
    <delete dir="${deploy.dir}" />
  </target>
  <target name="folders.create" depends="clean.before">
    <mkdir dir="${deploy.dir}" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\agreement" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\complexLanguage" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\dslbook_example" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\fibonacci" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\fixedLengthReader" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\formulaLanguage" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\core" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\core\baseLanguage" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\core\languageDesign" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\core\configuration" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\core\configurations" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\platform" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\platform\businessRules" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\platform\dnq" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\platform\panacea" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\platform\springframework" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\platform\web-query" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\platform\webr" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\platform\stateMachine" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\docs" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\META-INF" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\plugin" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\.configuration" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\workbench" />
    <mkdir dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\log" />
  </target>
  <target name="do.the.job" depends="folders.create">
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\kernel\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="workbench\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\core\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\actionsLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\editorLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\annotations\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\cfaLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\constraintsLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\editorLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\findUsagesLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\helgins\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\intentionsLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\patternLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\pluginLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\quotation\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\refactoring\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\scriptLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\scriptLanguage\runtime\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\sharedConcepts\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\smodelLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\structureLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\languageDesign\transformation\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\projectLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\baseLanguage\baseLanguage\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\baseLanguage\collections\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="core\baseLanguage\collections\runtime\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp">
      <fileset dir="MPSPlugin\MPSSupport\classes" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <jar destfile="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar" filesonly="true">
      <fileset dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </jar>
    <delete dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp" />
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib">
      <fileset dir="lib" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\agreement">
      <fileset dir="app\agreement" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\complexLanguage">
      <fileset dir="app\complexLanguage" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\dslbook_example">
      <fileset dir="app\dslbook_example" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\fibonacci">
      <fileset dir="app\fibonacci" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\fixedLengthReader">
      <fileset dir="app\fixedLengthReader" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\app\formulaLanguage">
      <fileset dir="app\formulaLanguage" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <antcall target="pack.jetbrains.mps.baseLanguageInternal" />
    <antcall target="pack.jetbrains.mps.closures" />
    <antcall target="pack.closures.test" />
    <antcall target="pack.jetbrains.mps.baseLanguage.ext.collections.lang" />
    <antcall target="pack.collections_samples" />
    <antcall target="pack.collections_generationTest" />
    <antcall target="pack.collections_unittest" />
    <antcall target="pack.jetbrains.mps.baseLanguage.ext.csharp" />
    <antcall target="pack.jetbrains.mps.baseLanguage.ext.dates.lang" />
    <antcall target="pack.jetbrains.mps.baseLanguage.ext.dates.internal" />
    <antcall target="pack.dates_unittest" />
    <antcall target="pack.jetbrains.mps.internal.collections" />
    <antcall target="pack.jetbrains.accounting.money" />
    <antcall target="pack.editor" />
    <antcall target="pack.JDK" />
    <antcall target="pack.jetbrains.mps.baseLanguage.blTypes" />
    <antcall target="pack.jetbrains.mps.baseLanguage" />
    <antcall target="pack.jetbrains.mps.baseLanguage.strings" />
    <antcall target="pack.MPS.Classpath" />
    <antcall target="pack.refactoring" />
    <antcall target="pack.resolve" />
    <antcall target="pack.testLogger" />
    <antcall target="pack.testLogger2" />
    <antcall target="pack.jetbrains.mps.bootstrap.actionsLanguage" />
    <antcall target="pack.jetbrains.mps.annotations" />
    <antcall target="pack.jetbrains.mps.bootstrap.cfaLanguage" />
    <antcall target="pack.jetbrains.mps.bootstrap.constraintsLanguage" />
    <antcall target="pack.jetbrains.mps.bootstrap.editorLanguage" />
    <antcall target="pack.jetbrains.mps.bootstrap.findUsagesLanguage" />
    <antcall target="pack.jetbrains.mps.bootstrap.helgins" />
    <antcall target="pack.jetbrains.mps.bootstrap.intentionsLanguage" />
    <antcall target="pack.jetbrains.mpslite" />
    <antcall target="pack.jetbrains.mps.nanoj" />
    <antcall target="pack.jetbrains.mps.patterns" />
    <antcall target="pack.jetbrains.mps.quotation" />
    <antcall target="pack.jetbrains.mps.bootstrap.pluginLanguage" />
    <antcall target="pack.jetbrains.mps.bootstrap.sharedConcepts" />
    <antcall target="pack.jetbrains.mps.bootstrap.smodelLanguage" />
    <antcall target="pack.jetbrains.mps.ide.scriptLanguage" />
    <antcall target="pack.jetbrains.mps.ide.scriptLanguageInternal" />
    <antcall target="pack.jetbrains.mps.bootstrap.structureLanguage" />
    <antcall target="pack.jetbrains.mps.core" />
    <antcall target="pack.jetbrains.mps.logging.refactoring" />
    <antcall target="pack.jetbrains.mps.transformation.test.inputLang" />
    <antcall target="pack.jetbrains.mps.transformation.test.outputLang" />
    <antcall target="pack.jetbrains.mps.transformation.TLBase" />
    <antcall target="pack.smodelLanguage-samples" />
    <antcall target="pack.smodelLanguage_typetest" />
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\core\configuration">
      <fileset dir="core\configuration" excludes="**/*.java, **/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\core\configurations">
      <fileset dir="core\configurations" excludes="**/*.java, **/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <antcall target="pack.jetbrains.mps.projectLanguage" />
    <antcall target="pack.ypath.main" />
    <antcall target="pack.ypath.test" />
    <antcall target="pack.jetbrains.mps.buildlanguage" />
    <antcall target="pack.jetbrains.mps.mpsLayoutLanguage" />
    <antcall target="pack.jetbrains.mps.mpsProjectLanguage" />
    <antcall target="pack.jetbrains.mps.propertylanguage" />
    <antcall target="pack.jetbrains.mps.bookLanguage" />
    <antcall target="pack.jetbrains.mps.regexp" />
    <antcall target="pack.jetbrains.mps.regexp.examples" />
    <antcall target="pack.jetbrains.mps.textLanguage" />
    <antcall target="pack.jetbrains.mps.textLanguage.formula" />
    <antcall target="pack.jetbrains.mps.textLanguage.table" />
    <antcall target="pack.jetbrains.mps.uiLanguage" />
    <antcall target="pack.jetbrains.mps.baseLanguage.unitTest" />
    <antcall target="pack.jetbrains.mps.xml" />
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\docs">
      <fileset dir="docs" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\META-INF">
      <fileset dir="META-INF" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\plugin">
      <fileset dir="plugin" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\.configuration">
      <fileset dir=".configuration" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <antcall target="pack.jetbrains.mps.ide.uiLanguage" />
    <antcall target="pack.jetbrains.mps.monitorLanguage" />
    <antcall target="pack.jetbrains.mps.ide" />
    <copy todir="${deploy.dir}\MPS-${build.number}.zip.tmp\\log">
      <fileset dir="log" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </copy>
    <echo file="${deploy.dir}\MPS-${build.number}.zip.tmp\\build.number">build.number=${build.number}${line.separator}revision.number=${build.vcs.number.1}${line.separator}configuration.name=${teamcity.buildConfName}</echo>
    <copy file="changelog.txt" tofile="${deploy.dir}\MPS-${build.number}.zip.tmp\\changelog.txt" />
    <copy file="entryPoints.xml" tofile="${deploy.dir}\MPS-${build.number}.zip.tmp\\entryPoints.xml" />
    <copy file="focuskiller.dll" tofile="${deploy.dir}\MPS-${build.number}.zip.tmp\\focuskiller.dll" />
    <copy file="focuskiller64.dll" tofile="${deploy.dir}\MPS-${build.number}.zip.tmp\\focuskiller64.dll" />
    <copy file="plugin.xml" tofile="${deploy.dir}\MPS-${build.number}.zip.tmp\\plugin.xml" />
    <copy file="readme.txt" tofile="${deploy.dir}\MPS-${build.number}.zip.tmp\\readme.txt" />
    <copy file="runMPS.bat" tofile="${deploy.dir}\MPS-${build.number}.zip.tmp\\runMPS.bat" />
    <copy file="runMPS.sh" tofile="${deploy.dir}\MPS-${build.number}.zip.tmp\\runMPS.sh" />
    <zip destfile="${deploy.dir}\MPS-${build.number}.zip" filesonly="true">
      <fileset dir="${deploy.dir}\MPS-${build.number}.zip.tmp" excludes="**/*.iml, **/*.ipr, **/*.java" />
    </zip>
    <delete dir="${deploy.dir}\MPS-${build.number}.zip.tmp" />
  </target>
  <target name="clean.after" depends="do.the.job">
    <delete dir="${deploy.dir}\MPS-${build.number}.zip.tmp" />
    <delete dir="${deploy.dir}\MPS-${build.number}.zip.tmp\\lib\mps.jar.tmp" />
  </target>
</project>

