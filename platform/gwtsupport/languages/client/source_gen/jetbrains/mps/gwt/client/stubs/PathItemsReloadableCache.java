package jetbrains.mps.gwt.client.stubs;

/*Generated by MPS */

import java.util.Map;
import jetbrains.mps.reloading.ClassLoaderManager;
import jetbrains.mps.reloading.ReloadAdapter;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;

public class PathItemsReloadableCache {
  private static Map<String, PathItem> Cache = null;

  public PathItemsReloadableCache() {
  }

  public static PathItem getPathItem(String path) {
    synchronized (PathItemsReloadableCache.class) {
      if (Cache == null) {
        ClassLoaderManager.getInstance().addReloadHandler(new ReloadAdapter() {
          public void onReload() {
            synchronized (PathItemsReloadableCache.class) {
              MapSequence.fromMap(PathItemsReloadableCache.Cache).clear();
              PathItemsReloadableCache.Cache = null;
            }
            ClassLoaderManager.getInstance().removeReloadHandler(this);
          }
        });
        Cache = MapSequence.fromMap(new HashMap<String, PathItem>());
      }
      PathItem pi = MapSequence.fromMap(Cache).get(path);
      if (pi == null) {
        pi = new GWTModulePathItem(path);
        MapSequence.fromMap(Cache).put(path, pi);
      }
      return pi;
    }
  }
}
