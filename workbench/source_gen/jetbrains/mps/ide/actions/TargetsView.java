package jetbrains.mps.ide.actions;

/*Generated by MPS */

import jetbrains.mps.ide.findusages.view.UsagesView;
import com.intellij.openapi.project.Project;
import jetbrains.mps.ide.findusages.view.treeholder.treeview.ViewOptions;
import jetbrains.mps.ide.findusages.view.treeholder.treeview.UsagesTree;
import javax.swing.event.TreeSelectionListener;
import javax.swing.event.TreeSelectionEvent;
import javax.swing.tree.TreePath;
import jetbrains.mps.ide.ui.MPSTreeNode;
import jetbrains.mps.ide.findusages.view.treeholder.tree.DataNode;
import jetbrains.mps.ide.findusages.view.treeholder.tree.nodedatatypes.BaseNodeData;
import jetbrains.mps.ide.findusages.view.treeholder.tree.nodedatatypes.ModelNodeData;
import jetbrains.mps.ide.findusages.view.treeholder.tree.nodedatatypes.ModuleNodeData;
import jetbrains.mps.ide.findusages.view.treeholder.tree.nodedatatypes.NodeNodeData;

public class TargetsView extends UsagesView {
  public TargetsView(Project project, DependenciesComponent parent) {
    super(project, new ViewOptions(true, true, false, false, false));
    UsagesTree usagesTree = getTreeComponent().getTree();
    usagesTree.addTreeSelectionListener(new TargetsView.MyTreeSelectionListener(usagesTree, parent));
  }

  public void close() {
  }

  private static <T> T as_w7qo2b_a0a0a0a1a2a3a0a(Object o, Class<T> type) {
    return (type.isInstance(o) ?
      (T) o :
      null
    );
  }

  private static <T> T as_w7qo2b_a0a0a0a2a2a3a0a(Object o, Class<T> type) {
    return (type.isInstance(o) ?
      (T) o :
      null
    );
  }

  private static <T> T as_w7qo2b_a0a0a0a3a2a3a0a(Object o, Class<T> type) {
    return (type.isInstance(o) ?
      (T) o :
      null
    );
  }

  public class MyTreeSelectionListener implements TreeSelectionListener {
    private UsagesTree myTree;
    private DependenciesComponent myDependenciesComponent;

    public MyTreeSelectionListener(UsagesTree tree, DependenciesComponent parent) {
      myTree = tree;
      myDependenciesComponent = parent;
    }

    public void valueChanged(TreeSelectionEvent event) {
      TreePath[] paths = myTree.getSelectionPaths();
      if (paths == null || paths.length == 0) {
        return;
      }
      Scope scope = new Scope();
      for (TreePath path : paths) {
        MPSTreeNode node = (MPSTreeNode) path.getLastPathComponent();
        Object userObject = node.getUserObject();
        if (userObject instanceof DataNode) {
          BaseNodeData data = ((DataNode) userObject).getData();
          if (data instanceof ModelNodeData) {
            scope.add(as_w7qo2b_a0a0a0a1a2a3a0a(data, ModelNodeData.class).getModelDescriptor());
          }
          if (data instanceof ModuleNodeData) {
            scope.add(as_w7qo2b_a0a0a0a2a2a3a0a(data, ModuleNodeData.class).getModule());
          }
          if (data instanceof NodeNodeData) {
            scope.add(as_w7qo2b_a0a0a0a3a2a3a0a(data, NodeNodeData.class).getNode());
          }
        }
      }
      myDependenciesComponent.updateReferencesView(scope);
    }
  }
}
