package jetbrains.mps.ide.actions;

/*Generated by MPS */

import java.util.List;
import jetbrains.mps.project.IModule;
import jetbrains.mps.smodel.SModelDescriptor;
import jetbrains.mps.smodel.SNode;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import jetbrains.mps.smodel.SModel;

public class Scope {
  private List<IModule> myModules;
  private List<SModelDescriptor> myModels;
  private List<SNode> myRoots;

  public Scope() {
    myModules = ListSequence.fromList(new ArrayList<IModule>());
    myModels = ListSequence.fromList(new ArrayList<SModelDescriptor>());
    myRoots = ListSequence.fromList(new ArrayList<SNode>());
  }

  private int getNumRoots(SModelDescriptor model) {
    return ListSequence.fromList(SModelOperations.getRoots(((SModel) model.getSModel()), null)).count();
  }

  public boolean contains(SNode node) {
    if (node == null) {
      return false;
    }
    SNode root = node.getContainingRoot();
    if (ListSequence.fromList(myRoots).contains(root)) {
      return true;
    }
    SModelDescriptor descriptor = root.getModel().getModelDescriptor();
    if (ListSequence.fromList(myModels).contains(descriptor)) {
      return true;
    }
    if (ListSequence.fromList(myModules).contains(descriptor.getModule())) {
      return true;
    }
    return false;
  }

  public void add(IModule module) {
    ListSequence.fromList(myModules).addElement(module);
  }

  public void add(SModelDescriptor model) {
    ListSequence.fromList(myModels).addElement(model);
  }

  public void add(SNode root) {
    ListSequence.fromList(myRoots).addElement(root);
  }

  public List<SModelDescriptor> getModels() {
    return myModels;
  }

  public List<IModule> getModules() {
    return myModules;
  }

  public int getNumRoots() {
    int result = 0;
    for (IModule module : myModules) {
      result += getNumRoots(module);
    }
    for (SModelDescriptor model : myModels) {
      result += getNumRoots(model);
    }
    return result;
  }

  private int getNumRoots(IModule module) {
    int result = 0;
    for (SModelDescriptor model : module.getOwnModelDescriptors()) {
      result += getNumRoots(model);
    }
    return result;
  }
}
