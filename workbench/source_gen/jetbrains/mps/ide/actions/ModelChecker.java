package jetbrains.mps.ide.actions;

/*Generated by MPS */

import jetbrains.mps.ide.findusages.model.SearchResults;
import jetbrains.mps.smodel.IOperationContext;
import jetbrains.mps.smodel.SModelDescriptor;
import java.util.List;
import jetbrains.mps.smodel.ModelAccess;
import jetbrains.mps.smodel.SModel;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.ide.findusages.model.SearchResult;

public class ModelChecker {
  public static final String SEVERITY_ERROR = "Errors";
  public static final String SEVERITY_WARNING = "Warnings";
  public static final String SEVERITY_INFO = "Infos";

  private SearchResults<ModelCheckerIssue> myResults = new SearchResults<ModelCheckerIssue>();
  private IOperationContext myOperationContext;
  private ProgressContext myProgressContext;

  public ModelChecker(IOperationContext operationContext, ProgressContext progressContext) {
    myOperationContext = operationContext;
    myProgressContext = progressContext;
  }

  public ModelChecker(IOperationContext operationContext, ProgressContext progressContext, SearchResults<ModelCheckerIssue> results) {
    myResults = results;
    myOperationContext = operationContext;
    myProgressContext = progressContext;
  }

  public void checkModel(final SModelDescriptor modelDescriptor) {
    final List<SpecificChecker> specificCheckers = ModelCheckerSettings.getInstance().getSpecificCheckers();

    ModelAccess.instance().runReadAction(new Runnable() {
      public void run() {
        SModel model = modelDescriptor.getSModel();

        for (SpecificChecker specificChecker : ListSequence.fromList(specificCheckers)) {
          List<SearchResult<ModelCheckerIssue>> specificCheckerResults = specificChecker.checkModel(model, myProgressContext, myOperationContext);
          myResults.getSearchResults().addAll(specificCheckerResults);
          if (isCancelled()) {
            break;
          }
        }
      }
    });
  }

  public SearchResults<ModelCheckerIssue> getSearchResults() {
    return myResults;
  }

  public boolean isCancelled() {
    return myProgressContext.getProgressIndicator().isCanceled();
  }

  public IOperationContext getOperationContext() {
    return myOperationContext;
  }
}
