package jetbrains.mps.ide.actions;

/*Generated by MPS */

import jetbrains.mps.smodel.SNode;
import jetbrains.mps.ide.dialogs.BaseDialog;
import jetbrains.mps.ide.ui.MPSTree;
import jetbrains.mps.ide.ui.MPSTreeNode;
import jetbrains.mps.nodeEditor.EditorContext;
import java.awt.Frame;
import javax.swing.JComponent;
import javax.swing.JScrollPane;
import javax.swing.JPanel;
import java.awt.BorderLayout;
import jetbrains.mps.ide.dialogs.DialogDimensionsSettings;
import java.util.List;
import jetbrains.mps.ide.ui.TextTreeNode;
import jetbrains.mps.util.NameUtil;
import jetbrains.mps.ide.icons.IconManager;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;

public abstract class SelectMembersDialog<T extends SNode> extends BaseDialog {
  protected SNode myClassifier;
  private String myMemberDescription;
  private MPSTree myTree = new MPSTree() {
    protected MPSTreeNode rebuild() {
      return SelectMembersDialog.this.rebuildOurTree();
    }
  };

  public SelectMembersDialog(EditorContext editorContext, Frame mainFrame, SNode node, String memberDescription) {
    super(mainFrame, "Select " + memberDescription);
    this.myMemberDescription = memberDescription;
    this.myClassifier = node;
    this.myTree.setRootVisible(true);
  }

  protected JComponent getMainComponent() {
    this.myTree.rebuildNow();
    this.myTree.expandAll();
    this.myTree.selectFirstLeaf();
    JScrollPane scrollPane = new JScrollPane(this.myTree);
    JPanel mainPanel = new JPanel(new BorderLayout());
    mainPanel.add(scrollPane, BorderLayout.CENTER);
    return mainPanel;
  }

  @Override
  public DialogDimensionsSettings.DialogDimensions getDefaultDimensionSettings() {
    return new DialogDimensionsSettings.DialogDimensions(100, 100, 150, 200);
  }

  @BaseDialog.Button(position = 0, name = "OK", mnemonic = 'O', defaultButton = true)
  public void onOk() {
    this.dispose();
  }

  @BaseDialog.Button(position = 1, name = "Cancel", mnemonic = 'C')
  public void onCancel() {
    this.dispose();
  }

  protected abstract List<T> getMembers();

  private MPSTreeNode rebuildOurTree() {
    TextTreeNode root = new TextTreeNode(NameUtil.capitalize(this.myMemberDescription));
    for (final T member : this.getMembers()) {
      MPSNodeInSelectDialog<T> newNode = new MPSNodeInSelectDialog<T>(member);
      newNode.setIcon(IconManager.getIconFor(member));
      newNode.setText(SPropertyOperations.getString(member, "name"));
      root.add(newNode);
    }
    return root;
  }

  public List<T> getSelectedMembers() {
    List<T> members = ListSequence.fromList(new ArrayList<T>());
    for (MPSTreeNode selectedNode : this.myTree.getSelectedNodes(MPSNodeInSelectDialog.class, null)) {
      ListSequence.fromList(members).addElement(((MPSNodeInSelectDialog<T>)selectedNode).getNode());
    }
    return members;

  }
}
