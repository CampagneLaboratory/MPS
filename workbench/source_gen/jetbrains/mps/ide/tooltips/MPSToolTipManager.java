package jetbrains.mps.ide.tooltips;

/*Generated by MPS */

import com.intellij.openapi.components.ApplicationComponent;
import java.util.Set;
import java.awt.Component;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import java.awt.event.MouseMotionListener;
import java.awt.event.MouseMotionAdapter;
import java.awt.event.MouseEvent;
import org.jetbrains.annotations.NonNls;
import org.jetbrains.annotations.NotNull;
import javax.swing.JComponent;
import java.awt.Point;
import java.awt.Frame;
import org.apache.commons.lang.ObjectUtils;
import javax.swing.SwingUtilities;
import com.intellij.openapi.application.ApplicationManager;

public class MPSToolTipManager implements ApplicationComponent {
  private Set<Component> myComponents = SetSequence.fromSet(new HashSet<Component>());
  private MouseMotionListener myListener = new MouseMotionAdapter() {
    @Override
    public void mouseMoved(MouseEvent p0) {
      MPSToolTipManager.this.mouseMoved(p0);
    }
  };
  private ToolTip myToolTip;

  public MPSToolTipManager() {
  }

  @NonNls
  @NotNull
  public String getComponentName() {
    return "MPSTooltipManager";
  }

  public void disposeComponent() {
  }

  public void initComponent() {
  }

  public void registerComponent(Component component) {
    SetSequence.fromSet(this.myComponents).addElement(component);
    component.addMouseMotionListener(this.myListener);
  }

  private void mouseMoved(MouseEvent event) {
    JComponent component = (JComponent)event.getComponent();
    Point point = component.getToolTipLocation(event);
    if (point == null) {
      point = event.getPoint();
    }
    String text = component.getToolTipText(event);
    if (text != null) {
      this.showToolTip(text, component, point);
    } else {
      this.hideToolTip();
    }
  }

  public Frame getContainingFrame(Component component) {
    while (component.getParent() != null) {
      component = component.getParent();
    }
    return (Frame)component;
  }

  public void showToolTip(String text, JComponent component, Point point) {
    if (this.myToolTip != null) {
      if (ObjectUtils.equals(this.myToolTip.getText(), text)) {
        return;
      }
      this.hideToolTip();
    }
    this.myToolTip = new ToolTip();
    Frame frame = this.getContainingFrame(component);
    Point widowPoint = SwingUtilities.convertPoint(component, point, frame);
    this.myToolTip.show(frame, widowPoint, new ToolTipData(text));
  }

  public void hideToolTip() {
    if (this.myToolTip != null) {
      this.myToolTip.hide();
      this.myToolTip = null;
    }
  }

  public static MPSToolTipManager getInstance() {
    return ApplicationManager.getApplication().getComponent(MPSToolTipManager.class);
  }
}
