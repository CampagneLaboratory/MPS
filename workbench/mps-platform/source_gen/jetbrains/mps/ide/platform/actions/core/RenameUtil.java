package jetbrains.mps.ide.platform.actions.core;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.smodel.runtime.ConstraintsDescriptor;
import jetbrains.mps.smodel.language.ConceptRegistry;
import jetbrains.mps.smodel.runtime.PropertyConstraintsDescriptor;
import org.apache.log4j.Level;
import org.apache.log4j.Logger;
import org.apache.log4j.LogManager;

public class RenameUtil {
  public static boolean canBeRenamed(SNode node) {
    // we won't rename nodes, for which there are registered name constrints 
    // if there are constrints, but they are not compiled, we can rename it 
    String nameProperty = SPropertyOperations.getString(ListSequence.fromList(SLinkOperations.getChildren(MetaAdapterFactory.getInterfaceConcept(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, "jetbrains.mps.lang.core.structure.INamedConcept").getDeclarationNode(), MetaAdapterFactory.getContainmentLink(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0x1103553c5ffL, 0xf979c3ba6cL, "propertyDeclaration"))).first(), MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name"));
    ConstraintsDescriptor cd = ConceptRegistry.getInstance().getConstraintsDescriptor(node.getConcept());
    PropertyConstraintsDescriptor property = cd.getProperty(nameProperty);
    if (property == null) {
      if (LOG.isEnabledFor(Level.ERROR)) {
        LOG.error("RenameUtil.canBeRenamed() called for property " + nameProperty + " with no constrints descriptor. Node:" + node.getPresentation());
      }
      return false;
    }
    return !((property.isReadOnly()));
  }
  protected static Logger LOG = LogManager.getLogger(RenameUtil.class);
}
