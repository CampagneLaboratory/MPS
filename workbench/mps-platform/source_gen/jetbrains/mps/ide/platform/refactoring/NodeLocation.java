package jetbrains.mps.ide.platform.refactoring;

/*Generated by MPS */

import org.jetbrains.mps.openapi.module.SRepository;
import java.util.List;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.annotations.Nullable;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.model.SNodeUtil;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.smodel.Language;
import jetbrains.mps.smodel.LanguageAspect;

public interface NodeLocation {
  public boolean isValid(SRepository repository, List<SNode> nodesToMove, @Nullable SContainmentLink role);
  public void insertNodes(List<SNode> nodesToMove, @Nullable SContainmentLink role);
  public static class NodeLocationChild implements NodeLocation {
    private SNode parent;
    public NodeLocationChild(SNode parent) {
      this.parent = parent;
    }
    public SNode getNode() {
      return parent;
    }
    public boolean isValid(SRepository repository, List<SNode> nodesToMove, final SContainmentLink role) {
      return role != null && SNodeUtil.isAccessible(parent, repository) && parent.getConcept().getContainmentLinks().contains(role) && ListSequence.fromList(nodesToMove).all(new IWhereFilter<SNode>() {
        public boolean accept(SNode it) {
          return SConceptOperations.isSubConceptOf(SNodeOperations.asSConcept(SNodeOperations.getConcept(it)), SNodeOperations.asSConcept(role.getTargetConcept()));
        }
      });
    }
    public void insertNodes(List<SNode> nodesToMove, SContainmentLink role) {
      for (SNode node : ListSequence.fromList(nodesToMove)) {
        SNode oldParent = node.getParent();
        if (oldParent != null) {
          oldParent.removeChild(node);
        }
        parent.addChild(role, node);
      }
    }
  }
  public static class NodeLocationRoot implements NodeLocation {
    private SModel model;
    public NodeLocationRoot(SModel model) {
      this.model = model;
    }
    public boolean isValid(SRepository repository, List<SNode> nodesToMove, SContainmentLink role) {
      return model.getReference().resolve(repository) == model && ListSequence.fromList(nodesToMove).all(new IWhereFilter<SNode>() {
        public boolean accept(SNode it) {
          return SPropertyOperations.getBoolean(SNodeOperations.as(SNodeOperations.asNode(SNodeOperations.getConcept(it)), MetaAdapterFactory.getConcept(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979ba0450L, "jetbrains.mps.lang.structure.structure.ConceptDeclaration")), MetaAdapterFactory.getProperty(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979ba0450L, 0xff49c1d648L, "rootable"));
        }
      });
    }
    public void insertNodes(List<SNode> nodesToMove, SContainmentLink role) {
      for (SNode node : ListSequence.fromList(nodesToMove)) {
        SModel oldModel = node.getModel();
        if (oldModel != null) {
          oldModel.removeRootNode(node);
        }
        model.addRootNode(node);
      }
    }
  }
  public static class NodeLocationRootWithAspectModelCreation implements NodeLocation {
    private Language myLanguage;
    private LanguageAspect myAspect;
    public NodeLocationRootWithAspectModelCreation(Language languageModule, LanguageAspect aspect) {
      myLanguage = languageModule;
      myAspect = aspect;
    }
    public boolean isValid(SRepository repository, List<SNode> nodesToMove, SContainmentLink role) {
      return ListSequence.fromList(nodesToMove).all(new IWhereFilter<SNode>() {
        public boolean accept(SNode it) {
          return SPropertyOperations.getBoolean(SNodeOperations.as(SNodeOperations.asNode(SNodeOperations.getConcept(it)), MetaAdapterFactory.getConcept(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979ba0450L, "jetbrains.mps.lang.structure.structure.ConceptDeclaration")), MetaAdapterFactory.getProperty(0xc72da2b97cce4447L, 0x8389f407dc1158b7L, 0xf979ba0450L, 0xff49c1d648L, "rootable"));
        }
      });
    }
    public void insertNodes(List<SNode> nodesToMove, SContainmentLink role) {
      SModel model = myAspect.getOrCreate(myLanguage);
      for (SNode node : ListSequence.fromList(nodesToMove)) {
        SModel oldModel = node.getModel();
        if (oldModel != null) {
          oldModel.removeRootNode(node);
        }
        model.addRootNode(node);
      }
    }
  }
}
