package jetbrains.mps.ide.refactoring;

/*Generated by MPS */

import jetbrains.mps.ide.platform.refactoring.RenameDialog;
import jetbrains.mps.project.Solution;
import com.intellij.openapi.project.Project;
import java.awt.HeadlessException;
import jetbrains.mps.smodel.ModelAccessHelper;
import jetbrains.mps.ide.project.ProjectHelper;
import jetbrains.mps.util.Computable;
import jetbrains.mps.smodel.MPSModuleRepository;
import jetbrains.mps.refactoring.renameSolution.SolutionRenamer;

public class RenameSolutionDialog extends RenameDialog {
  private Solution mySolution;

  public RenameSolutionDialog(Project project, Solution solution) throws HeadlessException {
    super(project, solution.getModuleName(), "solution");
    mySolution = solution;
    setTitle("Rename Solution");
  }

  @Override
  protected void doRefactoringAction() {
    boolean renamed = new ModelAccessHelper(ProjectHelper.getModelAccess(getProject())).executeCommand(new Computable<Boolean>() {
      @Override
      public Boolean compute() {
        final String fqName = getCurrentValue();
        if (MPSModuleRepository.getInstance().getModuleByFqName(fqName) != null) {
          setErrorText("Duplicate solution name");
          return false;
        }
        new SolutionRenamer(mySolution, fqName).rename();
        return true;
      }
    });

    //  TODO ?  
    if (renamed) {
      super.doRefactoringAction();
    }
  }
}
