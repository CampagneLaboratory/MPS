package jetbrains.mps.ide.actions;

/*Generated by MPS */

import com.intellij.openapi.ui.DialogWrapper;
import javax.swing.JPanel;
import javax.swing.JComboBox;
import com.intellij.openapi.project.Project;
import java.util.List;
import java.awt.GridBagLayout;
import java.awt.GridBagConstraints;
import java.awt.Insets;
import javax.swing.JLabel;
import javax.swing.DefaultComboBoxModel;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import org.jetbrains.annotations.Nullable;
import javax.swing.JComponent;
import java.awt.Dimension;

public class SetNodePackageDialog extends DialogWrapper {
  private boolean myIsCancelled = true;
  private JPanel myMainPanel;
  private JComboBox myCbPackage;
  private String myPackage;

  public SetNodePackageDialog(Project project, String title, List<String> existingPackages) {
    super(project);
    setTitle(title);
    setModal(true);
    myMainPanel = new JPanel();
    myMainPanel.setLayout(new GridBagLayout());
    GridBagConstraints c = new GridBagConstraints(0, 0, 1, 1, 1, 0, GridBagConstraints.NORTHWEST, GridBagConstraints.HORIZONTAL, new Insets(0, 0, 0, 0), 0, 0);
    myMainPanel.add(new JLabel("Enter virtual package name:"), c);
    myCbPackage = new JComboBox();
    myCbPackage.setEditable(true);
    myCbPackage.setModel(new DefaultComboBoxModel(ListSequence.fromList(existingPackages).toGenericArray(String.class)));
    myCbPackage.addActionListener(new ActionListener() {
      public void actionPerformed(ActionEvent e) {
        myPackage = ((String) myCbPackage.getSelectedItem());
      }
    });
    myCbPackage.getEditor().getEditorComponent().addKeyListener(new KeyAdapter() {
      public void keyPressed(KeyEvent e) {
        if (e.getKeyCode() == KeyEvent.VK_ENTER && !(myCbPackage.isPopupVisible())) {
          doOKAction();
        }
      }
    });
    c.gridy = 1;
    myMainPanel.add(myCbPackage, c);
    c.gridy = 2;
    c.weighty = 1.0;
    myMainPanel.add(new JPanel(), c);

    init();
  }

  @Nullable
  protected JComponent createCenterPanel() {
    getWindow().setMinimumSize(new Dimension(250, 150));
    return myMainPanel;
  }

  public String getPackage() {
    return myPackage;
  }

  private void updatePackage() {
    String pack = ((String) myCbPackage.getEditor().getItem());
    if (pack != null && pack.length() == 0) {
      pack = null;
    }
    myPackage = pack;
  }

  public void setPackage(String pack) {
    if (pack == null) {
      pack = "";
    }
    myCbPackage.setSelectedItem(pack);
  }

  public boolean isCancelled() {
    return myIsCancelled;
  }

  @Override
  protected void doOKAction() {
    updatePackage();
    myIsCancelled = false;
    super.doOKAction();
  }
}
