package jetbrains.mps.ide.actions;

/*Generated by MPS */

import com.intellij.openapi.ui.DialogWrapper;
import javax.swing.JComponent;
import javax.swing.JTextArea;
import com.intellij.openapi.project.Project;
import jetbrains.mps.smodel.IOperationContext;
import org.jetbrains.annotations.Nullable;
import java.awt.Dimension;
import javax.swing.JPanel;
import java.awt.BorderLayout;
import javax.swing.JLabel;
import jetbrains.mps.ide.datatransfer.TextPasteUtil;
import javax.swing.JScrollPane;
import com.intellij.ui.ScrollPaneFactory;
import com.intellij.execution.ui.ConsoleView;
import com.intellij.unscramble.AnalyzeStacktraceUtil;

public class AnalyzeStacktraceDialog extends DialogWrapper {
  private JComponent myComponent;
  private JTextArea myText;
  private Project myProject;

  public AnalyzeStacktraceDialog(Project project, final IOperationContext context) {
    super(project);
    setTitle("Analyze Stacktrace");
    this.myProject = project;
    this.myComponent = this.createPanel();

    init();
  }

  @Nullable
  protected JComponent createCenterPanel() {
    getWindow().setMinimumSize(new Dimension(700, 600));
    return this.myComponent;
  }

  @Override
  public void show() {
    super.show();
  }

  public JComponent createPanel() {
    JPanel panel = new JPanel(new BorderLayout());
    panel.add(new JLabel("Put a stack trace here:"), BorderLayout.NORTH);
    this.myText = new JTextArea("");
    String str = TextPasteUtil.getStringFromClipboard();
    if (str != null) {
      this.myText.setText(str);
    }
    panel.add(this.myText, BorderLayout.CENTER);
    JScrollPane scrollPane = ScrollPaneFactory.createScrollPane(panel);
    scrollPane.getVerticalScrollBar().setBlockIncrement(40);
    scrollPane.getVerticalScrollBar().setUnitIncrement(20);
    scrollPane.getHorizontalScrollBar().setBlockIncrement(40);
    return scrollPane;
  }

  @Override
  protected void doOKAction() {
    ConsoleView consoleView = AnalyzeStacktraceUtil.addConsole(myProject, null, "<Stacktrace>");
    AnalyzeStacktraceUtil.printStacktrace(consoleView, myText.getText());
    super.doOKAction();
  }
}
