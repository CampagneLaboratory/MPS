<!--
  ~ Copyright 2003-2010 JetBrains s.r.o.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<project name="IDEA-plugin-compile" default="compile" basedir="..">

    <property name="base_dir" value="."/>
    <property name="artifacts" value="${base_dir}/IdeaPlugin/mps-core/lib"/>
    <property name="build_dir" value="${base_dir}/IdeaPlugin/build"/>

    <path id="mps.core.libraries">
        <path path="${base_dir}/lib/ecj.jar"/>
        <path path="${base_dir}/lib/guava-r06.jar"/>
        <path path="${base_dir}/lib/jdom.jar"/>
        <path path="${base_dir}/lib/log4j.jar"/>
        <path path="${base_dir}/lib/trove4j.jar"/>
        <path path="${base_dir}/lib/xstream.jar"/>
        <path path="${base_dir}/lib/annotations.jar"/>
        <path path="${base_dir}/lib/asm.jar"/>
        <path path="${base_dir}/lib/commons-lang-2.4.jar"/>
        <path path="${base_dir}/lib/commons-logging-1.1.jar"/>
        <path path="${base_dir}/lib/diffutils-1.2.1.jar"/>
    </path>

    <target name="clean">
        <delete dir="${artifacts}"/>
        <delete dir="${build_dir}"/>
    </target>

    <target name="compile">
        <mkdir dir="${artifacts}"/>

        <mkdir dir="${build_dir}/mpscore_jar"/>
        <javac classpathref="mps.core.libraries" destdir="${build_dir}/mpscore_jar" fork="true"
               memorymaximumsize="1024m"
               includeantruntime="false">
            <compilerarg value="-Xlint:none"/>
            <src>
                <path path="${base_dir}/core/baseLanguage/collections/runtime/source_gen"/>
                <path path="${base_dir}/core/baseLanguage/closures/runtime/source"/>
                <path path="${base_dir}/core/baseLanguage/closures/runtime/source_gen"/>
                <path path="${base_dir}/core/baseLanguage/tuples/runtime/source_gen"/>

                <!-- runtime -->
                <path path="core/runtime/source"/>

                <!-- kernel -->
                <path path="core/kernel/source"/>
                <path path="core/kernel/source_gen"/>
                <path path="core/kernel/dataFlowRuntime/source"/>
                <path path="core/kernel/dataFlowRuntime/source_gen"/>
                <path path="core/kernel/patternRuntime/source"/>
                <path path="core/kernel/patternRuntime/source_gen"/>
                <path path="core/kernel/resources/source_gen"/>
                <path path="core/kernel/smodelRuntime/source_gen"/>
                <path path="core/kernel/stubUtils/source_gen"/>
                <path path="core/kernel/traceinfo/solutions/jetbrains.mps.debug.api.info/source_gen"/>

                <!-- make-runtime -->
                <path path="core/make-runtime/solutions/jetbrains.mps.make/source_gen"/>
                <path path="core/make-runtime/solutions/jetbrains.mps.make.runtime/source_gen"/>

                <!-- generator -->
                <path path="core/generator/solutions/traceInfo/util/source_gen"/>
                <path path="core/generator/source"/>
                <path path="core/generator/source_gen"/>

                <!-- typesystemEngine -->
                <path path="core/typesystemEngine/source"/>
                <path path="core/typesystemEngine/source_gen"/>

                <!-- findUsages-runtime -->
                <path path="core/findUsages-runtime/source"/>
                <path path="core/findUsages-runtime/source_gen"/>
            </src>
        </javac>
        <jar destfile="${artifacts}/mps-core.jar">
            <fileset dir="${build_dir}/mpscore_jar"/>
            <manifest>
                <attribute name="Built-By" value="${user.name}"/>
                <attribute name="Implementation-Vendor" value="JetBrains s.r.o."/>
                <attribute name="Implementation-Title" value="MPS Core modeling framework"/>
                <attribute name="Implementation-Version" value="1.0"/>
            </manifest>
        </jar>
        <copy todir="${artifacts}" flatten="true">
            <resources>
                <file file="${base_dir}/lib/ecj.jar"/>
                <file file="${base_dir}/lib/guava-r06.jar"/>
                <file file="${base_dir}/lib/jdom.jar"/>
                <file file="${base_dir}/lib/log4j.jar"/>
                <file file="${base_dir}/lib/trove4j.jar"/>
                <file file="${base_dir}/lib/xstream.jar"/>
                <file file="${base_dir}/lib/annotations.jar"/>
                <file file="${base_dir}/lib/asm.jar"/>
                <file file="${base_dir}/lib/commons-lang-2.4.jar"/>
                <file file="${base_dir}/lib/commons-logging-1.1.jar"/>
                <file file="${base_dir}/lib/diffutils-1.2.1.jar"/>
            </resources>
        </copy>
    </target>
</project>
