<!--
  ~ Copyright 2003-2010 JetBrains s.r.o.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<project name="IDEA-plugin-compile" default="jar-plugin" basedir="..">

  <!--classpath-->

  <path id="core.classpath">
    <!--<path path="classes"/>-->

    <fileset dir="core/kernel/classes"/>
    <fileset dir="core/findUsages-runtime/classes"/>
    <fileset dir="core/refactoring-runtime/classes"/>
    <fileset dir="core/typesystemEngine/classes"/>
    <fileset dir="core/typesystemIntegration/classes"/>
    <fileset dir="core/generator/classes"/>
    <fileset dir="core/make-runtime/classes"/>
    <fileset dir="core/baseLanguage/closures/runtime/classes"/>
    <fileset dir="core/baseLanguage/collections/runtime/classes"/>
    <fileset dir="core/baseLanguage/collections/languages/trove/runtime/classes"/>
    <fileset dir="core/baseLanguage/tuples/runtime/classes"/>
    <fileset dir="core/baseLanguage/closures/runtime/classes"/>
    <fileset dir="core/baseLanguage/collections/languages/trove/runtime/classes"/>
    <fileset dir="core/baseLanguage/unitTest/solutions/runtime/classes"/>
    <fileset dir="core/baseLanguage/tuples/runtime/classes"/>
    <fileset dir="core/runtime/classes"/>
    <path path="core/baseLanguage/collections/languages/trove/runtime/lib/trove-2.1.0.jar"/>
    <path path="core/baseLanguage/unitTest/solutions/lib/lib/jmock-2.5.1/bsh-core-2.0b4.jar"/>
    <path path="core/baseLanguage/unitTest/solutions/lib/lib/jmock-2.5.1/cglib-nodep-2.1_3.jar"/>
    <path path="core/baseLanguage/unitTest/solutions/lib/lib/jmock-2.5.1/hamcrest-core-1.1.jar"/>
    <path path="core/baseLanguage/unitTest/solutions/lib/lib/jmock-2.5.1/hamcrest-library-1.1.jar"/>
    <path path="core/baseLanguage/unitTest/solutions/lib/lib/jmock-2.5.1/jmock-2.5.1.jar"/>
    <path path="core/baseLanguage/unitTest/solutions/lib/lib/jmock-2.5.1/jmock-junit3-2.5.1.jar"/>
    <path path="core/baseLanguage/unitTest/solutions/lib/lib/jmock-2.5.1/jmock-junit4-2.5.1.jar"/>
    <path path="core/baseLanguage/unitTest/solutions/lib/lib/jmock-2.5.1/objenesis-1.0.jar"/>
  </path>

  <path id="editor.classpath">
    <fileset dir="core/editor-runtime/classes"/>
    <fileset dir="core/actions-runtime/classes"/>
    <fileset dir="core/intentions-runtime/classes"/>
  </path>

  <path id="workbench.classpath">
    <fileset dir="core/idea-patch/classes"/>
    <fileset dir="core/plugin-runtime/classes"/>
    <fileset dir="core/baseLanguage/baseLanguage/solutions/jetbrains.mps.baseLanguage.index/classes_gen"/>
    <fileset dir="core/baseLanguage/baseLanguage/solutions/jetbrains.mps.baseLanguage.search/classes_gen"/>
    <fileset dir="core/baseLanguage/runConfigurations/runtime/classes"/>
    <fileset dir="core/languageDesign/test/classes"/>
    <fileset dir="workbench/classes"/>
    <fileset dir="languages/util/runConfigurations/classes"/>
    <fileset dir="workbench/typesystemUi/classes"/>
    <fileset dir="languages/util/uiLanguage/runtime/classes"/>
    <fileset dir="MPSPlugin/apiclasses"/>
    <fileset dir="core/baseLanguage/runConfigurations/runtime/classes"/>
    <fileset dir="core/analyzers/classes"/>
    <fileset dir="core/debug/classes"/>
    <fileset dir="core/debug-api/classes"/>
  </path>

  <!--tasks-->
  <property name="wrkdir" value="IdeaPlugin"/>

  <target name="clean">
    <delete dir="${wrkdir}/tempbuild"/>
    <delete dir="${wrkdir}/artifacts"/>
  </target>

  <target name="compile" depends="clean">
    <mkdir dir="${wrkdir}/tempbuild"/>

<!--
    <javac sourcepath="" classpathref="core.classpath" destdir="tempbuild" fork="true" memorymaximumsize="1024m">
      <src refid="core.sources"/>
    </javac>
-->
  </target>

  <target name="jar-plugin" depends="compile">
    <property name="artdir" value="${wrkdir}/artifacts"/>
    <mkdir dir="${artdir}"/>

    <jar destfile="${artdir}/core.jar" duplicate="preserve" filesonly="false">
      <path refid="core.classpath"/>
    </jar>
    <jar destfile="${artdir}/editor.jar" duplicate="preserve" filesonly="false">
      <path refid="editor.classpath"/>
    </jar>
    <jar destfile="${artdir}/workbench.jar" duplicate="preserve" filesonly="false">
      <path refid="workbench.classpath"/>
    </jar>
  </target>
</project>
