<?xml version="1.0" encoding="UTF-8"?>
<model modelUID="r:00000000-0000-4000-0000-011c8959040c(jetbrains.mps.samples.agreementLanguage.generator.baseLanguage@generator)">
  <persistence version="3" />
  <refactoringHistory />
  <language namespace="f3061a53-9226-4cc5-a443-f952ceaf5816(jetbrains.mps.baseLanguage)" />
  <language namespace="b401a680-8325-4110-8fd3-84331ff25bef(jetbrains.mps.lang.generator)" />
  <language namespace="7866978e-a0f0-4cc7-81bc-4d213d9375e1(jetbrains.mps.lang.smodel)" />
  <language namespace="83888646-71ce-4f1c-9c53-c54016f6ad4f(jetbrains.mps.baseLanguage.ext.collections.lang)" />
  <language namespace="3a13115c-633c-4c5c-bbcc-75c4219e9555(jetbrains.mps.lang.quotation)" />
  <language namespace="d7706f63-9be2-479c-a3da-ae92af1e64d5(jetbrains.mps.transformation.generationContext)" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902c1(jetbrains.mps.baseLanguage.constraints)" version="83" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902ca(jetbrains.mps.baseLanguage.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902e2(jetbrains.mps.lang.generator.constraints)" version="16" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902e8(jetbrains.mps.lang.generator.structure)" version="2" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902fb(jetbrains.mps.lang.smodel.constraints)" version="21" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590301(jetbrains.mps.lang.smodel.structure)" version="3" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590328(jetbrains.mps.baseLanguage.ext.collections.lang.constraints)" version="6" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c8959032e(jetbrains.mps.baseLanguage.ext.collections.lang.structure)" version="1" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590283(jetbrains.mps.lang.core.constraints)" version="2" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590338(jetbrains.mps.closures.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c8959028c(jetbrains.mps.lang.structure.constraints)" version="11" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902ba(jetbrains.mps.lang.sharedConcepts.constraints)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590334(jetbrains.mps.closures.constraints)" version="2" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902ae(jetbrains.mps.bootstrap.helgins.constraints)" version="17" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590340(jetbrains.mps.lang.pattern.constraints)" version="2" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895903e4(jetbrains.mps.internal.collections.constraints)" version="2" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902db(jetbrains.mps.baseLanguage.blTypes.constraints)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c8959040a(jetbrains.mps.samples.agreementLanguage.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c8959043c(jetbrains.mps.samples.formulaLanguage.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590292(jetbrains.mps.lang.structure.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c895902bc(jetbrains.mps.lang.sharedConcepts.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c8959033d(jetbrains.mps.lang.annotations.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c8959034b(jetbrains.mps.lang.quotation.structure)" version="0" />
  <languageAspect modelUID="r:00000000-0000-4000-0000-011c89590345(jetbrains.mps.lang.pattern.structure)" version="0" />
  <maxImportIndex value="21" />
  <import index="1" modelUID="r:00000000-0000-4000-0000-011c895902ca(jetbrains.mps.baseLanguage.structure)" version="0" />
  <import index="6" modelUID="r:00000000-0000-4000-0000-011c8959043d(jetbrains.mps.samples.formulaLanguage.generator.baseLanguage@generator)" version="-1" />
  <import index="8" modelUID="f:java_stub#mf(mf@java_stub)" version="-1" />
  <import index="9" modelUID="f:java_stub#formulaAdapter(formulaAdapter@java_stub)" version="-1" />
  <import index="11" modelUID="f:java_stub#postingrules(postingrules@java_stub)" version="-1" />
  <import index="12" modelUID="r:00000000-0000-4000-0000-011c8959040a(jetbrains.mps.samples.agreementLanguage.structure)" version="0" />
  <import index="13" modelUID="f:java_stub#java.lang(java.lang@java_stub)" version="-1" />
  <import index="14" modelUID="r:00000000-0000-4000-0000-011c89590288(jetbrains.mps.lang.core.structure)" version="0" />
  <import index="15" modelUID="f:java_stub#jetbrains.mps.util(jetbrains.mps.util@java_stub)" version="-1" />
  <import index="16" modelUID="f:java_stub#jetbrains.mps.smodel(jetbrains.mps.smodel@java_stub)" version="-1" />
  <import index="17" modelUID="f:java_stub#jetbrains.mps.generator.template(jetbrains.mps.generator.template@java_stub)" version="-1" />
  <import index="18" modelUID="r:00000000-0000-4000-0000-011c8959043c(jetbrains.mps.samples.formulaLanguage.structure)" version="0" />
  <import index="19" modelUID="r:00000000-0000-4000-0000-011c8959040d(jetbrains.mps.samples.agreementLanguage.generator.util)" version="-1" />
  <import index="20" modelUID="f:java_stub#jetbrains.mps.samples.formulaLanguage.api(jetbrains.mps.samples.formulaLanguage.api@java_stub)" version="-1" />
  <node type="jetbrains.mps.lang.generator.structure.MappingConfiguration" id="1112303804151">
    <property name="name" value="MAPPING_Agreement_BaseLanguage" />
    <node role="createRootRule" type="jetbrains.mps.lang.generator.structure.CreateRootRule" id="1197658381645">
      <link role="templateNode" targetNodeId="1112304135028" resolveInfo="_registryBuilder_" />
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.CreateRootRule_Condition" id="1197658386740">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197658386741">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.RemarkStatement" id="1197658401279">
            <property name="value" value="apply rule if at least one Plan exists in input model" />
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197658704926">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197658704927">
              <property name="name" value="plans" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeListType" id="1197658704928">
                <link role="elementConcept" targetNodeId="12.1111790951422" resolveInfo="Plan" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620322">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1217017753737">
                  <node role="operand" type="jetbrains.mps.transformation.generationContext.structure.TemplateFunctionParameter_generationContext" id="1217017753755" />
                  <node role="operation" type="jetbrains.mps.transformation.generationContext.structure.GenerationContextOp_GetInputModel" id="1217017753756" />
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.Model_RootsOperation" id="1197658538932">
                  <link role="concept" targetNodeId="12.1111790951422" resolveInfo="Plan" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197658740590">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620058">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197658740593">
                <link role="variableDeclaration" targetNodeId="1197658704927" resolveInfo="plans" />
              </node>
              <node role="operation" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.IsNotEmptyOperation" id="1197658740592" />
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="dropRootRule" type="jetbrains.mps.lang.generator.structure.DropRootRule" id="1219962513833">
      <link role="applicableConcept" targetNodeId="12.1111790951422" resolveInfo="Plan" />
    </node>
  </node>
  <node type="jetbrains.mps.baseLanguage.structure.ClassConcept" id="1112304135028">
    <property name="name" value="_registryBuilder_" />
    <node role="method" type="jetbrains.mps.baseLanguage.structure.InstanceMethodDeclaration" id="1112304424500">
      <property name="name" value="setUp" />
      <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1112304446485">
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1112304630350">
          <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252618864">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.ParameterReference" id="1116365198847">
              <link role="variableDeclaration" targetNodeId="1116364787824" />
            </node>
            <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252618865">
              <link role="baseMethodDeclaration" targetNodeId="11.~AgreementRegistry.register(java.lang.String,postingrules.ServiceAgreement):void" resolveInfo="register" />
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1116365215243">
                <property name="value" value="_service_agreement_name_" />
                <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1116365237542">
                  <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197663015302">
                    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197663015303">
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197663021554">
                        <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1197663024103">
                          <link role="baseMethodDeclaration" targetNodeId="15.~NameUtil.decapitalize(java.lang.String):java.lang.String" resolveInfo="decapitalize" />
                          <link role="classConcept" targetNodeId="15.~NameUtil" resolveInfo="NameUtil" />
                          <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252626304">
                            <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197663026932" />
                            <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197663029655">
                              <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                            </node>
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252618463">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.ThisExpression" id="1116365207366" />
                <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252618464">
                  <link role="baseMethodDeclaration" targetNodeId="1112304451941" resolveInfo="_setUp_plan_" />
                </node>
              </node>
            </node>
          </node>
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.LoopMacro" id="1197662961259">
            <node role="sourceNodesQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodesQuery" id="1197662961260">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197662961261">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197662970608">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252621249">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1217017753788">
                      <node role="operand" type="jetbrains.mps.transformation.generationContext.structure.TemplateFunctionParameter_generationContext" id="1217017753790" />
                      <node role="operation" type="jetbrains.mps.transformation.generationContext.structure.GenerationContextOp_GetInputModel" id="1217017753791" />
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.Model_RootsOperation" id="1197662975348">
                      <link role="concept" targetNodeId="12.1111790951422" resolveInfo="Plan" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
      <node role="returnType" type="jetbrains.mps.baseLanguage.structure.VoidType" id="1112304424499" />
      <node role="parameter" type="jetbrains.mps.baseLanguage.structure.ParameterDeclaration" id="1116364787824">
        <property name="name" value="registry" />
        <node role="type" type="jetbrains.mps.baseLanguage.structure.ClassifierType" id="1116364787825">
          <link role="classifier" targetNodeId="11.~AgreementRegistry" resolveInfo="AgreementRegistry" />
        </node>
      </node>
      <node role="visibility" type="jetbrains.mps.baseLanguage.structure.PublicVisibility" id="1197661985357" />
    </node>
    <node role="method" type="jetbrains.mps.baseLanguage.structure.InstanceMethodDeclaration" id="1112304451941">
      <property name="name" value="_setUp_plan_" />
      <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1112304467348">
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1112309802835">
          <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1112309720328">
            <property name="name" value="result" />
            <node role="type" type="jetbrains.mps.baseLanguage.structure.ClassifierType" id="1112309720327">
              <link role="classifier" targetNodeId="11.~ServiceAgreement" resolveInfo="ServiceAgreement" />
            </node>
            <node role="initializer" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253958442">
              <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253958444">
                <link role="baseMethodDeclaration" targetNodeId="11.~ServiceAgreement.&lt;init&gt;()" resolveInfo="ServiceAgreement" />
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1116447174856">
          <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252618962">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1116447174857">
              <link role="variableDeclaration" targetNodeId="1112309720328" />
            </node>
            <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252618963">
              <link role="baseMethodDeclaration" targetNodeId="11.~ServiceAgreement.registerValue(java.lang.String):void" resolveInfo="registerValue" />
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1116447189892">
                <property name="value" value="_VALUE_" />
                <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1116447341598">
                  <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197663246177">
                    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197663246178">
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197663249007">
                        <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624075">
                          <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197663249008" />
                          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197663251090">
                            <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.LoopMacro" id="1197663210558">
            <node role="sourceNodesQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodesQuery" id="1197663210559">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197663210560">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197663220640">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252621573">
                    <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197663220641" />
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkListAccess" id="1197663228145">
                      <link role="link" targetNodeId="12.1111791064925" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1116447549350">
          <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252619554">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1116447549351">
              <link role="variableDeclaration" targetNodeId="1112309720328" />
            </node>
            <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252619555">
              <link role="baseMethodDeclaration" targetNodeId="11.~ServiceAgreement.setValue(java.lang.String,java.lang.Object,mf.MfDate):void" resolveInfo="setValue" />
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1116447710308">
                <property name="value" value="_VALUE_" />
                <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1116447710309">
                  <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197663461983">
                    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197663461984">
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197663496152">
                        <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197663496153">
                          <property name="name" value="value" />
                          <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197663496154">
                            <link role="concept" targetNodeId="12.1111791020814" resolveInfo="Value" />
                          </node>
                          <node role="initializer" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1197663479759">
                            <link role="concept" targetNodeId="12.1111791020814" resolveInfo="Value" />
                            <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624791">
                              <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1197663468316">
                                <link role="concept" targetNodeId="12.1111792520557" resolveInfo="QuantityTemporalProperty" />
                                <node role="leftExpression" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197663466393" />
                              </node>
                              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetParentOperation" id="1197663473946" />
                            </node>
                          </node>
                        </node>
                      </node>
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197663500812">
                        <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252625815">
                          <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197663502626">
                            <link role="variableDeclaration" targetNodeId="1197663496153" resolveInfo="value" />
                          </node>
                          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197663506162">
                            <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1116526851371">
                <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1116526865141">
                  <link role="templateSwitch" targetNodeId="1116526421328" />
                  <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197664761362">
                    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197664761363">
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197664764239">
                        <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620744">
                          <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197664764240" />
                          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197664773043">
                            <link role="link" targetNodeId="12.1111792541964" />
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1197665769939">
                <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1197665774753">
                  <link role="templateSwitch" targetNodeId="1116448085084" resolveInfo="SWITCH_Date" />
                  <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197665787457">
                    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197665787458">
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197665787459">
                        <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252625051">
                          <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197665787462" />
                          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197665787461">
                            <link role="link" targetNodeId="12.1111792372299" />
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.LoopMacro" id="1197663295185">
            <node role="sourceNodesQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodesQuery" id="1197663295186">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197663295187">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197663316584">
                  <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197663316585">
                    <property name="name" value="values" />
                    <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeListType" id="1197663316586">
                      <link role="elementConcept" targetNodeId="12.1111791020814" resolveInfo="Value" />
                    </node>
                    <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252626421">
                      <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197663304689" />
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkListAccess" id="1197663311396">
                        <link role="link" targetNodeId="12.1111791064925" />
                      </node>
                    </node>
                  </node>
                </node>
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197663341260">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252619958">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620109">
                      <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197663344137">
                        <link role="variableDeclaration" targetNodeId="1197663316585" resolveInfo="values" />
                      </node>
                      <node role="operation" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.MappingOperation" id="1197663349061">
                        <node role="mapper" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.MapperBlock" id="1197663349062">
                          <node role="defaultInputElement" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.DefaultInputElement" id="1197663349063">
                            <property name="name" value="value" />
                          </node>
                          <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197663349064">
                            <node role="statement" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.ForEachStatement" id="1197663372940">
                              <node role="variable" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.ForEachVariable" id="1197663372941">
                                <property name="name" value="quantity" />
                              </node>
                              <node role="inputSequence" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624564">
                                <node role="operand" type="jetbrains.mps.baseLanguage.structure.ClosureParameterReference" id="1197663400991">
                                  <link role="closureParameter" targetNodeId="1197663349063" resolveInfo="value" />
                                </node>
                                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkListAccess" id="1197663406042">
                                  <link role="link" targetNodeId="12.1111791826558" />
                                </node>
                              </node>
                              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197663372943">
                                <node role="statement" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.TraversalYieldStatement" id="1197663414621">
                                  <node role="value" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.ForEachVariableReference" id="1197663417404">
                                    <link role="variable" targetNodeId="1197663372941" resolveInfo="quantity" />
                                  </node>
                                </node>
                              </node>
                            </node>
                          </node>
                        </node>
                      </node>
                    </node>
                    <node role="operation" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.ToListOperation" id="1197663571370" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1112388552072">
          <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252619122">
            <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1112388552071">
              <link role="variableDeclaration" targetNodeId="1112309720328" />
            </node>
            <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252619123">
              <link role="baseMethodDeclaration" targetNodeId="11.~ServiceAgreement.addPostingRule(postingrules.EventType,postingrules.PostingRule,mf.MfDate):void" resolveInfo="addPostingRule" />
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1112388577217">
                <link role="variableDeclaration" targetNodeId="11.~EventType.TAX" resolveInfo="TAX" />
                <link role="classifier" targetNodeId="11.~EventType" resolveInfo="EventType" />
                <node role="referenceMacro$link_attribute$variableDeclaration" type="jetbrains.mps.lang.generator.structure.ReferenceMacro" id="1112389216038">
                  <node role="referentFunction" type="jetbrains.mps.lang.generator.structure.ReferenceMacro_GetReferent" id="1197659829378">
                    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197659829379">
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197659940653">
                        <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197659940654">
                          <property name="name" value="event" />
                          <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197659940655">
                            <link role="concept" targetNodeId="12.1111791038612" resolveInfo="Event" />
                          </node>
                          <node role="initializer" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1197659932260">
                            <link role="concept" targetNodeId="12.1111791038612" resolveInfo="Event" />
                            <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624464">
                              <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1197659906344">
                                <link role="concept" targetNodeId="12.1111794734295" resolveInfo="PostingRuleTemporalProperty" />
                                <node role="leftExpression" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197659831475" />
                              </node>
                              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetParentOperation" id="1197659919603" />
                            </node>
                          </node>
                        </node>
                      </node>
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197659983913">
                        <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197659983914">
                          <property name="name" value="eventType" />
                          <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197659983915">
                            <link role="concept" targetNodeId="12.1111793698243" resolveInfo="EventType" />
                          </node>
                          <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622126">
                            <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197659972736">
                              <link role="variableDeclaration" targetNodeId="1197659940654" resolveInfo="event" />
                            </node>
                            <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197659981240">
                              <link role="link" targetNodeId="12.1111793668132" />
                            </node>
                          </node>
                        </node>
                      </node>
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1197660036730">
                        <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197660036731">
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197660085893">
                            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252621071">
                              <node role="operand" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1197660100926">
                                <node role="quotedNode" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1197660157709">
                                  <link role="classifier" targetNodeId="11.~EventType" resolveInfo="EventType" />
                                  <link role="variableDeclaration" targetNodeId="11.~EventType.SERVICE_CALL" resolveInfo="SERVICE_CALL" />
                                </node>
                              </node>
                              <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197660217104">
                                <link role="link" targetNodeId="1.1070568178160" />
                              </node>
                            </node>
                          </node>
                        </node>
                        <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252619489">
                          <node role="operand" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197660052609">
                            <property name="value" value="SERVICE CALL" />
                          </node>
                          <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252619490">
                            <link role="baseMethodDeclaration" targetNodeId="13.~String.equals(java.lang.Object):boolean" resolveInfo="equals" />
                            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252626308">
                              <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197660076325">
                                <link role="variableDeclaration" targetNodeId="1197659983914" resolveInfo="eventType" />
                              </node>
                              <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197660082907">
                                <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                              </node>
                            </node>
                          </node>
                        </node>
                      </node>
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1197660227589">
                        <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197660227590">
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197660227591">
                            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623460">
                              <node role="operand" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1197660227594">
                                <node role="quotedNode" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1197660227595">
                                  <link role="classifier" targetNodeId="11.~EventType" resolveInfo="EventType" />
                                  <link role="variableDeclaration" targetNodeId="11.~EventType.USAGE" resolveInfo="USAGE" />
                                </node>
                              </node>
                              <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197660227593">
                                <link role="link" targetNodeId="1.1070568178160" />
                              </node>
                            </node>
                          </node>
                        </node>
                        <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252618639">
                          <node role="operand" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197660227597">
                            <property name="value" value="USAGE" />
                          </node>
                          <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252618640">
                            <link role="baseMethodDeclaration" targetNodeId="13.~String.equals(java.lang.Object):boolean" resolveInfo="equals" />
                            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622029">
                              <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197660227600">
                                <link role="variableDeclaration" targetNodeId="1197659983914" resolveInfo="eventType" />
                              </node>
                              <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197660249758">
                                <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                              </node>
                            </node>
                          </node>
                        </node>
                      </node>
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1197660289399">
                        <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197660289400">
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197660289401">
                            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624513">
                              <node role="operand" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1197660289404">
                                <node role="quotedNode" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1197660289405">
                                  <link role="classifier" targetNodeId="11.~EventType" resolveInfo="EventType" />
                                  <link role="variableDeclaration" targetNodeId="11.~EventType.TAX" resolveInfo="TAX" />
                                </node>
                              </node>
                              <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197660289403">
                                <link role="link" targetNodeId="1.1070568178160" />
                              </node>
                            </node>
                          </node>
                        </node>
                        <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252619747">
                          <node role="operand" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197660289407">
                            <property name="value" value="TAX" />
                          </node>
                          <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252619748">
                            <link role="baseMethodDeclaration" targetNodeId="13.~String.equals(java.lang.Object):boolean" resolveInfo="equals" />
                            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623022">
                              <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197660289410">
                                <link role="variableDeclaration" targetNodeId="1197659983914" resolveInfo="eventType" />
                              </node>
                              <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197660312599">
                                <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                              </node>
                            </node>
                          </node>
                        </node>
                      </node>
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197660343851">
                        <node role="expression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1197660349196" />
                      </node>
                    </node>
                  </node>
                </node>
              </node>
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253959025">
                <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253959027">
                  <link role="baseMethodDeclaration" targetNodeId="9.~PostingRule_Formula.&lt;init&gt;(postingrules.AccountType,boolean,jetbrains.mps.samples.formulaLanguage.api.Function)" resolveInfo="PostingRule_Formula" />
                  <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.EnumConstantReference" id="1197661235316">
                    <link role="enumClass" targetNodeId="11.~AccountType" resolveInfo="AccountType" />
                    <link role="enumConstantDeclaration" targetNodeId="11.~AccountType.TAX" resolveInfo="TAX" />
                    <node role="referenceMacro$link_attribute$enumConstantDeclaration" type="jetbrains.mps.lang.generator.structure.ReferenceMacro" id="1197661255754">
                      <node role="referentFunction" type="jetbrains.mps.lang.generator.structure.ReferenceMacro_GetReferent" id="1197661270681">
                        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197661270682">
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197661270683">
                            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197661270684">
                              <property name="name" value="postingRule" />
                              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197661270685">
                                <link role="concept" targetNodeId="12.1111794888922" resolveInfo="PostingRule" />
                              </node>
                              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252621962">
                                <node role="operand" type="jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression" id="1197661270688">
                                  <link role="concept" targetNodeId="12.1111794734295" resolveInfo="PostingRuleTemporalProperty" />
                                  <node role="leftExpression" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197661270689" />
                                </node>
                                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197661270687">
                                  <link role="link" targetNodeId="12.1111794782624" />
                                </node>
                              </node>
                            </node>
                          </node>
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197661270690">
                            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197661270691">
                              <property name="name" value="accountType" />
                              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197661270692">
                                <link role="concept" targetNodeId="12.1111795284642" resolveInfo="AccountType" />
                              </node>
                              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620435">
                                <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197661270695">
                                  <link role="variableDeclaration" targetNodeId="1197661270684" resolveInfo="postingRule" />
                                </node>
                                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197661270694">
                                  <link role="link" targetNodeId="12.1111795211704" />
                                </node>
                              </node>
                            </node>
                          </node>
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1197661270696">
                            <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197661270697">
                              <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197661270698">
                                <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252621200">
                                  <node role="operand" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1197661270701">
                                    <node role="quotedNode" type="jetbrains.mps.baseLanguage.structure.EnumConstantReference" id="1197661270702">
                                      <link role="enumClass" targetNodeId="11.~AccountType" resolveInfo="AccountType" />
                                      <link role="enumConstantDeclaration" targetNodeId="11.~AccountType.BASE_USAGE" resolveInfo="BASE_USAGE" />
                                    </node>
                                  </node>
                                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197661270700">
                                    <link role="link" targetNodeId="1.1083260308426" />
                                  </node>
                                </node>
                              </node>
                            </node>
                            <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252618735">
                              <node role="operand" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197661270704">
                                <property name="value" value="base-usage" />
                              </node>
                              <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252618736">
                                <link role="baseMethodDeclaration" targetNodeId="13.~String.equals(java.lang.Object):boolean" resolveInfo="equals" />
                                <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620795">
                                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197661270707">
                                    <link role="variableDeclaration" targetNodeId="1197661270691" resolveInfo="accountType" />
                                  </node>
                                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197661293204">
                                    <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                                  </node>
                                </node>
                              </node>
                            </node>
                          </node>
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1197661270708">
                            <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197661270709">
                              <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197661270710">
                                <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252621298">
                                  <node role="operand" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1197661270713">
                                    <node role="quotedNode" type="jetbrains.mps.baseLanguage.structure.EnumConstantReference" id="1197661270714">
                                      <link role="enumClass" targetNodeId="11.~AccountType" resolveInfo="AccountType" />
                                      <link role="enumConstantDeclaration" targetNodeId="11.~AccountType.SERVICE" resolveInfo="SERVICE" />
                                    </node>
                                  </node>
                                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197661270712">
                                    <link role="link" targetNodeId="1.1083260308426" />
                                  </node>
                                </node>
                              </node>
                            </node>
                            <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252619329">
                              <node role="operand" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197661270716">
                                <property name="value" value="service" />
                              </node>
                              <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252619330">
                                <link role="baseMethodDeclaration" targetNodeId="13.~String.equals(java.lang.Object):boolean" resolveInfo="equals" />
                                <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252626191">
                                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197661270719">
                                    <link role="variableDeclaration" targetNodeId="1197661270691" resolveInfo="accountType" />
                                  </node>
                                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197661295658">
                                    <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                                  </node>
                                </node>
                              </node>
                            </node>
                          </node>
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.IfStatement" id="1197661270720">
                            <node role="ifTrue" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197661270721">
                              <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197661270722">
                                <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252625149">
                                  <node role="operand" type="jetbrains.mps.lang.quotation.structure.Quotation" id="1197661270725">
                                    <node role="quotedNode" type="jetbrains.mps.baseLanguage.structure.EnumConstantReference" id="1197661270726">
                                      <link role="enumClass" targetNodeId="11.~AccountType" resolveInfo="AccountType" />
                                      <link role="enumConstantDeclaration" targetNodeId="11.~AccountType.TAX" resolveInfo="TAX" />
                                    </node>
                                  </node>
                                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197661270724">
                                    <link role="link" targetNodeId="1.1083260308426" />
                                  </node>
                                </node>
                              </node>
                            </node>
                            <node role="condition" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252618190">
                              <node role="operand" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197661270728">
                                <property name="value" value="tax" />
                              </node>
                              <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252618191">
                                <link role="baseMethodDeclaration" targetNodeId="13.~String.equals(java.lang.Object):boolean" resolveInfo="equals" />
                                <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252626537">
                                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197661270731">
                                    <link role="variableDeclaration" targetNodeId="1197661270691" resolveInfo="accountType" />
                                  </node>
                                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197661298956">
                                    <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                                  </node>
                                </node>
                              </node>
                            </node>
                          </node>
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.RemarkStatement" id="1197661270732">
                            <property name="value" value="error" />
                          </node>
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197661270733">
                            <node role="expression" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1197661270734" />
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                  <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.BooleanConstant" id="1116365608596">
                    <property name="value" value="true" />
                    <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1116375272578">
                      <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197663681552">
                        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197663681553">
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197663758929">
                            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197663758930">
                              <property name="name" value="event" />
                              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197663758931">
                                <link role="concept" targetNodeId="12.1111791038612" resolveInfo="Event" />
                              </node>
                              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623638">
                                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197663685573" />
                                <node role="operation" type="jetbrains.mps.lang.smodel.structure.Node_GetAncestorOperation" id="1197663708282">
                                  <node role="parameter" type="jetbrains.mps.lang.smodel.structure.OperationParm_Concept" id="1197663716111">
                                    <node role="conceptArgument" type="jetbrains.mps.lang.smodel.structure.RefConcept_Reference" id="1214252626542">
                                      <link role="conceptDeclaration" targetNodeId="12.1111791038612" resolveInfo="Event" />
                                    </node>
                                  </node>
                                </node>
                              </node>
                            </node>
                          </node>
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197663797942">
                            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623686">
                              <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197663804024">
                                <link role="variableDeclaration" targetNodeId="1197663758930" resolveInfo="event" />
                              </node>
                              <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197663804023">
                                <link role="property" targetNodeId="12.1116368080504" resolveInfo="taxable" />
                              </node>
                            </node>
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                  <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1112737316322">
                    <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1112737341886">
                      <link role="templateSwitch" targetNodeId="1112985235375" />
                      <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197668254451">
                        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197668254452">
                          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197668256813">
                            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620387">
                              <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252621849">
                                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197668256814" />
                                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197668267663">
                                  <link role="link" targetNodeId="12.1111794782624" />
                                </node>
                              </node>
                              <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197668273464">
                                <link role="link" targetNodeId="18.1111784226798" />
                              </node>
                            </node>
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1116449141741">
                <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1116449147446">
                  <link role="templateSwitch" targetNodeId="1116448085084" />
                  <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197665895323">
                    <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197665895324">
                      <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197665897309">
                        <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252626255">
                          <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197665897310" />
                          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197665905847">
                            <link role="link" targetNodeId="12.1111792372299" />
                          </node>
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.LoopMacro" id="1197659602869">
            <node role="sourceNodesQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodesQuery" id="1197659602870">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197659602871">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197659631628">
                  <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197659631629">
                    <property name="name" value="events" />
                    <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeListType" id="1197659631630">
                      <link role="elementConcept" targetNodeId="12.1111791038612" resolveInfo="Event" />
                    </node>
                    <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252625475">
                      <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197659621827" />
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkListAccess" id="1197659626971">
                        <link role="link" targetNodeId="12.1111791084333" />
                      </node>
                    </node>
                  </node>
                </node>
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197659675554">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620175">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620009">
                      <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197659678259">
                        <link role="variableDeclaration" targetNodeId="1197659631629" resolveInfo="events" />
                      </node>
                      <node role="operation" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.MappingOperation" id="1197659681386">
                        <node role="mapper" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.MapperBlock" id="1197659681387">
                          <node role="defaultInputElement" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.DefaultInputElement" id="1197659681388">
                            <property name="name" value="event" />
                          </node>
                          <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197659681389">
                            <node role="statement" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.ForEachStatement" id="1197659719101">
                              <node role="variable" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.ForEachVariable" id="1197659719102">
                                <property name="name" value="postingRule" />
                              </node>
                              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197659719104">
                                <node role="statement" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.TraversalYieldStatement" id="1197659758811">
                                  <node role="value" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.ForEachVariableReference" id="1197659763094">
                                    <link role="variable" targetNodeId="1197659719102" resolveInfo="postingRule" />
                                  </node>
                                </node>
                              </node>
                              <node role="inputSequence" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620695">
                                <node role="operand" type="jetbrains.mps.baseLanguage.structure.ClosureParameterReference" id="1197659730560">
                                  <link role="closureParameter" targetNodeId="1197659681388" resolveInfo="event" />
                                </node>
                                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkListAccess" id="1197659730559">
                                  <link role="link" targetNodeId="12.1111794644919" />
                                </node>
                              </node>
                            </node>
                          </node>
                        </node>
                      </node>
                    </node>
                    <node role="operation" type="jetbrains.mps.baseLanguage.ext.collections.lang.structure.ToListOperation" id="1197659790252" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1116365045703">
          <node role="expression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1116365048658">
            <link role="variableDeclaration" targetNodeId="1112309720328" />
          </node>
        </node>
      </node>
      <node role="returnType" type="jetbrains.mps.baseLanguage.structure.ClassifierType" id="1116365001264">
        <link role="classifier" targetNodeId="11.~ServiceAgreement" resolveInfo="ServiceAgreement" />
      </node>
      <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.LoopMacro" id="1197659458873">
        <node role="sourceNodesQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodesQuery" id="1197659458874">
          <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197659458875">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197659513693">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622289">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1217017753839">
                  <node role="operand" type="jetbrains.mps.transformation.generationContext.structure.TemplateFunctionParameter_generationContext" id="1217017753841" />
                  <node role="operation" type="jetbrains.mps.transformation.generationContext.structure.GenerationContextOp_GetInputModel" id="1217017753842" />
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.Model_RootsOperation" id="1197659538837">
                  <link role="concept" targetNodeId="12.1111790951422" resolveInfo="Plan" />
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
      <node role="propertyMacro$property_attribute$name" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1112304640353">
        <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197663161045">
          <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197663161046">
            <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197663167392">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.PlusExpression" id="1197663171050">
                <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624416">
                  <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197663173694" />
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197663175823">
                    <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                  </node>
                </node>
                <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197663167393">
                  <property name="value" value="setUp" />
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
      <node role="visibility" type="jetbrains.mps.baseLanguage.structure.PublicVisibility" id="1197661988749" />
    </node>
    <node role="propertyMacro$property_attribute$name" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1112304640355">
      <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197662782219">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197662782220">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197662895388">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197662895389">
              <property name="name" value="prefix" />
              <node role="type" type="jetbrains.mps.baseLanguage.structure.ClassifierType" id="1197662895390">
                <link role="classifier" targetNodeId="13.~String" resolveInfo="String" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1197662818880">
                <link role="baseMethodDeclaration" targetNodeId="15.~NameUtil.capitalize(java.lang.String):java.lang.String" resolveInfo="capitalize" />
                <link role="classConcept" targetNodeId="15.~NameUtil" resolveInfo="NameUtil" />
                <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252619892">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1217013946471">
                    <node role="operand" type="jetbrains.mps.transformation.generationContext.structure.TemplateFunctionParameter_generationContext" id="1217013945095" />
                    <node role="operation" type="jetbrains.mps.transformation.generationContext.structure.GenerationContextOp_GetInputModel" id="1217013949692" />
                  </node>
                  <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252619893">
                    <link role="baseMethodDeclaration" targetNodeId="16.~SModel.getShortName():java.lang.String" resolveInfo="getShortName" />
                  </node>
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197662908533">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.PlusExpression" id="1197662914442">
              <node role="rightExpression" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197662915570">
                <property name="value" value="RegistryBuilder" />
              </node>
              <node role="leftExpression" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197662912972">
                <link role="variableDeclaration" targetNodeId="1197662895389" resolveInfo="prefix" />
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="visibility" type="jetbrains.mps.baseLanguage.structure.PublicVisibility" id="1197661980621" />
    <node role="rootTemplateAnnotation$attribute" type="jetbrains.mps.lang.generator.structure.RootTemplateAnnotation" id="1217017705734" />
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateSwitch" id="1112733851363">
    <property name="name" value="SWITCH_AgreementExpression_NewFunction_Default" />
    <property name="package" value="formula" />
    <link role="modifiedSwitch" targetNodeId="6.1112818835473" />
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197670036598">
      <link role="applicableConcept" targetNodeId="12.1112036490295" resolveInfo="EventVariableReference" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197670127003">
        <link role="template" targetNodeId="1112804414269" resolveInfo="new_FeeMoneyFunction" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197670052131">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197670052132">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197670088504">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197670088505">
              <property name="name" value="eventVariable" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197670088506">
                <link role="concept" targetNodeId="12.1111793755198" resolveInfo="EventVariable" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623800">
                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197670075842" />
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197670086175">
                  <link role="link" targetNodeId="12.1112036516483" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197670092320">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252619057">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197670101150">
                <property name="value" value="fee" />
              </node>
              <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252619058">
                <link role="baseMethodDeclaration" targetNodeId="13.~String.equals(java.lang.Object):boolean" resolveInfo="equals" />
                <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624515">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197670116201">
                    <link role="variableDeclaration" targetNodeId="1197670088505" resolveInfo="eventVariable" />
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197670119252">
                    <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197670162614">
      <link role="applicableConcept" targetNodeId="18.1111786301085" resolveInfo="PlusOperation" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197670162615">
        <link role="template" targetNodeId="1112804501366" resolveInfo="new_MoneyAddOperationFunction" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197670162616">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197670162617">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197670162618">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197670162619">
              <property name="name" value="leftOperand" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197670162620">
                <link role="concept" targetNodeId="18.1111784312737" resolveInfo="Expression" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620793">
                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197670162623" />
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197670168502">
                  <link role="link" targetNodeId="18.1111784613299" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197670162624">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1197670162625">
              <link role="baseMethodDeclaration" targetNodeId="19.1197668835374" resolveInfo="isMoney" />
              <link role="classConcept" targetNodeId="19.1197668662570" resolveInfo="QueriesUtil" />
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197670162626">
                <link role="variableDeclaration" targetNodeId="1197670162619" resolveInfo="leftOperand" />
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197670245269">
      <link role="applicableConcept" targetNodeId="12.1111792102248" resolveInfo="Quantity" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197670254412">
        <link role="template" targetNodeId="1112804588435" resolveInfo="_new_MoneyConstantFunction_fromQuantity" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197670267710">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197670267711">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197670323227">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1197670313989">
              <link role="baseMethodDeclaration" targetNodeId="19.1197668835374" resolveInfo="isMoney" />
              <link role="classConcept" targetNodeId="19.1197668662570" resolveInfo="QueriesUtil" />
              <node role="actualArgument" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197670317163" />
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197670343604">
      <link role="applicableConcept" targetNodeId="12.1111792102248" resolveInfo="Quantity" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197670368848">
        <link role="template" targetNodeId="1112894400496" resolveInfo="_new_QuantityConstantFunction_fromQuantity" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197670348934">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197670348935">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197670353717">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.NotExpression" id="1197670357470">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1197670357471">
                <link role="classConcept" targetNodeId="19.1197668662570" resolveInfo="QueriesUtil" />
                <link role="baseMethodDeclaration" targetNodeId="19.1197668835374" resolveInfo="isMoney" />
                <node role="actualArgument" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197670357472" />
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197670409646">
      <link role="applicableConcept" targetNodeId="12.1112038445100" resolveInfo="ValueReference" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197670483774">
        <link role="template" targetNodeId="1112907559237" resolveInfo="_new_ValueQuantityFunction_fromValueReference" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197670443101">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197670443102">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197670445900">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623524">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624124">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623913">
                  <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197670445901" />
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197670463702">
                    <link role="link" targetNodeId="12.1112038462507" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197670465815">
                  <link role="property" targetNodeId="12.1111792955937" resolveInfo="type" />
                </node>
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Property_HasValue_Enum" id="1197670470975">
                <node role="value" type="jetbrains.mps.lang.smodel.structure.EnumMemberReference" id="1197670470976">
                  <link role="enumMember" targetNodeId="12.1111792874919" resolveInfo="QUANTITY" />
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197670517979">
      <link role="applicableConcept" targetNodeId="18.1112384225757" resolveInfo="MultOperation" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197670541492">
        <link role="template" targetNodeId="1112894086969" resolveInfo="_new_MoneyMultiplyOperation" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197670517981">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197670517982">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197670517983">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197670517984">
              <property name="name" value="leftOperand" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197670517985">
                <link role="concept" targetNodeId="18.1111784312737" resolveInfo="Expression" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622564">
                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197670517988" />
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197670517987">
                  <link role="link" targetNodeId="18.1111784613299" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197670517989">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1197670517990">
              <link role="baseMethodDeclaration" targetNodeId="19.1197668835374" resolveInfo="isMoney" />
              <link role="classConcept" targetNodeId="19.1197668662570" resolveInfo="QueriesUtil" />
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197670517991">
                <link role="variableDeclaration" targetNodeId="1197670517984" resolveInfo="leftOperand" />
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197670559040">
      <link role="applicableConcept" targetNodeId="18.1112406908640" resolveInfo="GreaterThanOperation" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197670736871">
        <link role="template" targetNodeId="1112902379896" resolveInfo="_new_QuantityGreaterThanOperation" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197670562995">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197670562996">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197670580092">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197670580093">
              <property name="name" value="leftOperand" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197670580094">
                <link role="concept" targetNodeId="18.1111784312737" resolveInfo="Expression" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623411">
                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197670580097" />
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197670580096">
                  <link role="link" targetNodeId="18.1111784613299" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197670580098">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1197670580099">
              <link role="classConcept" targetNodeId="19.1197668662570" resolveInfo="QueriesUtil" />
              <link role="baseMethodDeclaration" targetNodeId="19.1197670595148" resolveInfo="isQuantity" />
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197670580100">
                <link role="variableDeclaration" targetNodeId="1197670580093" resolveInfo="leftOperand" />
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112804414269">
    <property name="name" value="new_FeeMoneyFunction" />
    <property name="package" value="formula" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253959375">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253959377" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253959378">
        <link role="baseMethodDeclaration" targetNodeId="9.~FeeMoney.&lt;init&gt;()" resolveInfo="FeeMoney" />
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112804501366">
    <property name="name" value="new_MoneyAddOperationFunction" />
    <property name="package" value="formula" />
    <link role="applicableConcept" targetNodeId="18.1111786301085" resolveInfo="PlusOperation" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253958375">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253958377" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253958378">
        <link role="baseMethodDeclaration" targetNodeId="9.~MoneyAddOperation.&lt;init&gt;(jetbrains.mps.samples.formulaLanguage.api.Function,jetbrains.mps.samples.formulaLanguage.api.Function)" resolveInfo="MoneyAddOperation" />
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1112804541135">
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1112804671521">
            <link role="templateSwitch" targetNodeId="1112733851363" />
            <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197670008699">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197670008700">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197670010670">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623849">
                    <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197670010671" />
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197670014488">
                      <link role="link" targetNodeId="18.1111784613299" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1112804546121">
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1112804671522">
            <link role="templateSwitch" targetNodeId="1112733851363" />
            <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197673441717">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197673441718">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197673444118">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252625978">
                    <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197673444119" />
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197673448561">
                      <link role="link" targetNodeId="18.1111784647019" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112804588435">
    <property name="name" value="new_MoneyConstantFunction_fromQuantity" />
    <property name="package" value="formula" />
    <link role="applicableConcept" targetNodeId="12.1111792102248" resolveInfo="Quantity" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253959324">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253959326" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253959327">
        <link role="baseMethodDeclaration" targetNodeId="9.~MoneyConstant.&lt;init&gt;(double,mf.Currency)" resolveInfo="MoneyConstant" />
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.FloatingPointConstant" id="1112999428224">
          <property name="value" value="0.0" />
          <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1113259356564">
            <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197670869156">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197670869157">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197670871752">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623962">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252626140">
                      <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197670871753" />
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197670876007">
                        <link role="link" targetNodeId="12.1111793363741" />
                      </node>
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197670883120">
                      <link role="property" targetNodeId="18.1113257000626" resolveInfo="value" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1112804638643">
          <link role="variableDeclaration" targetNodeId="8.~Currency.USD" resolveInfo="USD" />
          <link role="classifier" targetNodeId="8.~Currency" resolveInfo="Currency" />
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112894086969">
    <property name="name" value="new_MoneyMultiplyOperation" />
    <property name="package" value="formula" />
    <link role="applicableConcept" targetNodeId="18.1112384225757" resolveInfo="MultOperation" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253959257">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253959259" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253959260">
        <link role="baseMethodDeclaration" targetNodeId="9.~MoneyMultiplyOperation.&lt;init&gt;(jetbrains.mps.samples.formulaLanguage.api.Function,jetbrains.mps.samples.formulaLanguage.api.Function)" resolveInfo="MoneyMultiplyOperation" />
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1112894129940">
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1112894241007">
            <link role="templateSwitch" targetNodeId="1112733851363" />
            <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197671353557">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197671353558">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197671355746">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620860">
                    <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197671355747" />
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197671359110">
                      <link role="link" targetNodeId="18.1111784613299" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1112894133239">
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1112894241008">
            <link role="templateSwitch" targetNodeId="1112915076342" />
            <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197671390861">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197671390862">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197671392598">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622629">
                    <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197671392599" />
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197671395462">
                      <link role="link" targetNodeId="18.1111784647019" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112894400496">
    <property name="name" value="new_QuantityConstantFunction_fromQuantity" />
    <property name="package" value="formula" />
    <link role="applicableConcept" targetNodeId="12.1111792102248" resolveInfo="Quantity" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253958756">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253958758" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253958759">
        <link role="baseMethodDeclaration" targetNodeId="9.~QuantityConstant.&lt;init&gt;(double,mf.Unit)" resolveInfo="QuantityConstant" />
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.FloatingPointConstant" id="1112999618731">
          <property name="value" value="0.0" />
          <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1113259356565">
            <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197670925981">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197670925982">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197670927686">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620484">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622971">
                      <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197670927687" />
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197670931034">
                        <link role="link" targetNodeId="12.1111793363741" />
                      </node>
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197670934945">
                      <link role="property" targetNodeId="18.1113257000626" resolveInfo="value" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1112894477110">
          <link role="variableDeclaration" targetNodeId="8.~Unit.KWH" resolveInfo="KWH" />
          <link role="classifier" targetNodeId="8.~Unit" resolveInfo="Unit" />
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112902379896">
    <property name="name" value="new_QuantityGreaterThanOperation" />
    <property name="package" value="formula" />
    <link role="applicableConcept" targetNodeId="18.1112406908640" resolveInfo="GreaterThanOperation" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253958507">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253958509" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253958510">
        <link role="baseMethodDeclaration" targetNodeId="9.~QuantityGreaterThanOperation.&lt;init&gt;(jetbrains.mps.samples.formulaLanguage.api.Function,jetbrains.mps.samples.formulaLanguage.api.Function)" resolveInfo="QuantityGreaterThanOperation" />
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1112902637460">
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1112902693652">
            <link role="templateSwitch" targetNodeId="1112916267895" />
            <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197671443307">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197671443308">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197671444903">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624678">
                    <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197671444904" />
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197671448376">
                      <link role="link" targetNodeId="18.1111784613299" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1112902639993">
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1112902693653">
            <link role="templateSwitch" targetNodeId="1112916267895" />
            <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197671463393">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197671463394">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197671465036">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623735">
                    <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197671465037" />
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197671468478">
                      <link role="link" targetNodeId="18.1111784647019" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112902887922">
    <property name="name" value="new_UsageQuantityFunction" />
    <property name="package" value="formula" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253958822">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253958824" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253958825">
        <link role="baseMethodDeclaration" targetNodeId="9.~UsageQuantity.&lt;init&gt;()" resolveInfo="UsageQuantity" />
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112902927238">
    <property name="name" value="new_UsageDoubleFunction" />
    <property name="package" value="formula" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253958955">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253958957" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253958958">
        <link role="baseMethodDeclaration" targetNodeId="9.~UsageDouble.&lt;init&gt;()" resolveInfo="UsageDouble" />
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112907559237">
    <property name="name" value="new_ValueQuantityFunction_fromValueReference" />
    <property name="package" value="formula" />
    <link role="applicableConcept" targetNodeId="12.1112038445100" resolveInfo="ValueReference" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253959075">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253959077" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253959078">
        <link role="baseMethodDeclaration" targetNodeId="9.~ValueQuantity.&lt;init&gt;(java.lang.String)" resolveInfo="ValueQuantity" />
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1116524183578">
          <property name="value" value="_VALUE_" />
          <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1116524198032">
            <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197671024196">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197671024197">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197671026588">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622695">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252625426">
                      <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197671026589" />
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197671030765">
                        <link role="link" targetNodeId="12.1112038462507" />
                      </node>
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197671033800">
                      <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateSwitch" id="1112915076342">
    <property name="name" value="SWITCH_AgreementExpression_NewFunction_Double" />
    <property name="package" value="formula" />
    <link role="modifiedSwitch" targetNodeId="6.1112979325952" />
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197671633209">
      <link role="applicableConcept" targetNodeId="12.1112036490295" resolveInfo="EventVariableReference" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197671759009">
        <link role="template" targetNodeId="1112902927238" resolveInfo="_new_UsageDoubleFunction" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197671638657">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197671638658">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197671729962">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197671729963">
              <property name="name" value="eventVariable" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197671729964">
                <link role="concept" targetNodeId="12.1111793755198" resolveInfo="EventVariable" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622467">
                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197671655207" />
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197671658977">
                  <link role="link" targetNodeId="12.1112036516483" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197671733607">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252619843">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197671735515">
                <property name="value" value="usage" />
              </node>
              <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252619844">
                <link role="baseMethodDeclaration" targetNodeId="13.~String.equals(java.lang.Object):boolean" resolveInfo="equals" />
                <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252626306">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197671748488">
                    <link role="variableDeclaration" targetNodeId="1197671729963" resolveInfo="eventVariable" />
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197671750726">
                    <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197671770572">
      <link role="applicableConcept" targetNodeId="12.1111792102248" resolveInfo="Quantity" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197671779621">
        <link role="template" targetNodeId="1112980998637" resolveInfo="_new_DoubleConstantFunction_fromQuantity" />
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197671787075">
      <link role="applicableConcept" targetNodeId="12.1112038445100" resolveInfo="ValueReference" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197671801640">
        <link role="template" targetNodeId="1112980575784" resolveInfo="_new_ValueDoubleFunction_fromValueReference" />
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateSwitch" id="1112916267895">
    <property name="name" value="SWITCH_AgreementExpression_NewFunction_Quantity" />
    <property name="package" value="formula" />
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197672119884">
      <link role="applicableConcept" targetNodeId="12.1112036490295" resolveInfo="EventVariableReference" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197672134441">
        <link role="template" targetNodeId="1112902887922" resolveInfo="_new_UsageQuantityFunction" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197672119886">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197672119887">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197672119888">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197672119889">
              <property name="name" value="eventVariable" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197672119890">
                <link role="concept" targetNodeId="12.1111793755198" resolveInfo="EventVariable" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252621524">
                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197672119893" />
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197672119892">
                  <link role="link" targetNodeId="12.1112036516483" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197672119894">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252618414">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197672119896">
                <property name="value" value="usage" />
              </node>
              <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252618415">
                <link role="baseMethodDeclaration" targetNodeId="13.~String.equals(java.lang.Object):boolean" resolveInfo="equals" />
                <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252625215">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197672119899">
                    <link role="variableDeclaration" targetNodeId="1197672119889" resolveInfo="eventVariable" />
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197672123908">
                    <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197672153660">
      <link role="applicableConcept" targetNodeId="12.1111792102248" resolveInfo="Quantity" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197672163209">
        <link role="template" targetNodeId="1112894400496" resolveInfo="new_QuantityConstantFunction_fromQuantity" />
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197672166992">
      <link role="applicableConcept" targetNodeId="12.1112038445100" resolveInfo="ValueReference" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197672183790">
        <link role="template" targetNodeId="1112907559237" resolveInfo="new_ValueQuantityFunction_fromValueReference" />
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112980575784">
    <property name="name" value="new_ValueDoubleFunction_fromValueReference" />
    <property name="package" value="formula" />
    <link role="applicableConcept" targetNodeId="12.1112038445100" resolveInfo="ValueReference" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253958889">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253958891" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253958892">
        <link role="baseMethodDeclaration" targetNodeId="9.~ValueDouble.&lt;init&gt;(java.lang.String)" resolveInfo="ValueDouble" />
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1116524441908">
          <property name="value" value="_VALUE_" />
          <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1116524441909">
            <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197671968115">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197671968116">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197671970367">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624629">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252621362">
                      <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197671970368" />
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197671974294">
                        <link role="link" targetNodeId="12.1112038462507" />
                      </node>
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197671977985">
                      <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112980998637">
    <property name="name" value="new_DoubleConstantFunction_fromQuantity" />
    <property name="package" value="formula" />
    <link role="applicableConcept" targetNodeId="12.1111792102248" resolveInfo="Quantity" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253958558">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253958560" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253958561">
        <link role="baseMethodDeclaration" targetNodeId="20.~DoubleConstant.&lt;init&gt;(double)" resolveInfo="DoubleConstant" />
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.FloatingPointConstant" id="1112996174765">
          <property name="value" value="0.0" />
          <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1113259356569">
            <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197671925790">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197671925791">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197671927449">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252625589">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620909">
                      <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197671927450" />
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197671930750">
                        <link role="link" targetNodeId="12.1111793363741" />
                      </node>
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197671934442">
                      <link role="property" targetNodeId="18.1113257000626" resolveInfo="value" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateSwitch" id="1112985235375">
    <property name="name" value="SWITCH_AgreementExpression_NewFunction_Money" />
    <property name="package" value="formula" />
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197668405950">
      <link role="applicableConcept" targetNodeId="12.1112036490295" resolveInfo="EventVariableReference" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197668477678">
        <link role="template" targetNodeId="1112804414269" resolveInfo="_new_FeeMoneyFunction" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197668424498">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197668424499">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197668438819">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197668438820">
              <property name="name" value="eventVariable" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197668438821">
                <link role="concept" targetNodeId="12.1111793755198" resolveInfo="EventVariable" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252620273">
                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197668428689" />
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197668433818">
                  <link role="link" targetNodeId="12.1112036516483" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197668443182">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252619233">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.StringLiteral" id="1197668445669">
                <property name="value" value="fee" />
              </node>
              <node role="operation" type="jetbrains.mps.baseLanguage.structure.InstanceMethodCallOperation" id="1214252619234">
                <link role="baseMethodDeclaration" targetNodeId="13.~String.equals(java.lang.Object):boolean" resolveInfo="equals" />
                <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622646">
                  <node role="operand" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197668460470">
                    <link role="variableDeclaration" targetNodeId="1197668438820" resolveInfo="eventVariable" />
                  </node>
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197668465708">
                    <link role="property" targetNodeId="14.1169194664001" resolveInfo="name" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197668507522">
      <link role="applicableConcept" targetNodeId="18.1111786301085" resolveInfo="PlusOperation" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197669304159">
        <link role="template" targetNodeId="1112804501366" resolveInfo="_new_MoneyAddOperationFunction" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197668537118">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197668537119">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197668549032">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197668549033">
              <property name="name" value="leftOperand" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197668549034">
                <link role="concept" targetNodeId="18.1111784312737" resolveInfo="Expression" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252625702">
                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197668542387" />
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197668545938">
                  <link role="link" targetNodeId="18.1111784613299" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197669274966">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1197669291407">
              <link role="baseMethodDeclaration" targetNodeId="19.1197668835374" resolveInfo="isMoney" />
              <link role="classConcept" targetNodeId="19.1197668662570" resolveInfo="QueriesUtil" />
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197669294877">
                <link role="variableDeclaration" targetNodeId="1197668549033" resolveInfo="leftOperand" />
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197669556191">
      <link role="applicableConcept" targetNodeId="12.1111792102248" resolveInfo="Quantity" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197669591490">
        <link role="template" targetNodeId="1112804588435" resolveInfo="_new_MoneyConstantFunction_fromQuantity" />
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197669622382">
      <link role="applicableConcept" targetNodeId="18.1111785030296" resolveInfo="IfFunction" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197669646009">
        <link role="template" targetNodeId="1112985504268" resolveInfo="_new_IfFunctionFunction_Money" />
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197669654603">
      <link role="applicableConcept" targetNodeId="18.1112384225757" resolveInfo="MultOperation" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197669780558">
        <link role="template" targetNodeId="1112894086969" resolveInfo="_new_MoneyMultiplyOperation" />
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197669676480">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197669676481">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclarationStatement" id="1197669707796">
            <node role="localVariableDeclaration" type="jetbrains.mps.baseLanguage.structure.LocalVariableDeclaration" id="1197669707797">
              <property name="name" value="leftOperand" />
              <node role="type" type="jetbrains.mps.lang.smodel.structure.SNodeType" id="1197669707798">
                <link role="concept" targetNodeId="18.1111784312737" resolveInfo="Expression" />
              </node>
              <node role="initializer" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624189">
                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197669707801" />
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197669722744">
                  <link role="link" targetNodeId="18.1111784613299" />
                </node>
              </node>
            </node>
          </node>
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ReturnStatement" id="1197669707802">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.StaticMethodCall" id="1197669707803">
              <link role="classConcept" targetNodeId="19.1197668662570" resolveInfo="QueriesUtil" />
              <link role="baseMethodDeclaration" targetNodeId="19.1197668835374" resolveInfo="isMoney" />
              <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.LocalVariableReference" id="1197669707804">
                <link role="variableDeclaration" targetNodeId="1197669707797" resolveInfo="leftOperand" />
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="defaultConsequence" type="jetbrains.mps.lang.generator.structure.TemplateDeclarationReference" id="1197669811918">
      <link role="template" targetNodeId="1112988394879" resolveInfo="_new_MoneyAdapterFunction" />
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112985504268">
    <property name="name" value="IfFunctionFunction_Money" />
    <property name="package" value="formula" />
    <link role="applicableConcept" targetNodeId="18.1111785030296" resolveInfo="IfFunction" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253958309">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253958311" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253958312">
        <link role="baseMethodDeclaration" targetNodeId="20.~IfFunction.&lt;init&gt;(jetbrains.mps.samples.formulaLanguage.api.Function,jetbrains.mps.samples.formulaLanguage.api.Function,jetbrains.mps.samples.formulaLanguage.api.Function)" resolveInfo="IfFunction" />
        <node role="typeParameter" type="jetbrains.mps.baseLanguage.structure.ClassifierType" id="1112985512536">
          <link role="classifier" targetNodeId="8.~Money" resolveInfo="Money" />
        </node>
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1112985562288">
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1112985562289">
            <link role="templateSwitch" targetNodeId="1112733851363" />
            <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197672723074">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197672723075">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197672724795">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622175">
                    <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197672724796" />
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197672729019">
                      <link role="link" targetNodeId="18.1111785044750" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1112985562290">
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1112985562291">
            <link role="templateSwitch" targetNodeId="1112985235375" />
            <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197672752770">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197672752771">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197672756053">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623249">
                    <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197672756054" />
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197672762777">
                      <link role="link" targetNodeId="18.1111785091720" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1112985562292">
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1112985562293">
            <link role="templateSwitch" targetNodeId="1112985235375" />
            <node role="sourceNodeQuery" type="jetbrains.mps.lang.generator.structure.SourceSubstituteMacro_SourceNodeQuery" id="1197672770684">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197672770685">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197672772249">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624840">
                    <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197672772250" />
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197672775738">
                      <link role="link" targetNodeId="18.1111785124143" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateDeclaration" id="1112988394879">
    <property name="name" value="new_MoneyAdapterFunction" />
    <property name="package" value="formula" />
    <node role="contentNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253959141">
      <node role="templateFragment$attribute" type="jetbrains.mps.lang.generator.structure.TemplateFragment" id="1214253959143" />
      <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253959144">
        <link role="baseMethodDeclaration" targetNodeId="9.~MoneyAdapter.&lt;init&gt;(jetbrains.mps.samples.formulaLanguage.api.Function,mf.Currency)" resolveInfo="MoneyAdapter" />
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.NullLiteral" id="1112988416115">
          <node role="nodeMacro$attribute" type="jetbrains.mps.lang.generator.structure.SwitchMacro" id="1112988515668">
            <link role="templateSwitch" targetNodeId="1112915076342" />
          </node>
        </node>
        <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1112988443136">
          <link role="variableDeclaration" targetNodeId="8.~Currency.USD" resolveInfo="USD" />
          <link role="classifier" targetNodeId="8.~Currency" resolveInfo="Currency" />
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateSwitch" id="1116448085084">
    <property name="name" value="SWITCH_Date" />
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197665283084">
      <link role="applicableConcept" targetNodeId="12.1116445695828" resolveInfo="Date_Past" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.InlineTemplate_RuleConsequence" id="1197665313072">
        <node role="templateNode" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1197665325277">
          <link role="classifier" targetNodeId="8.~MfDate" resolveInfo="MfDate" />
          <link role="variableDeclaration" targetNodeId="8.~MfDate.PAST" resolveInfo="PAST" />
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197665357701">
      <link role="applicableConcept" targetNodeId="12.1116445809270" resolveInfo="Date_Future" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.InlineTemplate_RuleConsequence" id="1197665370328">
        <node role="templateNode" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1197665370329">
          <link role="classifier" targetNodeId="8.~MfDate" resolveInfo="MfDate" />
          <link role="variableDeclaration" targetNodeId="8.~MfDate.FUTURE" resolveInfo="FUTURE" />
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197665702732">
      <link role="applicableConcept" targetNodeId="12.1111792389581" resolveInfo="Date" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.InlineTemplate_RuleConsequence" id="1197665720453">
        <node role="templateNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253959192">
          <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253959194">
            <link role="baseMethodDeclaration" targetNodeId="8.~MfDate.&lt;init&gt;(int,int,int)" resolveInfo="MfDate" />
            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.IntegerConstant" id="1197665736347">
              <property name="value" value="9999" />
              <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1197665736348">
                <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197666059703">
                  <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197666059704">
                    <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197666067223">
                      <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622793">
                        <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197666067224" />
                        <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197666071025">
                          <link role="property" targetNodeId="12.1111792409129" resolveInfo="year" />
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.IntegerConstant" id="1197665736349">
              <property name="value" value="99" />
              <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1197665736350">
                <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197666077682">
                  <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197666077683">
                    <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197666079715">
                      <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252624238">
                        <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197666079716" />
                        <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197666090158">
                          <link role="property" targetNodeId="12.1111792417427" resolveInfo="month" />
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.IntegerConstant" id="1197665736351">
              <property name="value" value="99" />
              <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1197665736352">
                <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197666097252">
                  <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197666097253">
                    <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197666099379">
                      <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252625002">
                        <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197666099380" />
                        <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197666101978">
                          <link role="property" targetNodeId="12.1111792417975" resolveInfo="day" />
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
  </node>
  <node type="jetbrains.mps.lang.generator.structure.TemplateSwitch" id="1116526421328">
    <property name="name" value="SWITCH_RegisterValue" />
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197664123890">
      <link role="applicableConcept" targetNodeId="12.1111792102248" resolveInfo="Quantity" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.InlineTemplate_RuleConsequence" id="1197664311626">
        <node role="templateNode" type="jetbrains.mps.baseLanguage.structure.GenericNewExpression" id="1214253958706">
          <node role="creator" type="jetbrains.mps.baseLanguage.structure.ClassCreator" id="1214253958708">
            <link role="baseMethodDeclaration" targetNodeId="8.~Quantity.&lt;init&gt;(double,mf.Unit)" resolveInfo="Quantity" />
            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.FloatingPointConstant" id="1197664434872">
              <property name="value" value="0.0" />
              <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1197664480422">
                <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197664480423">
                  <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197664480424">
                    <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197664485409">
                      <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252625653">
                        <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252621638">
                          <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197664521263" />
                          <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197664524611">
                            <link role="link" targetNodeId="12.1111793363741" />
                          </node>
                        </node>
                        <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197664893216">
                          <link role="property" targetNodeId="18.1113257000626" resolveInfo="value" />
                        </node>
                      </node>
                    </node>
                  </node>
                </node>
              </node>
            </node>
            <node role="actualArgument" type="jetbrains.mps.baseLanguage.structure.StaticFieldReference" id="1197664440140">
              <link role="classifier" targetNodeId="8.~Unit" resolveInfo="Unit" />
              <link role="variableDeclaration" targetNodeId="8.~Unit.KWH" resolveInfo="KWH" />
            </node>
          </node>
        </node>
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197664161642">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197664161643">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197664206269">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252621475">
              <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623184">
                <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197664206270" />
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197664209431">
                  <link role="property" targetNodeId="12.1111793358083" resolveInfo="unit" />
                </node>
              </node>
              <node role="operation" type="jetbrains.mps.lang.smodel.structure.Property_HasValue_Enum" id="1197664215888">
                <node role="value" type="jetbrains.mps.lang.smodel.structure.EnumMemberReference" id="1197664215889">
                  <link role="enumMember" targetNodeId="12.1111793319239" resolveInfo="KWH" />
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
    <node role="reductionMappingRule" type="jetbrains.mps.lang.generator.structure.Reduction_MappingRule" id="1197664229530">
      <link role="applicableConcept" targetNodeId="12.1111792102248" resolveInfo="Quantity" />
      <node role="ruleConsequence" type="jetbrains.mps.lang.generator.structure.InlineTemplate_RuleConsequence" id="1197664606518">
        <node role="templateNode" type="jetbrains.mps.baseLanguage.structure.FloatingPointConstant" id="1197664615645">
          <property name="value" value="0.0" />
          <node role="propertyMacro$property_attribute$value" type="jetbrains.mps.lang.generator.structure.PropertyMacro" id="1197664628974">
            <node role="propertyValueFunction" type="jetbrains.mps.lang.generator.structure.PropertyMacro_GetPropertyValue" id="1197664628975">
              <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197664628976">
                <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197664667821">
                  <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623071">
                    <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252622011">
                      <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197664672185" />
                      <node role="operation" type="jetbrains.mps.lang.smodel.structure.SLinkAccess" id="1197664676393">
                        <link role="link" targetNodeId="12.1111793363741" />
                      </node>
                    </node>
                    <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197664914544">
                      <link role="property" targetNodeId="18.1113257000626" resolveInfo="value" />
                    </node>
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
      <node role="conditionFunction" type="jetbrains.mps.lang.generator.structure.BaseMappingRule_Condition" id="1197664256798">
        <node role="body" type="jetbrains.mps.baseLanguage.structure.StatementList" id="1197664256799">
          <node role="statement" type="jetbrains.mps.baseLanguage.structure.ExpressionStatement" id="1197664264441">
            <node role="expression" type="jetbrains.mps.baseLanguage.structure.NotExpression" id="1197664288026">
              <node role="expression" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252626189">
                <node role="operand" type="jetbrains.mps.baseLanguage.structure.DotExpression" id="1214252623020">
                  <node role="operand" type="jetbrains.mps.lang.generator.structure.TemplateFunctionParameter_sourceNode" id="1197664288029" />
                  <node role="operation" type="jetbrains.mps.lang.smodel.structure.SPropertyAccess" id="1197664288030">
                    <link role="property" targetNodeId="12.1111793358083" resolveInfo="unit" />
                  </node>
                </node>
                <node role="operation" type="jetbrains.mps.lang.smodel.structure.Property_HasValue_Enum" id="1197664288031">
                  <node role="value" type="jetbrains.mps.lang.smodel.structure.EnumMemberReference" id="1197664288032">
                    <link role="enumMember" targetNodeId="12.1111793319239" resolveInfo="KWH" />
                  </node>
                </node>
              </node>
            </node>
          </node>
        </node>
      </node>
    </node>
  </node>
</model>

