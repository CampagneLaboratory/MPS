<project name="MPS-distribution" default="default">
  <property file="${ant.file.MPS-distribution}/../MPS.properties" />
  <include file="${ant.file.MPS-distribution}/../MPS-external.xml" />
  <include file="${ant.file.MPS-distribution}/../MPS-os-specific-default.xml" />
  <condition property="windows">
    <os family="windows" />
  </condition>
  <target name="base">
    <tstamp />
    <antcall target="MPS-external.main" />
  </target>
  <target name="default" depends="base">
    <antcall target="MPS-os-specific-default.main" />
    <antcall target="MPS-distribution.sign" />
    <antcall target="MPS-distribution.clean" />
  </target>
  <target name="sign" if="windows">
    <fail unless="deploy.dir" message="Property deploy.dir unspecified." />
    <fail unless="build.number" message="Property build.number unspecified." />
    <fail unless="scripts.dir" message="Property scripts.dir unspecified." />
    <exec executable="${scripts.dir}/sign/signtool.exe" osfamily="windows" failonerror="false" dir="${deploy.dir}">
      <arg line="sign /f ${scripts.dir}/sign/cs_cert2011.pfx /p 123 ${deploy.dir}/${build.number}-windows.exe" />
    </exec>
  </target>
  <target name="clean">
    <delete dir="${deploy.dir}/MPS" />
  </target>
</project>
