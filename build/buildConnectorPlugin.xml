<project name="buildConnectorPlugin" default="build" basedir="../">
  <property name="build.dir" location="build" />
  <property name="build.tmp" location="${build.dir}/tmp/buildConnectorPlugin" />
  <property name="build.layout" location="${build.dir}/artifacts/buildConnectorPlugin" />
  <property name="idea_home" location="" />
  <property name="mps_home" location="${basedir}" />
  
  <path id="path.java.library.idea-jars">
    <fileset dir="${idea_home}/lib">
      <include name="**/*.jar" />
      <exclude name="boot.jar" />
    </fileset>
  </path>
  
  <target name="assemble" depends="classes">
    <mkdir dir="${build.layout}/plugin" />
    <jar destfile="${build.layout}/plugin/MPSPlugin.jar">
      <fileset dir="${build.tmp}/java/out/MPS-plugin" />
    </jar>
  </target>
  
  <target name="build" depends="assemble, check" />
  
  <target name="clean">
    <delete dir="${build.tmp}" />
    <delete dir="${build.layout}" />
  </target>
  
  <target name="compileJava" depends="java.compile.MPS-plugin" />
  
  <target name="processResources" />
  
  <target name="classes" depends="compileJava, processResources" />
  
  <target name="test" depends="classes" />
  
  <target name="check" depends="test" />
  
  <target name="java.compile.MPS-plugin">
    <mkdir dir="${build.tmp}/java/out/MPS-plugin" />
    <javac destdir="${build.tmp}/java/out/MPS-plugin" fork="true" memorymaximumsize="1024m" includeantruntime="false" debug="true">
      <compilerarg value="-Xlint:none" />
      <src>
        <path location="${mps_home}/MPSPlugin/source" />
        <path location="${mps_home}/MPSPlugin/source-api" />
      </src>
      <classpath refid="path.java.library.idea-jars" />
    </javac>
    <copy todir="${build.tmp}/java/out/MPS-plugin">
      <fileset dir="${mps_home}/MPSPlugin">
        <include name="META-INF/**" />
      </fileset>
      <fileset dir="${mps_home}/MPSPlugin/source" includes="**/*.properties, **/*.xml, **/*.html, **/*.png, **/*.txt, **/*.ico, **/*.zip, **/*.info" />
      <fileset dir="${mps_home}/MPSPlugin/source-api" includes="**/*.properties, **/*.xml, **/*.html, **/*.png, **/*.txt, **/*.ico, **/*.zip, **/*.info" />
    </copy>
  </target>
</project>