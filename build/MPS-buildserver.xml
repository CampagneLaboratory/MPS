<project name="MPS-buildserver.xml" default="build" basedir="..">
  <!--This is a hack for MPS-8746
  For my opinion, syncing files by idea is not that bad
  so I should not be doing this-->
  <property name="mps.home" value="${mps_home}"/>
  <property name="real.deploy.dir" value="${mps_home}/artifacts"/>
  <property file="${mps_home}/build/sign/ftppassword"/>  
  <import file="${ant.file}/../MPS-external-dist.xml"/>
  <import file="${ant.file}/../../tests/jetbrains/mps/mps.tests.xml"/>
  <target name="test.and.build" depends="test, build"/>
  <target name="test" depends="mps.tests.all"/>
  <target name="upload" depends="MPS-external-dist.default">
    <ftp server="upload.cds.intellij.net"
           userid="mps"
           password="${ftp.password}">
      <fileset dir="${deploy.dir}"/>
    </ftp>
  </target>
  <target name="build" depends="MPS-external-dist.default,upload">
    <delete dir="${real.deploy.dir}"/>
    <mkdir dir="${real.deploy.dir}"/>
    <copydir src="${deploy.dir}" dest="${real.deploy.dir}"/>
    <delete dir="${deploy.dir}"/>
  </target>
</project>
