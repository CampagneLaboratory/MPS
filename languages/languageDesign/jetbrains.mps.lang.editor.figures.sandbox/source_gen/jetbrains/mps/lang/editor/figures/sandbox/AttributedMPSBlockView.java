package jetbrains.mps.lang.editor.figures.sandbox;

/*Generated by MPS */

import jetbrains.jetpad.projectional.view.GroupView;
import jetbrains.jetpad.projectional.view.RectView;
import jetbrains.jetpad.projectional.view.TextView;
import jetbrains.jetpad.model.property.Property;
import jetbrains.jetpad.model.property.ValueProperty;
import jetbrains.jetpad.values.Color;
import jetbrains.jetpad.geometry.Vector;
import jetbrains.jetpad.projectional.diagram.view.RootTrait;
import jetbrains.jetpad.projectional.diagram.view.MoveHandler;
import jetbrains.jetpad.mapper.Mapper;
import jetbrains.jetpad.mapper.Synchronizers;

public class AttributedMPSBlockView extends GroupView {
  private final GroupView myInputs = new GroupView();
  private final GroupView myOutputs = new GroupView();
  private RectView myRectView;
  private TextView myTextView = new TextView();

  public Property<Integer> x = new ValueProperty<Integer>(0);
  public Property<Integer> y = new ValueProperty<Integer>(0);
  public Property<String> text = new ValueProperty<String>("");



  public AttributedMPSBlockView() {
    children().add(myInputs);
    children().add(myOutputs);
    createRectView();
    children().add(myTextView);

    initSynchronizers();
  }



  private void createRectView() {
    myRectView = new RectView();
    myRectView.background().set(Color.LIGHT_GRAY);
    myRectView.visible().set(true);
    myRectView.dimension().set(new Vector(75, 75));
    children().add(myRectView);
    this.prop(RootTrait.MOVE_HANDLER).set(new MoveHandler() {
      public void move(Vector delta) {
        x.set(x.get() + delta.x);
        y.set(y.get() + delta.y);
        AttributedMPSBlockView.this.invalidate();
      }
    });

  }



  private void initSynchronizers() {
    new Mapper<AttributedMPSBlockView, AttributedMPSBlockView>(this, this) {


      @Override
      protected void registerSynchronizers(Mapper.SynchronizersConfiguration configuration) {
        configuration.add(Synchronizers.forProperty(getSource().x, new Runnable() {
          public void run() {
            getTarget().moveTo(new Vector(getTarget().x.get(), getTarget().y.get()));
          }
        }));
        configuration.add(Synchronizers.forProperty(getSource().y, new Runnable() {
          public void run() {
            getTarget().moveTo(new Vector(getTarget().x.get(), getTarget().y.get()));
          }
        }));
        configuration.add(Synchronizers.forProperty(getSource().text, getSource().myTextView.text()));
      }
    }.attachRoot();
  }



  public Property<Vector> dimension() {
    return myRectView.dimension();
  }



}
