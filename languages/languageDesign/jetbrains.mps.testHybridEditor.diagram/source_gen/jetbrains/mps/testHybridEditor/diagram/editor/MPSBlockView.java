package jetbrains.mps.testHybridEditor.diagram.editor;

/*Generated by MPS */

import jetbrains.jetpad.projectional.view.GroupView;
import jetbrains.jetpad.projectional.view.RectView;
import jetbrains.jetpad.projectional.view.TextView;
import jetbrains.jetpad.projectional.diagram.base.GridDirection;
import jetbrains.jetpad.projectional.view.View;
import jetbrains.jetpad.geometry.Rectangle;
import java.util.List;
import jetbrains.jetpad.geometry.Vector;
import java.util.ArrayList;
import jetbrains.mps.nodeEditor.cells.jetpad.BlockViewPortLayouter;
import java.util.Iterator;

public class MPSBlockView extends GroupView {
  private RectView myRectView;
  private TextView myTextView;
  private final GroupView inputs = new GroupView();
  private final GroupView outputs = new GroupView();
  private GridDirection myDir = GridDirection.RIGHT;



  public MPSBlockView() {
    children().add(inputs);
    children().add(outputs);
  }

  public void setTextView(TextView textView) {
    myTextView = textView;
    children().add(textView);
  }

  public void setRectView(RectView rectView) {
    myRectView = rectView;
    children().add(rectView);
  }

  public void addInputPort(View inputPortView) {
    inputs.children().add(inputPortView);
  }

  public void addOutputPort(View outputPortView) {
    outputs.children().add(outputPortView);
  }

  @Override
  protected void doValidate(View.ValidationContext context) {
    super.doValidate(context);
    Rectangle labelRect = myTextView.bounds().get();
    myRectView.moveTo(labelRect.origin);
    myRectView.dimension().set(myRectView.dimension().get().max(myTextView.bounds().get().dimension));
    layoutPorts(inputs.children(), myDir.opposite());
    layoutPorts(outputs.children(), myDir);
    super.doValidate(context);

  }

  private void layoutPorts(List<View> views, GridDirection dir) {
    List<Vector> viewDimensions = new ArrayList<Vector>(views.size());
    for (View v : views) {
      viewDimensions.add(v.bounds().get().dimension);
    }
    Rectangle bounds = new Rectangle(myRectView.bounds().get().origin, myRectView.dimension().get());
    List<Vector> viewOrigins = new BlockViewPortLayouter(bounds).layoutPorts(viewDimensions, dir);
    Iterator<Vector> originIter = viewOrigins.iterator();
    for (View v : views) {
      v.moveTo(originIter.next());
    }
  }



}
