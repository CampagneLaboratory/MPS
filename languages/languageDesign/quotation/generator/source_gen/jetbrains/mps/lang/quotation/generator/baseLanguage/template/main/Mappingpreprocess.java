package jetbrains.mps.lang.quotation.generator.baseLanguage.template.main;

/*Generated by MPS */

import jetbrains.mps.generator.runtime.Generated;
import jetbrains.mps.generator.runtime.TemplateMappingConfiguration;
import java.util.Collection;
import jetbrains.mps.generator.runtime.TemplateReductionRule;
import jetbrains.mps.generator.runtime.TemplateModel;
import jetbrains.mps.generator.runtime.TemplateUtil;
import org.jetbrains.mps.openapi.model.SNodeReference;
import jetbrains.mps.smodel.SNodePointer;
import jetbrains.mps.generator.template.ITemplateGenerator;
import jetbrains.mps.generator.runtime.TemplateCreateRootRule;
import java.util.Collections;
import jetbrains.mps.generator.runtime.TemplateRootMappingRule;
import jetbrains.mps.generator.runtime.TemplateWeavingRule;
import jetbrains.mps.generator.runtime.TemplateDropRootRule;
import jetbrains.mps.generator.runtime.TemplateMappingScript;
import jetbrains.mps.generator.runtime.ReductionRuleBase;
import jetbrains.mps.generator.runtime.TemplateRuleWithCondition;
import jetbrains.mps.generator.runtime.TemplateExecutionEnvironment;
import jetbrains.mps.generator.runtime.TemplateContext;
import jetbrains.mps.generator.runtime.GenerationException;
import jetbrains.mps.generator.template.ReductionRuleQueryContext;
import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.generator.runtime.ReferenceResolver;
import jetbrains.mps.generator.template.ReferenceMacroContext;
import jetbrains.mps.smodel.SReference;
import org.jetbrains.mps.openapi.persistence.PersistenceFacade;
import jetbrains.mps.generator.template.SourceSubstituteMacroNodeContext;
import jetbrains.mps.generator.GenerationTracerUtil;

@Generated
public class Mappingpreprocess implements TemplateMappingConfiguration {
  private final Collection<TemplateReductionRule> rules;
  private final TemplateModel myModel;

  public Mappingpreprocess(TemplateModel model) {
    this.myModel = model;
    rules = TemplateUtil.<TemplateReductionRule>asCollection(new Mappingpreprocess.ReductionRule0());
  }

  public String getName() {
    return "preprocess";
  }

  public TemplateModel getModel() {
    return this.myModel;
  }

  public SNodeReference getMappingNode() {
    return new SNodePointer("r:00000000-0000-4000-0000-011c8959034c(jetbrains.mps.lang.quotation.generator.baseLanguage.template.main@generator)", "8274572146452539018");
  }

  public boolean isApplicable(ITemplateGenerator generator) {
    return true;
  }

  public Collection<TemplateReductionRule> getReductionRules() {
    return rules;
  }

  public Collection<TemplateCreateRootRule> getCreateRules() {
    return Collections.emptySet();
  }

  public Collection<TemplateRootMappingRule> getRootRules() {
    return Collections.emptySet();
  }

  public Collection<TemplateWeavingRule> getWeavingRules() {
    return Collections.emptySet();
  }

  public Collection<TemplateDropRootRule> getDropRules() {
    return Collections.emptySet();
  }

  public Collection<TemplateMappingScript> getPostScripts() {
    return Collections.emptySet();
  }

  public Collection<TemplateMappingScript> getPreScripts() {
    return Collections.emptySet();
  }

  public boolean isTopPriority() {
    return true;
  }

  public final class ReductionRule0 extends ReductionRuleBase implements TemplateRuleWithCondition {
    public ReductionRule0() {
      super(new SNodePointer("r:00000000-0000-4000-0000-011c8959034c(jetbrains.mps.lang.quotation.generator.baseLanguage.template.main@generator)", "8274572146452628027"), "jetbrains.mps.lang.quotation.structure.NodeBuilderExpression", false);
    }

    @Override
    public boolean isApplicable(final TemplateExecutionEnvironment env, final TemplateContext context) throws GenerationException {
      return QueriesGenerated.baseMappingRule_Condition_8274572146452630995(new ReductionRuleQueryContext(context, getRuleNode()));
    }

    @Override
    protected Collection<SNode> doApply(@NotNull final TemplateContext context) throws GenerationException {
      final TemplateExecutionEnvironment environment = context.getEnvironment();
      environment.getTracer().pushRuleConsequence(conseq_pbbzd9_a0a1a2p);
      final SNode tnode1 = environment.createOutputNode("jetbrains.mps.lang.quotation.structure.NodeBuilderExpression");
      try {
        environment.getTracer().pushTemplateNode(templateNode_pbbzd9_a0a0a3a2p);
        environment.nodeCopied(context, tnode1, "tpl/r:00000000-0000-4000-0000-011c8959034c/7838325468139286666");

        {
          final SNode tnode2 = environment.createOutputNode("jetbrains.mps.lang.smodel.structure.SNodeTypeCastExpression");
          try {
            environment.getTracer().pushTemplateNode(templateNode_pbbzd9_a0a0a1a3a3a2p);
            environment.nodeCopied(context, tnode2, "tpl/r:00000000-0000-4000-0000-011c8959034c/7838325468140239188");
            environment.resolve(new ReferenceResolver() {
              public Object resolve(SNode outputNode, TemplateContext context) {
                return QueriesGenerated.referenceMacro_GetReferent_7838325468140239892(new ReferenceMacroContext(context, tnode2, referenceMacro_pbbzd9_c0a0a0a0a0a0c0b0d0d0c51, "concept"));
              }

              public String getDefaultResolveInfo() {
                return "Attribute";
              }

              public SNodeReference getTemplateNode() {
                return referenceMacro_pbbzd9_c0a0a0a0a0a0c0b0d0d0c51;
              }
            }, tnode2, "concept", context);

            {
              final SNode tnode3 = environment.createOutputNode("jetbrains.mps.baseLanguage.structure.StaticMethodCall");
              try {
                environment.getTracer().pushTemplateNode(templateNode_pbbzd9_a0a0a1a4a1a3a3a2p);
                environment.nodeCopied(context, tnode3, "tpl/r:00000000-0000-4000-0000-011c8959034c/7838325468139286748");
                tnode3.setReference("baseMethodDeclaration", SReference.create("baseMethodDeclaration", tnode3, PersistenceFacade.getInstance().createModelReference("f:java_stub#6ed54515-acc8-4d1e-a16c-9fd6cfe951ea#jetbrains.mps.lang.typesystem.runtime(MPS.Core/jetbrains.mps.lang.typesystem.runtime@java_stub)"), PersistenceFacade.getInstance().createNodeId("~HUtil.copyIfNecessary(org.jetbrains.mps.openapi.model.SNode):org.jetbrains.mps.openapi.model.SNode")));
                tnode3.setReference("classConcept", SReference.create("classConcept", tnode3, PersistenceFacade.getInstance().createModelReference("f:java_stub#6ed54515-acc8-4d1e-a16c-9fd6cfe951ea#jetbrains.mps.lang.typesystem.runtime(MPS.Core/jetbrains.mps.lang.typesystem.runtime@java_stub)"), PersistenceFacade.getInstance().createNodeId("~HUtil")));

                {
                  Collection<SNode> tlist4 = null;
                  try {
                    environment.getTracer().pushMacro(copySrcMacro_pbbzd9_a0a0a1a5a1a4a1a3a3a2p);
                    final SNode copySrcInput4 = QueriesGenerated.sourceNodeQuery_7838325468139287103(new SourceSubstituteMacroNodeContext(context, copySrcMacro_pbbzd9_a0a0a1a5a1a4a1a3a3a2p));
                    tlist4 = environment.copyNodes(TemplateUtil.singletonList(copySrcInput4), copySrcMacro_pbbzd9_a0a0a1a5a1a4a1a3a3a2p, "tpl/r:00000000-0000-4000-0000-011c8959034c/7838325468139286808", context);
                  } finally {
                    environment.getTracer().closeMacro(copySrcMacro_pbbzd9_a0a0a1a5a1a4a1a3a3a2p);
                  }
                  for (SNode child5 : TemplateUtil.asNotNull(tlist4)) {
                    tnode3.addChild("actualArgument", child5);
                  }
                  // TODO validate child 
                }
              } finally {
                environment.getTracer().pushOutputNode(GenerationTracerUtil.getSNodePointer(environment.getOutputModel(), tnode3));
                environment.getTracer().closeTemplateNode(templateNode_pbbzd9_a0a0a1a4a1a3a3a2p);
              }
              if (tnode3 != null) {
                tnode2.addChild("leftExpression", tnode3);
              }
              // TODO validate child 
            }
          } finally {
            environment.getTracer().pushOutputNode(GenerationTracerUtil.getSNodePointer(environment.getOutputModel(), tnode2));
            environment.getTracer().closeTemplateNode(templateNode_pbbzd9_a0a0a1a3a3a2p);
          }
          if (tnode2 != null) {
            tnode1.addChild("expression", tnode2);
          }
          // TODO validate child 
        }
      } finally {
        environment.getTracer().pushOutputNode(GenerationTracerUtil.getSNodePointer(environment.getOutputModel(), tnode1));
        environment.getTracer().closeTemplateNode(templateNode_pbbzd9_a0a0a3a2p);
      }
      return TemplateUtil.singletonList(tnode1);
    }
  }

  private static SNodePointer conseq_pbbzd9_a0a1a2p = new SNodePointer("r:00000000-0000-4000-0000-011c8959034c(jetbrains.mps.lang.quotation.generator.baseLanguage.template.main@generator)", "7838325468138655141");
  private static SNodePointer templateNode_pbbzd9_a0a0a3a2p = new SNodePointer("r:00000000-0000-4000-0000-011c8959034c(jetbrains.mps.lang.quotation.generator.baseLanguage.template.main@generator)", "7838325468139286666");
  private static SNodePointer templateNode_pbbzd9_a0a0a1a3a3a2p = new SNodePointer("r:00000000-0000-4000-0000-011c8959034c(jetbrains.mps.lang.quotation.generator.baseLanguage.template.main@generator)", "7838325468140239188");
  private static SNodePointer referenceMacro_pbbzd9_c0a0a0a0a0a0c0b0d0d0c51 = new SNodePointer("r:00000000-0000-4000-0000-011c8959034c(jetbrains.mps.lang.quotation.generator.baseLanguage.template.main@generator)", "7838325468140239891");
  private static SNodePointer templateNode_pbbzd9_a0a0a1a4a1a3a3a2p = new SNodePointer("r:00000000-0000-4000-0000-011c8959034c(jetbrains.mps.lang.quotation.generator.baseLanguage.template.main@generator)", "7838325468139286748");
  private static SNodePointer copySrcMacro_pbbzd9_a0a0a1a5a1a4a1a3a3a2p = new SNodePointer("r:00000000-0000-4000-0000-011c8959034c(jetbrains.mps.lang.quotation.generator.baseLanguage.template.main@generator)", "7838325468139287102");
}
