package jetbrains.mps.baseLanguage.search;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.model.SModel;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.List;
import java.util.ArrayList;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.apache.log4j.Level;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.apache.log4j.Logger;
import org.apache.log4j.LogManager;

@Deprecated
public class VisibleClassifiersScope extends ReachableClassifiersScope {
  private SNode myContextNode = null;
  @Deprecated
  public VisibleClassifiersScope(SModel model, int constraint) {
    // use ClassifierScopes.getVisibleClassifiersScope instead 
    super(model, constraint);
  }
  @Deprecated
  public VisibleClassifiersScope(@NotNull SNode contextNode, int constraint) {
    super(SNodeOperations.getModel(contextNode), constraint);
    myContextNode = contextNode;
  }
  @NotNull
  @Override
  public List<SNode> getClassifiers() {
    List<SNode> result = new ArrayList<SNode>();
    for (SNode classifier : super.getClassifiers()) {
      if (VisibilityUtil.isVisible(myContextNode, classifier)) {
        result.add(classifier);
      }
    }
    return result;
  }
  @Override
  public boolean isInScope(SNode node) {
    // speed up IVisible nodes with context 
    if (!(SNodeOperations.isInstanceOf(node, MetaAdapterFactory.getInterfaceConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x112670d273fL, "jetbrains.mps.baseLanguage.structure.IVisible")))) {
      if (LOG.isEnabledFor(Level.ERROR)) {
        LOG.error("isInScope(" + node + ") - not instance of IVisible");
      }
      return super.isInScope(node);
    }
    // check only NON_FINAL constraint, other constraints should be enforced by the reference type 
    if ((getConstraint() & NON_FINAL) != 0 && SNodeOperations.isInstanceOf(node, MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8c108ca66L, "jetbrains.mps.baseLanguage.structure.ClassConcept")) && SPropertyOperations.getBoolean(SNodeOperations.cast(node, MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8c108ca66L, "jetbrains.mps.baseLanguage.structure.ClassConcept")), MetaAdapterFactory.getProperty(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8c108ca66L, 0x11c6af4b284L, "isFinal"))) {
      return false;
    }
    return VisibilityUtil.isVisible(myContextNode, SNodeOperations.cast(node, MetaAdapterFactory.getInterfaceConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0x112670d273fL, "jetbrains.mps.baseLanguage.structure.IVisible")));
  }
  protected static Logger LOG = LogManager.getLogger(VisibleClassifiersScope.class);
}
