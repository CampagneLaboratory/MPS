package jetbrains.mps.baseLanguage.scopes;

/*Generated by MPS */

import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import java.util.concurrent.ConcurrentMap;
import jetbrains.mps.smodel.ModelAccess;

public class RepositoryStateCacheUtils {
  private RepositoryStateCacheUtils() {
  }

  public static <K, V> V getFromCache(Class clazz, K key, _FunctionTypes._return_P0_E0<? extends V> creator) {
    ConcurrentMap<K, V> cache = ModelAccess.instance().getRepositoryStateCache(clazz);
    if (cache == null) {
      return creator.invoke();
    }

    V v = cache.get(key);
    if (v != null) {
      return v;
    }
    v = creator.invoke();
    cache.putIfAbsent(key, v);
    return v;
  }
}
