package jetbrains.mps.lang.core.plugin;

/*Generated by MPS */

import jetbrains.mps.vfs.IFile;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.generator.fileGenerator.FileGenerationUtil;
import jetbrains.mps.extapi.model.GeneratableSModel;
import org.jetbrains.mps.openapi.persistence.DataSource;
import jetbrains.mps.extapi.persistence.FileDataSource;
import jetbrains.mps.vfs.FileSystem;

public class TextGenUtil {
  private TextGenUtil() {
  }

  public static IFile getOutputDir(IFile root, SModel model, IFile override) {
    if (override != null) {
      return override;
    }
    return FileGenerationUtil.getDefaultOutputDir(model, root);
  }

  public static IFile getOverriddenOutputDir(SModel md) {
    if (md instanceof GeneratableSModel) {
      boolean useModelFolder = ((GeneratableSModel) md).isGenerateIntoModelFolder();
      DataSource source = md.getSource();
      if (useModelFolder && source instanceof FileDataSource) {
        IFile file = ((FileDataSource) source).getFile();
        return file.getParent();
      }
    }
    return null;
  }

  public static boolean runWriteTransaction(final Runnable runnable) {
    return FileSystem.getInstance().runWriteTransaction(runnable);
  }
}
