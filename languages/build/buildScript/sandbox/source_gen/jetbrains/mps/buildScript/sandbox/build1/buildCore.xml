<project name="buildCore">
  <property name="mps_home" location="${basedir}/../../../.." />
  <property name="build_langs" location="${mps_home}/languages/build" />
  <property name="build.dir" location="build" />
  
  <path id="path.java.library.apache-collections">
    <fileset file="${build_langs}/build.ipr" />
    <fileset dir="${mps_home}">
      <include name="**/*.jar" />
    </fileset>
    <fileset dir="${basedir}"></fileset>
  </path>
  
  <target name="java.compile.mps-core">
    <javac destdir="${build.dir}/tmp/java.out.mps-core">
      <src>
        <pathelement path="${mps_home}/core/source" />
        <pathelement path="${mps_home}/core/tests" />
      </src>
      <classpath path="!TODO! java library classpath" />
    </javac>
  </target>
  
  <target name="build" depends="check, assemble" />
  
  <target name="clean">
    <delete dir="${build.dir}" />
  </target>
  
  <target name="compileJava" depends="java.compile.mps-core" />
  
  <target name="processResources" />
  
  <target name="classes" depends="compileJava, processResources" />
  
  <target name="assemble" depends="classes">
    <mkdir dir="${buildCore.deploy.dir}/default" />
    <mkdir dir="${buildCore.tmp}/release.zip" />
    <zip destfile="${buildCore.tmp}/release.zip/inrelease.zip">
      <fileset file="${mps_home}/MPS.ipr" />
      <fileset dir="${basedir}/source_gen/">
        <include name="**/*.java" />
      </fileset>
    </zip>
    <mkdir dir="${buildCore.tmp}/release.zip/aaa" />
    <mkdir dir="${buildCore.tmp}/release.zip/aaa/bbb" />
    <copy todir="${buildCore.tmp}/release.zip/aaa/bbb">
      <fileset file="${mps_home}/about.txt" />
    </copy>
    <zip destfile="${buildCore.deploy.dir}/default/release.zip">
      <fileset dir="${buildCore.tmp}/release.zip" />
    </zip>
    <mkdir dir="${buildCore.tmp}/mps-core-${ver}.jar" />
    <mkdir dir="${buildCore.tmp}/mps-core-${ver}.jar/abc" />
    <mkdir dir="${buildCore.tmp}/mps-core-${ver}.jar/abc/edf" />
    <zip destfile="${buildCore.tmp}/mps-core-${ver}.jar/abc/edf/aaa"></zip>
    <jar destfile="${buildCore.deploy.dir}/default/mps-core-${ver}.jar">
      <fileset dir="${build.dir}/tmp/java.out.mps-core" />
      <fileset dir="${buildCore.tmp}/mps-core-${ver}.jar" />
    </jar>
  </target>
  
  <target name="test" depends="classes" />
  
  <target name="check" depends="test" />
</project>